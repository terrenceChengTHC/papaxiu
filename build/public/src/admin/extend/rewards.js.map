{"version":3,"sources":["public/src/admin/extend/rewards.js"],"names":["define","translator","rewards","available","active","conditions","conditionals","init","ajaxify","data","$","each","select","this","on","update","parent","parents","id","attr","socket","emit","err","app","alertError","message","alertSuccess","remove","btn","disabled","hasClass","toggleClass","translateHtml","newReward","saveRewards","populateInputs","el","val","selectReward","div","find","inputs","html","reward","hasOwnProperty","rid","forEach","input","name","label","type","values","value","i","ul","claimable","templates","parse","li","translate","append","activeRewards","main","serializeArray","obj","push"],"mappings":"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","file":"public/src/admin/extend/rewards.js","sourcesContent":["'use strict';\n\n\ndefine('admin/extend/rewards', ['translator'], function (translator) {\n\tvar rewards = {};\n\n\n\tvar available;\n\tvar active;\n\tvar conditions;\n\tvar conditionals;\n\n\trewards.init = function () {\n\t\tavailable = ajaxify.data.rewards;\n\t\tactive = ajaxify.data.active;\n\t\tconditions = ajaxify.data.conditions;\n\t\tconditionals = ajaxify.data.conditionals;\n\n\t\t$('[data-selected]').each(function () {\n\t\t\tselect($(this));\n\t\t});\n\n\t\t$('#active')\n\t\t\t.on('change', '[data-selected]', function () {\n\t\t\t\tupdate($(this));\n\t\t\t})\n\t\t\t.on('click', '.delete', function () {\n\t\t\t\tvar parent = $(this).parents('[data-id]');\n\t\t\t\tvar id = parent.attr('data-id');\n\n\t\t\t\tsocket.emit('admin.rewards.delete', { id: id }, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tapp.alertError(err.message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapp.alertSuccess('[[admin/extend/rewards:alert.delete-success]]');\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tparent.remove();\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.on('click', '.toggle', function () {\n\t\t\t\tvar btn = $(this);\n\t\t\t\tvar disabled = btn.hasClass('btn-success');\n\t\t\t\tbtn.toggleClass('btn-warning').toggleClass('btn-success').translateHtml('[[admin/extend/rewards:' + (disabled ? 'disable' : 'enable') + ']]');\n\t\t\t\t// send disable api call\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t$('#new').on('click', newReward);\n\t\t$('#save').on('click', saveRewards);\n\n\t\tpopulateInputs();\n\t};\n\n\tfunction select(el) {\n\t\tel.val(el.attr('data-selected'));\n\t\tswitch (el.attr('name')) {\n\t\tcase 'rid':\n\t\t\tselectReward(el);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfunction update(el) {\n\t\tel.attr('data-selected', el.val());\n\t\tswitch (el.attr('name')) {\n\t\tcase 'rid':\n\t\t\tselectReward(el);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfunction selectReward(el) {\n\t\tvar parent = el.parents('[data-rid]');\n\t\tvar div = parent.find('.inputs');\n\t\tvar inputs;\n\t\tvar html = '';\n\n\t\tfor (var reward in available) {\n\t\t\tif (available.hasOwnProperty(reward)) {\n\t\t\t\tif (available[reward].rid === el.attr('data-selected')) {\n\t\t\t\t\tinputs = available[reward].inputs;\n\t\t\t\t\tparent.attr('data-rid', available[reward].rid);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!inputs) {\n\t\t\treturn app.alertError('[[admin/extend/rewards:alert.no-inputs-found]] ' + el.attr('data-selected'));\n\t\t}\n\n\t\tinputs.forEach(function (input) {\n\t\t\thtml += '<label for=\"' + input.name + '\">' + input.label + '<br />';\n\t\t\tswitch (input.type) {\n\t\t\tcase 'select':\n\t\t\t\thtml += '<select name=\"' + input.name + '\">';\n\t\t\t\tinput.values.forEach(function (value) {\n\t\t\t\t\thtml += '<option value=\"' + value.value + '\">' + value.name + '</option>';\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'text':\n\t\t\t\thtml += '<input type=\"text\" name=\"' + input.name + '\" />';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\thtml += '</label><br />';\n\t\t});\n\n\t\tdiv.html(html);\n\t}\n\n\tfunction populateInputs() {\n\t\t$('[data-rid]').each(function (i) {\n\t\t\tvar div = $(this).find('.inputs');\n\t\t\tvar rewards = active[i].rewards;\n\n\t\t\tfor (var reward in rewards) {\n\t\t\t\tif (rewards.hasOwnProperty(reward)) {\n\t\t\t\t\tdiv.find('[name=\"' + reward + '\"]').val(rewards[reward]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction newReward() {\n\t\tvar ul = $('#active');\n\n\t\tvar data = {\n\t\t\tactive: [{\n\t\t\t\tdisabled: true,\n\t\t\t\tvalue: '',\n\t\t\t\tclaimable: 1,\n\t\t\t\trid: null,\n\t\t\t\tid: null,\n\t\t\t}],\n\t\t\tconditions: conditions,\n\t\t\tconditionals: conditionals,\n\t\t\trewards: available,\n\t\t};\n\n\t\ttemplates.parse('admin/extend/rewards', 'active', data, function (li) {\n\t\t\ttranslator.translate(li, function (li) {\n\t\t\t\tli = $(li);\n\t\t\t\tul.append(li);\n\t\t\t\tli.find('select').val('');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction saveRewards() {\n\t\tvar activeRewards = [];\n\n\t\t$('#active li').each(function () {\n\t\t\tvar data = { rewards: {} };\n\t\t\tvar main = $(this).find('form.main').serializeArray();\n\t\t\tvar rewards = $(this).find('form.rewards').serializeArray();\n\n\t\t\tmain.forEach(function (obj) {\n\t\t\t\tdata[obj.name] = obj.value;\n\t\t\t});\n\n\t\t\trewards.forEach(function (obj) {\n\t\t\t\tdata.rewards[obj.name] = obj.value;\n\t\t\t});\n\n\t\t\tdata.id = $(this).attr('data-id');\n\t\t\tdata.disabled = $(this).find('.toggle').hasClass('btn-success');\n\n\t\t\tactiveRewards.push(data);\n\t\t});\n\n\t\tsocket.emit('admin.rewards.save', activeRewards, function (err) {\n\t\t\tif (err) {\n\t\t\t\tapp.alertError(err.message);\n\t\t\t} else {\n\t\t\t\tapp.alertSuccess('[[admin/extend/rewards:alert.save-success]]');\n\t\t\t}\n\t\t});\n\t}\n\n\treturn rewards;\n});\n"]}