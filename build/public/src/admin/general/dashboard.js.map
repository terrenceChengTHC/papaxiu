{"version":3,"sources":["public/src/admin/general/dashboard.js"],"names":["define","semver","Chart","translator","Admin","intervals","rooms","graphs","isMobile","isPrerelease","graphData","traffic","currentGraph","units","until","undefined","DEFAULTS","roomInterval","graphInterval","realtimeInterval","usedTopicColors","$","window","on","clearInterval","length","init","app","enterRoom","test","navigator","userAgent","get","releases","sort","a","b","name","replace","lt","filter","version","html","latestVersion","slice","checkEl","text","eq","removeClass","addClass","gt","translate","append","tooltip","setupRealtimeButton","setupGraphs","socket","emit","updateRoomUsage","initiateDashboard","err","data","alertError","message","JSON","stringify","onlineRegisteredCount","onlineGuestCount","socketCount","updateRegisteredGraph","updatePresenceGraph","users","updateTopicsGraph","topics","translateHtml","registered","presence","topicColors","lighten","col","amt","usePound","num","parseInt","r","g","toString","callback","trafficCanvas","document","getElementById","registeredCanvas","presenceCanvas","topicsCanvas","trafficCtx","getContext","registeredCtx","presenceCtx","topicsCtx","trafficLabels","utils","getHoursArray","defaults","global","tooltips","enabled","t","Translator","create","Promise","all","translateKey","then","translations","labels","datasets","label","backgroundColor","borderColor","pointBackgroundColor","pointHoverBackgroundColor","pointBorderColor","pointHoverBorderColor","width","parent","type","options","responsive","legend","display","scales","yAxes","ticks","beginAtZero","hoverBackgroundColor","updateTrafficGraph","adjustPieCharts","Date","amount","this","attr","setHours","getTime","require","translated","targetEl","templates","parse","modal","bootbox","dialog","title","buttons","submit","className","formData","find","serializeObject","validRegexp","startRange","endRange","setDate","getDate","each","$this","isFocused","graph","xLabels","getDaysArray","summary","thirty","seven","pastDay","addCommasToNumbers","pageviews","uniqueVisitors","update","anonymous","categories","category","recent","unread","Object","keys","0","value","tids","i","ii","push","buildTopicsLegend","topic","RELATIVE_PATH","hasClass","realtime","setInterval","isConnected"],"mappings":"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","file":"public/src/admin/general/dashboard.js","sourcesContent":["'use strict';\n\n\ndefine('admin/general/dashboard', ['semver', 'Chart', 'translator'], function (semver, Chart, translator) {\n\tvar\tAdmin = {};\n\tvar\tintervals = {\n\t\trooms: false,\n\t\tgraphs: false,\n\t};\n\tvar\tisMobile = false;\n\tvar\tisPrerelease = /^v?\\d+\\.\\d+\\.\\d+-.+$/;\n\tvar\tgraphData = {\n\t\trooms: {},\n\t\ttraffic: {},\n\t};\n\tvar\tcurrentGraph = {\n\t\tunits: 'hours',\n\t\tuntil: undefined,\n\t};\n\n\tvar DEFAULTS = {\n\t\troomInterval: 10000,\n\t\tgraphInterval: 15000,\n\t\trealtimeInterval: 1500,\n\t};\n\n\tvar\tusedTopicColors = [];\n\n\t$(window).on('action:ajaxify.start', function () {\n\t\tclearInterval(intervals.rooms);\n\t\tclearInterval(intervals.graphs);\n\n\t\tintervals.rooms = null;\n\t\tintervals.graphs = null;\n\t\tgraphData.rooms = null;\n\t\tgraphData.traffic = null;\n\t\tusedTopicColors.length = 0;\n\t});\n\n\tAdmin.init = function () {\n\t\tapp.enterRoom('admin');\n\n\t\tisMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n\n\t\t$.get('https://api.github.com/repos/NodeBB/NodeBB/tags', function (releases) {\n\t\t\t// Re-sort the releases, as they do not follow Semver (wrt pre-releases)\n\t\t\treleases = releases.sort(function (a, b) {\n\t\t\t\ta = a.name.replace(/^v/, '');\n\t\t\t\tb = b.name.replace(/^v/, '');\n\t\t\t\treturn semver.lt(a, b) ? 1 : -1;\n\t\t\t}).filter(function (version) {\n\t\t\t\treturn !isPrerelease.test(version.name);\t// filter out automated prerelease versions\n\t\t\t});\n\n\t\t\tvar\tversion = $('#version').html();\n\t\t\tvar latestVersion = releases[0].name.slice(1);\n\t\t\tvar checkEl = $('.version-check');\n\t\t\tvar text;\n\n\t\t\t// Alter box colour accordingly\n\t\t\tif (semver.eq(latestVersion, version)) {\n\t\t\t\tcheckEl.removeClass('alert-info').addClass('alert-success');\n\t\t\t\ttext = '[[admin/general/dashboard:up-to-date]]';\n\t\t\t} else if (semver.gt(latestVersion, version)) {\n\t\t\t\tcheckEl.removeClass('alert-info').addClass('alert-warning');\n\t\t\t\tif (!isPrerelease.test(version)) {\n\t\t\t\t\ttext = '[[admin/general/dashboard:upgrade-available, ' + latestVersion + ']]';\n\t\t\t\t} else {\n\t\t\t\t\ttext = '[[admin/general/dashboard:prerelease-upgrade-available, ' + latestVersion + ']]';\n\t\t\t\t}\n\t\t\t} else if (isPrerelease.test(version)) {\n\t\t\t\tcheckEl.removeClass('alert-info').addClass('alert-info');\n\t\t\t\ttext = '[[admin/general/dashboard:prerelease-warning]]';\n\t\t\t}\n\n\t\t\ttranslator.translate(text, function (text) {\n\t\t\t\tcheckEl.append(text);\n\t\t\t});\n\t\t});\n\n\t\t$('[data-toggle=\"tooltip\"]').tooltip();\n\n\t\tsetupRealtimeButton();\n\t\tsetupGraphs(function () {\n\t\t\tsocket.emit('admin.rooms.getAll', Admin.updateRoomUsage);\n\t\t\tinitiateDashboard();\n\t\t});\n\t};\n\n\tAdmin.updateRoomUsage = function (err, data) {\n\t\tif (err) {\n\t\t\treturn app.alertError(err.message);\n\t\t}\n\n\t\tif (JSON.stringify(graphData.rooms) === JSON.stringify(data)) {\n\t\t\treturn;\n\t\t}\n\n\t\tgraphData.rooms = data;\n\n\t\tvar html = '<div class=\"text-center pull-left\">' +\n\t\t\t\t\t\t'<span class=\"formatted-number\">' + data.onlineRegisteredCount + '</span>' +\n\t\t\t\t\t\t'<div class=\"stat\">[[admin/general/dashboard:active-users.users]]</div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div class=\"text-center pull-left\">' +\n\t\t\t\t\t\t'<span class=\"formatted-number\">' + data.onlineGuestCount + '</span>' +\n\t\t\t\t\t\t'<div class=\"stat\">[[admin/general/dashboard:active-users.guests]]</div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div class=\"text-center pull-left\">' +\n\t\t\t\t\t\t'<span class=\"formatted-number\">' + (data.onlineRegisteredCount + data.onlineGuestCount) + '</span>' +\n\t\t\t\t\t\t'<div class=\"stat\">[[admin/general/dashboard:active-users.total]]</div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div class=\"text-center pull-left\">' +\n\t\t\t\t\t\t'<span class=\"formatted-number\">' + data.socketCount + '</span>' +\n\t\t\t\t\t\t'<div class=\"stat\">[[admin/general/dashboard:active-users.connections]]</div>' +\n\t\t\t\t\t'</div>';\n\n\t\tupdateRegisteredGraph(data.onlineRegisteredCount, data.onlineGuestCount);\n\t\tupdatePresenceGraph(data.users);\n\t\tupdateTopicsGraph(data.topics);\n\n\t\t$('#active-users').translateHtml(html);\n\t};\n\n\tvar graphs = {\n\t\ttraffic: null,\n\t\tregistered: null,\n\t\tpresence: null,\n\t\ttopics: null,\n\t};\n\n\tvar topicColors = ['#bf616a', '#5B90BF', '#d08770', '#ebcb8b', '#a3be8c', '#96b5b4', '#8fa1b3', '#b48ead', '#ab7967', '#46BFBD'];\n\n\t/* eslint-disable */\n\t// from chartjs.org\n\tfunction lighten(col, amt) {\n\t\tvar usePound = false;\n\n\t\tif (col[0] === '#') {\n\t\t\tcol = col.slice(1);\n\t\t\tusePound = true;\n\t\t}\n\n\t\tvar num = parseInt(col, 16);\n\n\t\tvar r = (num >> 16) + amt;\n\n\t\tif (r > 255) r = 255;\n\t\telse if (r < 0) r = 0;\n\n\t\tvar b = ((num >> 8) & 0x00FF) + amt;\n\n\t\tif (b > 255) b = 255;\n\t\telse if (b < 0) b = 0;\n\n\t\tvar g = (num & 0x0000FF) + amt;\n\n\t\tif (g > 255) g = 255;\n\t\telse if (g < 0) g = 0;\n\n\t\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n\t}\n\t/* eslint-enable */\n\n\tfunction setupGraphs(callback) {\n\t\tcallback = callback || function () {};\n\t\tvar trafficCanvas = document.getElementById('analytics-traffic');\n\t\tvar registeredCanvas = document.getElementById('analytics-registered');\n\t\tvar presenceCanvas = document.getElementById('analytics-presence');\n\t\tvar topicsCanvas = document.getElementById('analytics-topics');\n\t\tvar trafficCtx = trafficCanvas.getContext('2d');\n\t\tvar registeredCtx = registeredCanvas.getContext('2d');\n\t\tvar presenceCtx = presenceCanvas.getContext('2d');\n\t\tvar topicsCtx = topicsCanvas.getContext('2d');\n\t\tvar trafficLabels = utils.getHoursArray();\n\n\t\tif (isMobile) {\n\t\t\tChart.defaults.global.tooltips.enabled = false;\n\t\t}\n\n\t\tvar t = translator.Translator.create();\n\t\tPromise.all([\n\t\t\tt.translateKey('admin/general/dashboard:graphs.page-views', []),\n\t\t\tt.translateKey('admin/general/dashboard:graphs.unique-visitors', []),\n\t\t\tt.translateKey('admin/general/dashboard:graphs.registered-users', []),\n\t\t\tt.translateKey('admin/general/dashboard:graphs.anonymous-users', []),\n\t\t\tt.translateKey('admin/general/dashboard:on-categories', []),\n\t\t\tt.translateKey('admin/general/dashboard:reading-posts', []),\n\t\t\tt.translateKey('admin/general/dashboard:browsing-topics', []),\n\t\t\tt.translateKey('admin/general/dashboard:recent', []),\n\t\t\tt.translateKey('admin/general/dashboard:unread', []),\n\t\t]).then(function (translations) {\n\t\t\tvar data = {\n\t\t\t\tlabels: trafficLabels,\n\t\t\t\tdatasets: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: translations[0],\n\t\t\t\t\t\tbackgroundColor: 'rgba(220,220,220,0.2)',\n\t\t\t\t\t\tborderColor: 'rgba(220,220,220,1)',\n\t\t\t\t\t\tpointBackgroundColor: 'rgba(220,220,220,1)',\n\t\t\t\t\t\tpointHoverBackgroundColor: '#fff',\n\t\t\t\t\t\tpointBorderColor: '#fff',\n\t\t\t\t\t\tpointHoverBorderColor: 'rgba(220,220,220,1)',\n\t\t\t\t\t\tdata: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: translations[1],\n\t\t\t\t\t\tbackgroundColor: 'rgba(151,187,205,0.2)',\n\t\t\t\t\t\tborderColor: 'rgba(151,187,205,1)',\n\t\t\t\t\t\tpointBackgroundColor: 'rgba(151,187,205,1)',\n\t\t\t\t\t\tpointHoverBackgroundColor: '#fff',\n\t\t\t\t\t\tpointBorderColor: '#fff',\n\t\t\t\t\t\tpointHoverBorderColor: 'rgba(151,187,205,1)',\n\t\t\t\t\t\tdata: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\n\t\t\ttrafficCanvas.width = $(trafficCanvas).parent().width();\n\t\t\tgraphs.traffic = new Chart(trafficCtx, {\n\t\t\t\ttype: 'line',\n\t\t\t\tdata: data,\n\t\t\t\toptions: {\n\t\t\t\t\tresponsive: true,\n\t\t\t\t\tlegend: {\n\t\t\t\t\t\tdisplay: false,\n\t\t\t\t\t},\n\t\t\t\t\tscales: {\n\t\t\t\t\t\tyAxes: [{\n\t\t\t\t\t\t\tticks: {\n\t\t\t\t\t\t\t\tbeginAtZero: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tgraphs.registered = new Chart(registeredCtx, {\n\t\t\t\ttype: 'doughnut',\n\t\t\t\tdata: {\n\t\t\t\t\tlabels: translations.slice(2, 4),\n\t\t\t\t\tdatasets: [{\n\t\t\t\t\t\tdata: [1, 1],\n\t\t\t\t\t\tbackgroundColor: ['#F7464A', '#46BFBD'],\n\t\t\t\t\t\thoverBackgroundColor: ['#FF5A5E', '#5AD3D1'],\n\t\t\t\t\t}],\n\t\t\t\t},\n\t\t\t\toptions: {\n\t\t\t\t\tresponsive: true,\n\t\t\t\t\tlegend: {\n\t\t\t\t\t\tdisplay: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tgraphs.presence = new Chart(presenceCtx, {\n\t\t\t\ttype: 'doughnut',\n\t\t\t\tdata: {\n\t\t\t\t\tlabels: translations.slice(4, 9),\n\t\t\t\t\tdatasets: [{\n\t\t\t\t\t\tdata: [1, 1, 1, 1, 1],\n\t\t\t\t\t\tbackgroundColor: ['#F7464A', '#46BFBD', '#FDB45C', '#949FB1', '#9FB194'],\n\t\t\t\t\t\thoverBackgroundColor: ['#FF5A5E', '#5AD3D1', '#FFC870', '#A8B3C5', '#A8B3C5'],\n\t\t\t\t\t}],\n\t\t\t\t},\n\t\t\t\toptions: {\n\t\t\t\t\tresponsive: true,\n\t\t\t\t\tlegend: {\n\t\t\t\t\t\tdisplay: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tgraphs.topics = new Chart(topicsCtx, {\n\t\t\t\ttype: 'doughnut',\n\t\t\t\tdata: {\n\t\t\t\t\tlabels: [],\n\t\t\t\t\tdatasets: [{\n\t\t\t\t\t\tdata: [],\n\t\t\t\t\t\tbackgroundColor: [],\n\t\t\t\t\t\thoverBackgroundColor: [],\n\t\t\t\t\t}],\n\t\t\t\t},\n\t\t\t\toptions: {\n\t\t\t\t\tresponsive: true,\n\t\t\t\t\tlegend: {\n\t\t\t\t\t\tdisplay: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tupdateTrafficGraph();\n\n\t\t\t$(window).on('resize', adjustPieCharts);\n\t\t\tadjustPieCharts();\n\n\t\t\t$('[data-action=\"updateGraph\"]:not([data-units=\"custom\"])').on('click', function () {\n\t\t\t\tvar until = new Date();\n\t\t\t\tvar amount = $(this).attr('data-amount');\n\t\t\t\tif ($(this).attr('data-units') === 'days') {\n\t\t\t\t\tuntil.setHours(0, 0, 0, 0);\n\t\t\t\t}\n\t\t\t\tuntil = until.getTime();\n\t\t\t\tupdateTrafficGraph($(this).attr('data-units'), until, amount);\n\t\t\t\t$('[data-action=\"updateGraph\"]').removeClass('active');\n\t\t\t\t$(this).addClass('active');\n\n\t\t\t\trequire(['translator'], function (translator) {\n\t\t\t\t\ttranslator.translate('[[admin/general/dashboard:page-views-custom]]', function (translated) {\n\t\t\t\t\t\t$('[data-action=\"updateGraph\"][data-units=\"custom\"]').text(translated);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\t$('[data-action=\"updateGraph\"][data-units=\"custom\"]').on('click', function () {\n\t\t\t\tvar targetEl = $(this);\n\n\t\t\t\ttemplates.parse('admin/partials/pageviews-range-select', {}, function (html) {\n\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\ttitle: '[[admin/general/dashboard:page-views-custom]]',\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tsubmit: {\n\t\t\t\t\t\t\t\tlabel: '[[global:search]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\t\tcallback: submit,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tfunction submit() {\n\t\t\t\t\t\t// NEED TO ADD VALIDATION HERE FOR YYYY-MM-DD\n\t\t\t\t\t\tvar formData = modal.find('form').serializeObject();\n\t\t\t\t\t\tvar validRegexp = /\\d{4}-\\d{2}-\\d{2}/;\n\n\t\t\t\t\t\t// Input validation\n\t\t\t\t\t\tif (!formData.startRange && !formData.endRange) {\n\t\t\t\t\t\t\t// No range? Assume last 30 days\n\t\t\t\t\t\t\tupdateTrafficGraph('days');\n\t\t\t\t\t\t\t$('[data-action=\"updateGraph\"]').removeClass('active');\n\t\t\t\t\t\t\t$('[data-action=\"updateGraph\"][data-units=\"days\"]').addClass('active');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else if (!validRegexp.test(formData.startRange) || !validRegexp.test(formData.endRange)) {\n\t\t\t\t\t\t\t// Invalid Input\n\t\t\t\t\t\t\tmodal.find('.alert-danger').removeClass('hidden');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar until = new Date(formData.endRange);\n\t\t\t\t\t\tuntil.setDate(until.getDate() + 1);\n\t\t\t\t\t\tuntil = until.getTime();\n\t\t\t\t\t\tvar amount = (until - new Date(formData.startRange).getTime()) / (1000 * 60 * 60 * 24);\n\n\t\t\t\t\t\tupdateTrafficGraph('days', until, amount);\n\t\t\t\t\t\t$('[data-action=\"updateGraph\"]').removeClass('active');\n\t\t\t\t\t\ttargetEl.addClass('active');\n\n\t\t\t\t\t\t// Update \"custom range\" label\n\t\t\t\t\t\ttargetEl.html(formData.startRange + ' &ndash; ' + formData.endRange);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tsocket.emit('admin.rooms.getAll', Admin.updateRoomUsage);\n\t\t\tinitiateDashboard();\n\t\t\tcallback();\n\t\t});\n\t}\n\n\tfunction adjustPieCharts() {\n\t\t$('.pie-chart.legend-up').each(function () {\n\t\t\tvar $this = $(this);\n\n\t\t\tif ($this.width() < 320) {\n\t\t\t\t$this.addClass('compact');\n\t\t\t} else {\n\t\t\t\t$this.removeClass('compact');\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction updateTrafficGraph(units, until, amount) {\n\t\t// until and amount are optional\n\n\t\tif (!app.isFocused) {\n\t\t\treturn;\n\t\t}\n\n\t\tsocket.emit('admin.analytics.get', {\n\t\t\tgraph: 'traffic',\n\t\t\tunits: units || 'hours',\n\t\t\tuntil: until,\n\t\t\tamount: amount,\n\t\t}, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tif (JSON.stringify(graphData.traffic) === JSON.stringify(data)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tgraphData.traffic = data;\n\n\t\t\tif (units === 'days') {\n\t\t\t\tgraphs.traffic.data.xLabels = utils.getDaysArray(until, amount);\n\t\t\t} else {\n\t\t\t\tgraphs.traffic.data.xLabels = utils.getHoursArray();\n\n\t\t\t\t$('#pageViewsThirty').html(data.summary.thirty);\n\t\t\t\t$('#pageViewsSeven').html(data.summary.seven);\n\t\t\t\t$('#pageViewsPastDay').html(data.pastDay);\n\t\t\t\tutils.addCommasToNumbers($('#pageViewsThirty'));\n\t\t\t\tutils.addCommasToNumbers($('#pageViewsSeven'));\n\t\t\t\tutils.addCommasToNumbers($('#pageViewsPastDay'));\n\t\t\t}\n\n\t\t\tgraphs.traffic.data.datasets[0].data = data.pageviews;\n\t\t\tgraphs.traffic.data.datasets[1].data = data.uniqueVisitors;\n\t\t\tgraphs.traffic.data.labels = graphs.traffic.data.xLabels;\n\n\t\t\tgraphs.traffic.update();\n\t\t\tcurrentGraph.units = units;\n\t\t\tcurrentGraph.until = until;\n\t\t\tcurrentGraph.amount = amount;\n\t\t});\n\t}\n\n\tfunction updateRegisteredGraph(registered, anonymous) {\n\t\tgraphs.registered.data.datasets[0].data[0] = registered;\n\t\tgraphs.registered.data.datasets[0].data[1] = anonymous;\n\t\tgraphs.registered.update();\n\t}\n\n\tfunction updatePresenceGraph(users) {\n\t\tgraphs.presence.data.datasets[0].data[0] = users.categories;\n\t\tgraphs.presence.data.datasets[0].data[1] = users.topics;\n\t\tgraphs.presence.data.datasets[0].data[2] = users.category;\n\t\tgraphs.presence.data.datasets[0].data[3] = users.recent;\n\t\tgraphs.presence.data.datasets[0].data[4] = users.unread;\n\n\t\tgraphs.presence.update();\n\t}\n\n\tfunction updateTopicsGraph(topics) {\n\t\tif (!Object.keys(topics).length) {\n\t\t\ttopics = { 0: {\n\t\t\t\ttitle: 'No users browsing',\n\t\t\t\tvalue: 1,\n\t\t\t} };\n\t\t}\n\n\t\tvar tids = Object.keys(topics);\n\n\t\tgraphs.topics.data.labels = [];\n\t\tgraphs.topics.data.datasets[0].data = [];\n\t\tgraphs.topics.data.datasets[0].backgroundColor = [];\n\t\tgraphs.topics.data.datasets[0].hoverBackgroundColor = [];\n\n\t\tfor (var i = 0, ii = tids.length; i < ii; i += 1) {\n\t\t\tgraphs.topics.data.labels.push(topics[tids[i]].title);\n\t\t\tgraphs.topics.data.datasets[0].data.push(topics[tids[i]].value);\n\t\t\tgraphs.topics.data.datasets[0].backgroundColor.push(topicColors[i]);\n\t\t\tgraphs.topics.data.datasets[0].hoverBackgroundColor.push(lighten(topicColors[i], 10));\n\t\t}\n\n\t\tfunction buildTopicsLegend() {\n\t\t\tvar legend = $('#topics-legend').html('');\n\n\t\t\tfor (var i = 0, ii = tids.length; i < ii; i += 1) {\n\t\t\t\tvar topic = topics[tids[i]];\n\t\t\t\tvar\tlabel = topic.value === '0' ? topic.title : '<a title=\"' + topic.title + '\"href=\"' + RELATIVE_PATH + '/topic/' + tids[i] + '\" target=\"_blank\"> ' + topic.title + '</a>';\n\n\t\t\t\tlegend.append(\n\t\t\t\t\t'<li>' +\n\t\t\t\t\t'<div style=\"background-color: ' + topicColors[i] + ';\"></div>' +\n\t\t\t\t\t'<span>' + label + '</span>' +\n\t\t\t\t\t'</li>');\n\t\t\t}\n\t\t}\n\n\t\tbuildTopicsLegend();\n\t\tgraphs.topics.update();\n\t}\n\n\tfunction setupRealtimeButton() {\n\t\t$('#toggle-realtime .fa').on('click', function () {\n\t\t\tvar $this = $(this);\n\t\t\tif ($this.hasClass('fa-toggle-on')) {\n\t\t\t\t$this.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n\t\t\t\t$this.parent().find('strong').html('OFF');\n\t\t\t\tinitiateDashboard(false);\n\t\t\t} else {\n\t\t\t\t$this.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n\t\t\t\t$this.parent().find('strong').html('ON');\n\t\t\t\tinitiateDashboard(true);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction initiateDashboard(realtime) {\n\t\tclearInterval(intervals.rooms);\n\t\tclearInterval(intervals.graphs);\n\n\t\tintervals.rooms = setInterval(function () {\n\t\t\tif (app.isFocused && app.isConnected) {\n\t\t\t\tsocket.emit('admin.rooms.getAll', Admin.updateRoomUsage);\n\t\t\t}\n\t\t}, realtime ? DEFAULTS.realtimeInterval : DEFAULTS.roomInterval);\n\n\t\tintervals.graphs = setInterval(function () {\n\t\t\tupdateTrafficGraph(currentGraph.units, currentGraph.until, currentGraph.amount);\n\t\t}, realtime ? DEFAULTS.realtimeInterval : DEFAULTS.graphInterval);\n\t}\n\n\treturn Admin;\n});\n"]}