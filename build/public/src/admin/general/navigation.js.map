{"version":3,"sources":["public/src/admin/general/navigation.js"],"names":["define","translator","iconSelect","navigation","available","init","ajaxify","data","$","each","this","val","unescape","translate","html","find","draggable","connectToSortable","helper","distance","stop","drop","sortable","droppable","accept","on","iconEl","el","newIconClass","attr","index","parents","siblings","toggleClass","onSelect","remove","toggle","save","clickedIndex","removeClass","addClass","detailsForm","children","length","ev","ui","id","iconClass","enabled","parseInt","last","templates","parse","li","after","append","componentHandler","upgradeDom","nav","indices","push","forEach","form","serializeArray","properties","input","name","slice","value","escape","prop","hasOwnProperty","socket","emit","err","app","alertError","message","alertSuccess","btn","disabled","hasClass"],"mappings":"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","file":"public/src/admin/general/navigation.js","sourcesContent":["'use strict';\n\n\ndefine('admin/general/navigation', ['translator', 'iconSelect', 'jqueryui'], function (translator, iconSelect) {\n\tvar navigation = {};\n\tvar available;\n\n\tnavigation.init = function () {\n\t\tavailable = ajaxify.data.available;\n\n\t\t$('#enabled .unescape').each(function () {\n\t\t\t$(this).val(translator.unescape($(this).val()));\n\t\t});\n\n\t\ttranslator.translate($('#available').html(), function (html) {\n\t\t\t$('#available').html(translator.unescape(html))\n\t\t\t\t.find('li .drag-item').draggable({\n\t\t\t\t\tconnectToSortable: '#active-navigation',\n\t\t\t\t\thelper: 'clone',\n\t\t\t\t\tdistance: 10,\n\t\t\t\t\tstop: drop,\n\t\t\t\t});\n\t\t});\n\n\t\t$('#active-navigation').sortable().droppable({\n\t\t\taccept: $('#available li .drag-item'),\n\t\t});\n\n\t\t$('#enabled').on('click', '.iconPicker', function () {\n\t\t\tvar iconEl = $(this).find('i');\n\t\t\ticonSelect.init(iconEl, function (el) {\n\t\t\t\tvar newIconClass = el.attr('value');\n\t\t\t\tvar index = iconEl.parents('[data-index]').attr('data-index');\n\t\t\t\t$('#active-navigation [data-index=\"' + index + '\"] i').attr('class', 'fa fa-fw ' + newIconClass);\n\t\t\t\ticonEl.siblings('[name=\"iconClass\"]').val(newIconClass);\n\t\t\t\ticonEl.siblings('.change-icon-link').toggleClass('hidden', !!newIconClass);\n\t\t\t});\n\t\t});\n\n\t\t$('#active-navigation').on('click', 'li', onSelect);\n\n\t\t$('#enabled')\n\t\t\t.on('click', '.delete', remove)\n\t\t\t.on('click', '.toggle', toggle);\n\n\t\t$('#save').on('click', save);\n\t};\n\n\tfunction onSelect() {\n\t\tvar clickedIndex = $(this).attr('data-index');\n\t\t$('#active-navigation li').removeClass('active');\n\t\t$(this).addClass('active');\n\n\t\tvar detailsForm = $('#enabled').children('[data-index=\"' + clickedIndex + '\"]');\n\t\t$('#enabled li').addClass('hidden');\n\n\t\tif (detailsForm.length) {\n\t\t\tdetailsForm.removeClass('hidden');\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction drop(ev, ui) {\n\t\tvar id = ui.helper.attr('data-id');\n\t\tvar el = $('#active-navigation [data-id=\"' + id + '\"]');\n\t\tvar data = id === 'custom' ? { iconClass: 'fa-navicon' } : available[id];\n\n\t\tdata.enabled = false;\n\t\tdata.index = (parseInt($('#enabled').children().last().attr('data-index'), 10) || 0) + 1;\n\n\t\ttemplates.parse('admin/general/navigation', 'navigation', { navigation: [data] }, function (li) {\n\t\t\ttranslator.translate(li, function (li) {\n\t\t\t\tli = $(translator.unescape(li));\n\t\t\t\tel.after(li);\n\t\t\t\tel.remove();\n\t\t\t});\n\t\t});\n\n\t\ttemplates.parse('admin/general/navigation', 'enabled', { enabled: [data] }, function (li) {\n\t\t\ttranslator.translate(li, function (li) {\n\t\t\t\tli = $(translator.unescape(li));\n\t\t\t\t$('#enabled').append(li);\n\t\t\t\tcomponentHandler.upgradeDom();\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction save() {\n\t\tvar nav = [];\n\n\t\tvar indices = [];\n\t\t$('#active-navigation li').each(function () {\n\t\t\tindices.push($(this).attr('data-index'));\n\t\t});\n\n\t\tindices.forEach(function (index) {\n\t\t\tvar el = $('#enabled').children('[data-index=\"' + index + '\"]');\n\t\t\tvar form = el.find('form').serializeArray();\n\t\t\tvar data = {};\n\t\t\tvar properties = {};\n\n\t\t\tform.forEach(function (input) {\n\t\t\t\tif (input.name.slice(0, 9) === 'property:' && input.value === 'on') {\n\t\t\t\t\tproperties[input.name.slice(9)] = true;\n\t\t\t\t} else {\n\t\t\t\t\tdata[input.name] = translator.escape(input.value);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdata.properties = {};\n\n\t\t\tfor (var prop in properties) {\n\t\t\t\tif (properties.hasOwnProperty(prop)) {\n\t\t\t\t\tdata.properties[prop] = properties[prop];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnav.push(data);\n\t\t});\n\n\t\tsocket.emit('admin.navigation.save', nav, function (err) {\n\t\t\tif (err) {\n\t\t\t\tapp.alertError(err.message);\n\t\t\t} else {\n\t\t\t\tapp.alertSuccess('Successfully saved navigation');\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction remove() {\n\t\tvar index = $(this).parents('[data-index]').attr('data-index');\n\t\t$('#active-navigation [data-index=\"' + index + '\"]').remove();\n\t\t$('#enabled [data-index=\"' + index + '\"]').remove();\n\t\treturn false;\n\t}\n\n\tfunction toggle() {\n\t\tvar btn = $(this);\n\t\tvar disabled = btn.hasClass('btn-success');\n\t\ttranslator.translate(disabled ? '[[admin/general/navigation:btn.disable]]' : '[[admin/general/navigation:btn.enable]]', function (html) {\n\t\t\tbtn.toggleClass('btn-warning').toggleClass('btn-success').html(html);\n\t\t\tbtn.parents('li').find('[name=\"enabled\"]').val(disabled ? 'on' : '');\n\t\t});\n\t\treturn false;\n\t}\n\n\treturn navigation;\n});\n"]}