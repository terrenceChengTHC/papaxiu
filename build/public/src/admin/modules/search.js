"use strict";define("admin/modules/search",["mousetrap"],function(e){var t={};function s(e,t){var s=e.filter(function(e){return e.translations.toLowerCase().includes(t)}).map(function(e){var s=e.namespace;var a=e.translations;var r=e.title;var n=utils.escapeRegexChars(t);var i=a.replace(new RegExp("^(?:(?!"+n+").)*$","gmi"),"").replace(new RegExp("(^|\\n).*?"+r+".*?(\\n|$)","g"),"").replace(new RegExp("^[\\s\\S]*?(.{0,25})("+n+")(.{0,25})[\\s\\S]*?$","gmi"),'...$1<span class="search-match">$2</span>$3...<br>').replace(/(?:\n ?)+/g,"\n").trim();r=r.replace(new RegExp("(^.*?)("+n+")(.*?$)","gi"),'$1<span class="search-match">$2</span>$3');return'<li role="presentation" class="result">'+'<a role= "menuitem" href= "'+config.relative_path+"/"+s+'" >'+r+"<br>"+(!i?"":"<small><code>"+i+"</small></code>")+"</a>"+"</li>"}).join("");return s}t.init=function(){socket.emit("admin.getSearchDict",{},function(e,t){if(e){app.alertError(e);throw e}a(t)})};function a(t){var a=$("#acp-search .dropdown");var r=$("#acp-search .dropdown-menu");var n=$("#acp-search input");if(!config.searchEnabled){r.addClass("search-disabled")}n.on("keyup",function(){a.addClass("open")});$("#acp-search").parents("form").on("submit",function(e){var t=r.find("li.result > a.focus").attr("href");if(!t.length){t=r.find("li.result > a").first().attr("href")}var s=t||config.relative_path+"/search?in=titlesposts&term="+escape(n.val());ajaxify.go(s.replace(/^\//,""));setTimeout(function(){a.removeClass("open");n.blur()},150);e.preventDefault();return false});e(n[0]).bind(["up","down"],function(e,t){var s;if(t==="up"){s=r.find("li.result > a.focus").removeClass("focus").parent().prev(".result").children();if(!s.length){s=r.find("li.result > a").last()}s.addClass("focus");if(r[0].getBoundingClientRect().top>s[0].getBoundingClientRect().top){s[0].scrollIntoView(true)}}else if(t==="down"){s=r.find("li.result > a.focus").removeClass("focus").parent().next(".result").children();if(!s.length){s=r.find("li.result > a").first()}s.addClass("focus");if(r[0].getBoundingClientRect().bottom<s[0].getBoundingClientRect().bottom){s[0].scrollIntoView(false)}}e.preventDefault()});var i;n.on("keyup focus",function(){var e=n.val().toLowerCase();if(e===i){return}i=e;r.children(".result").remove();var a=/\W/.test(e)?3:e.length;var l;r.toggleClass("state-start-typing",a===0);r.toggleClass("state-keep-typing",a>0&&a<3);if(a>=3){r.prepend(s(t,e));l=r.children(".result").length;r.toggleClass("state-no-results",!l);r.toggleClass("state-yes-results",!!l);r.find(".search-forum").not(".divider").find("a").attr("href",config.relative_path+"/search?in=titlesposts&term="+escape(e)).find("strong").text(e)}else{r.removeClass("state-no-results state-yes-results")}})}return t});
//# sourceMappingURL=public/src/admin/modules/search.js.map