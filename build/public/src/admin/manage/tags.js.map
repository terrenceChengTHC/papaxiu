{"version":3,"sources":["public/src/admin/manage/tags.js"],"names":["define","infinitescroll","selectable","colorpicker","Tags","timeoutId","init","enable","handleCreate","handleSearch","handleModify","handleDeleteSelected","createModal","$","createTagName","createModalGo","on","e","keyCode","click","modal","setTimeout","focus","socket","emit","tag","val","err","app","alertError","message","ajaxify","refresh","clearTimeout","query","result","parseAndTranslate","tags","html","utils","makeNumbersHumanReadable","find","tagsToModify","length","firstTag","title","attr","bootbox","dialog","buttons","success","label","className","callback","bgColor","color","each","idx","css","save","handleColorPickers","tagsToDelete","confirm","index","el","push","remove","enableColorPicker","inputEl","$inputEl","data","alertSuccess"],"mappings":"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","file":"public/src/admin/manage/tags.js","sourcesContent":["'use strict';\n\n\ndefine('admin/manage/tags', [\n\t'forum/infinitescroll',\n\t'admin/modules/selectable',\n\t'admin/modules/colorpicker',\n], function (infinitescroll, selectable, colorpicker) {\n\tvar\tTags = {};\n\tvar timeoutId = 0;\n\n\tTags.init = function () {\n\t\tselectable.enable('.tag-management', '.tag-row');\n\n\t\thandleCreate();\n\t\thandleSearch();\n\t\thandleModify();\n\t\thandleDeleteSelected();\n\t};\n\n\tfunction handleCreate() {\n\t\tvar createModal = $('#create-modal');\n\t\tvar createTagName = $('#create-tag-name');\n\t\tvar createModalGo = $('#create-modal-go');\n\n\t\tcreateModal.on('keypress', function (e) {\n\t\t\tif (e.keyCode === 13) {\n\t\t\t\tcreateModalGo.click();\n\t\t\t}\n\t\t});\n\n\t\t$('#create').on('click', function () {\n\t\t\tcreateModal.modal('show');\n\t\t\tsetTimeout(function () {\n\t\t\t\tcreateTagName.focus();\n\t\t\t}, 250);\n\t\t});\n\n\t\tcreateModalGo.on('click', function () {\n\t\t\tsocket.emit('admin.tags.create', {\n\t\t\t\ttag: createTagName.val(),\n\t\t\t}, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\tcreateTagName.val('');\n\t\t\t\tcreateModal.on('hidden.bs.modal', function () {\n\t\t\t\t\tajaxify.refresh();\n\t\t\t\t});\n\t\t\t\tcreateModal.modal('hide');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleSearch() {\n\t\t$('#tag-search').on('input propertychange', function () {\n\t\t\tif (timeoutId) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\n\t\t\ttimeoutId = setTimeout(function () {\n\t\t\t\tsocket.emit('topics.searchAndLoadTags', {\n\t\t\t\t\tquery: $('#tag-search').val(),\n\t\t\t\t}, function (err, result) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tapp.parseAndTranslate('admin/manage/tags', 'tags', {\n\t\t\t\t\t\ttags: result.tags,\n\t\t\t\t\t}, function (html) {\n\t\t\t\t\t\t$('.tag-list').html(html);\n\t\t\t\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\n\t\t\t\t\t\ttimeoutId = 0;\n\n\t\t\t\t\t\tselectable.enable('.tag-management', '.tag-row');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, 100);\n\t\t});\n\t}\n\n\tfunction handleModify() {\n\t\t$('#modify').on('click', function () {\n\t\t\tvar tagsToModify = $('.tag-row.ui-selected');\n\t\t\tif (!tagsToModify.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar firstTag = $(tagsToModify[0]);\n\t\t\tvar title = tagsToModify.length > 1 ? '[[admin/manage/tags:alerts.editing-multiple]]' : '[[admin/manage/tags:alerts.editing-x, ' + firstTag.find('.tag-item').attr('data-tag') + ']]';\n\n\t\t\tvar modal = bootbox.dialog({\n\t\t\t\ttitle: title,\n\t\t\t\tmessage: firstTag.find('.tag-modal').html(),\n\t\t\t\tbuttons: {\n\t\t\t\t\tsuccess: {\n\t\t\t\t\t\tlabel: 'Save',\n\t\t\t\t\t\tclassName: 'btn-primary save',\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\tvar modal = $('.bootbox');\n\t\t\t\t\t\t\tvar bgColor = modal.find('[data-name=\"bgColor\"]').val();\n\t\t\t\t\t\t\tvar color = modal.find('[data-name=\"color\"]').val();\n\n\t\t\t\t\t\t\ttagsToModify.each(function (idx, tag) {\n\t\t\t\t\t\t\t\ttag = $(tag);\n\n\t\t\t\t\t\t\t\ttag.find('[data-name=\"bgColor\"]').val(bgColor);\n\t\t\t\t\t\t\t\ttag.find('[data-name=\"color\"]').val(color);\n\t\t\t\t\t\t\t\ttag.find('.tag-item').css('background-color', bgColor).css('color', color);\n\n\t\t\t\t\t\t\t\tsave(tag);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\thandleColorPickers(modal);\n\t\t});\n\t}\n\n\tfunction handleDeleteSelected() {\n\t\t$('#deleteSelected').on('click', function () {\n\t\t\tvar tagsToDelete = $('.tag-row.ui-selected');\n\t\t\tif (!tagsToDelete.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/tags:alerts.confirm-delete]]', function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar tags = [];\n\t\t\t\ttagsToDelete.each(function (index, el) {\n\t\t\t\t\ttags.push($(el).attr('data-tag'));\n\t\t\t\t});\n\t\t\t\tsocket.emit('admin.tags.deleteTags', {\n\t\t\t\t\ttags: tags,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\ttagsToDelete.remove();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleColorPickers(modal) {\n\t\tfunction enableColorPicker(idx, inputEl) {\n\t\t\tvar $inputEl = $(inputEl);\n\t\t\tcolorpicker.enable($inputEl);\n\t\t}\n\n\t\tmodal.find('[data-name=\"bgColor\"], [data-name=\"color\"]').each(enableColorPicker);\n\t}\n\n\tfunction save(tag) {\n\t\tvar data = {\n\t\t\ttag: tag.attr('data-tag'),\n\t\t\tbgColor: tag.find('[data-name=\"bgColor\"]').val(),\n\t\t\tcolor: tag.find('[data-name=\"color\"]').val(),\n\t\t};\n\n\t\tsocket.emit('admin.tags.update', data, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tapp.alertSuccess('[[admin/manage/tags:alerts.update-success]]');\n\t\t});\n\t}\n\n\treturn Tags;\n});\n"]}