{"version":3,"sources":["public/src/admin/manage/groups.js"],"names":["define","translator","Groups","intervalId","init","createModal","$","createGroupName","createModalGo","createModalError","handleSearch","on","e","keyCode","click","modal","setTimeout","focus","submitObj","name","val","description","socket","emit","err","hasOwnProperty","utils","hasLanguageKey","message","translateHtml","removeClass","addClass","ajaxify","refresh","el","this","action","attr","groupName","parents","bootbox","confirm","app","alertError","queryEl","doSearch","groupsEl","query","options","sort","groups","templates","parse","html","translate","find","remove","after","clearTimeout"],"mappings":"AAAA,aAGAA,OAAO,uBAAwB,cAAe,SAAUC,GACvD,IAAIC,KAEJ,IAAIC,EAAa,EAEjBD,EAAOE,KAAO,WACb,IAAIC,EAAcC,EAAE,iBACpB,IAAIC,EAAkBD,EAAE,sBACxB,IAAIE,EAAgBF,EAAE,oBACtB,IAAIG,EAAmBH,EAAE,uBAEzBI,IAEAL,EAAYM,GAAG,WAAY,SAAUC,GACpC,GAAIA,EAAEC,UAAY,GAAI,CACrBL,EAAcM,WAIhBR,EAAE,WAAWK,GAAG,QAAS,WACxBN,EAAYU,MAAM,QAClBC,WAAW,WACVT,EAAgBU,SACd,OAGJT,EAAcG,GAAG,QAAS,WACzB,IAAIO,GACHC,KAAMZ,EAAgBa,MACtBC,YAAaf,EAAE,sBAAsBc,OAGtCE,OAAOC,KAAK,sBAAuBL,EAAW,SAAUM,GACvD,GAAIA,EAAK,CACR,GAAIA,EAAIC,eAAe,YAAcC,MAAMC,eAAeH,EAAII,SAAU,CACvEJ,EAAM,gDAEPf,EAAiBoB,cAAcL,GAAKM,YAAY,YAC1C,CACNrB,EAAiBsB,SAAS,QAC1BxB,EAAgBa,IAAI,IACpBf,EAAYM,GAAG,kBAAmB,WACjCqB,QAAQC,YAET5B,EAAYU,MAAM,aAKrBT,EAAE,gBAAgBK,GAAG,QAAS,sBAAuB,WACpD,IAAIuB,EAAK5B,EAAE6B,MACX,IAAIC,EAASF,EAAGG,KAAK,eACrB,IAAIC,EAAYJ,EAAGK,QAAQ,sBAAsBF,KAAK,kBAEtD,OAAQD,GACR,IAAK,SACJI,QAAQC,QAAQ,gDAAiD,SAAUA,GAC1E,GAAIA,EAAS,CACZnB,OAAOC,KAAK,iBACXe,UAAWA,GACT,SAAUd,GACZ,GAAIA,EAAK,CACR,OAAOkB,IAAIC,WAAWnB,EAAII,SAG3BI,QAAQC,eAIX,UAKH,SAASvB,IACR,IAAIkC,EAAUtC,EAAE,iBAEhB,SAASuC,IACR,IAAKD,EAAQxB,MAAO,CACnB,OAAOY,QAAQC,UAEhB3B,EAAE,eAAeyB,SAAS,QAC1B,IAAIe,EAAWxC,EAAE,gBACjBgB,OAAOC,KAAK,iBACXwB,MAAOH,EAAQxB,MACf4B,SACCC,KAAM,SAEL,SAAUzB,EAAK0B,GACjB,GAAI1B,EAAK,CACR,OAAOkB,IAAIC,WAAWnB,EAAII,SAG3BuB,UAAUC,MAAM,sBAAuB,UACtCF,OAAQA,GACN,SAAUG,GACZpD,EAAWqD,UAAUD,EAAM,SAAUA,GACpCP,EAASS,KAAK,oBAAoBC,SAClCV,EAASS,KAAK,MAAME,MAAMJ,SAM9BT,EAAQjC,GAAG,QAAS,WACnB,GAAIR,EAAY,CACfuD,aAAavD,GACbA,EAAa,EAEdA,EAAaa,WAAW6B,EAAU,OAKpC,OAAO3C","file":"public/src/admin/manage/groups.js","sourcesContent":["'use strict';\n\n\ndefine('admin/manage/groups', ['translator'], function (translator) {\n\tvar\tGroups = {};\n\n\tvar intervalId = 0;\n\n\tGroups.init = function () {\n\t\tvar\tcreateModal = $('#create-modal');\n\t\tvar createGroupName = $('#create-group-name');\n\t\tvar createModalGo = $('#create-modal-go');\n\t\tvar createModalError = $('#create-modal-error');\n\n\t\thandleSearch();\n\n\t\tcreateModal.on('keypress', function (e) {\n\t\t\tif (e.keyCode === 13) {\n\t\t\t\tcreateModalGo.click();\n\t\t\t}\n\t\t});\n\n\t\t$('#create').on('click', function () {\n\t\t\tcreateModal.modal('show');\n\t\t\tsetTimeout(function () {\n\t\t\t\tcreateGroupName.focus();\n\t\t\t}, 250);\n\t\t});\n\n\t\tcreateModalGo.on('click', function () {\n\t\t\tvar submitObj = {\n\t\t\t\tname: createGroupName.val(),\n\t\t\t\tdescription: $('#create-group-desc').val(),\n\t\t\t};\n\n\t\t\tsocket.emit('admin.groups.create', submitObj, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tif (err.hasOwnProperty('message') && utils.hasLanguageKey(err.message)) {\n\t\t\t\t\t\terr = '[[admin/manage/groups:alerts.create-failure]]';\n\t\t\t\t\t}\n\t\t\t\t\tcreateModalError.translateHtml(err).removeClass('hide');\n\t\t\t\t} else {\n\t\t\t\t\tcreateModalError.addClass('hide');\n\t\t\t\t\tcreateGroupName.val('');\n\t\t\t\t\tcreateModal.on('hidden.bs.modal', function () {\n\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t});\n\t\t\t\t\tcreateModal.modal('hide');\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.groups-list').on('click', 'button[data-action]', function () {\n\t\t\tvar el = $(this);\n\t\t\tvar action = el.attr('data-action');\n\t\t\tvar groupName = el.parents('tr[data-groupname]').attr('data-groupname');\n\n\t\t\tswitch (action) {\n\t\t\tcase 'delete':\n\t\t\t\tbootbox.confirm('[[admin/manage/groups:alerts.confirm-delete]]', function (confirm) {\n\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\tsocket.emit('groups.delete', {\n\t\t\t\t\t\t\tgroupName: groupName,\n\t\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction handleSearch() {\n\t\tvar queryEl = $('#group-search');\n\n\t\tfunction doSearch() {\n\t\t\tif (!queryEl.val()) {\n\t\t\t\treturn ajaxify.refresh();\n\t\t\t}\n\t\t\t$('.pagination').addClass('hide');\n\t\t\tvar groupsEl = $('.groups-list');\n\t\t\tsocket.emit('groups.search', {\n\t\t\t\tquery: queryEl.val(),\n\t\t\t\toptions: {\n\t\t\t\t\tsort: 'date',\n\t\t\t\t},\n\t\t\t}, function (err, groups) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\ttemplates.parse('admin/manage/groups', 'groups', {\n\t\t\t\t\tgroups: groups,\n\t\t\t\t}, function (html) {\n\t\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\t\tgroupsEl.find('[data-groupname]').remove();\n\t\t\t\t\t\tgroupsEl.find('tr').after(html);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tqueryEl.on('keyup', function () {\n\t\t\tif (intervalId) {\n\t\t\t\tclearTimeout(intervalId);\n\t\t\t\tintervalId = 0;\n\t\t\t}\n\t\t\tintervalId = setTimeout(doSearch, 200);\n\t\t});\n\t}\n\n\n\treturn Groups;\n});\n"]}