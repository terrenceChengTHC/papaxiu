"use strict";define("admin/manage/group",["forum/groups/memberlist","iconSelect","admin/modules/colorpicker","translator"],function(e,a,r,t){var s={};s.init=function(){var s=$("#group-details-search");var i=$("#group-details-search-results");var n=$("#group-icon");var u=$("#change-group-user-title");var o=$("#change-group-label-color");var c=$("#group-label-preview");var d;var l=ajaxify.data.group.name;e.init("admin/manage/group");u.keyup(function(){c.text(u.val())});o.keyup(function(){c.css("background",o.val()||"#000000")});s.on("keyup",function(){if(d){clearTimeout(d)}d=setTimeout(function(){var e=s.val();var a;socket.emit("admin.user.search",{query:e},function(e,r){if(!e&&r&&r.users.length>0){var t=r.users.length;var s;if(t>20){t=20}i.empty();for(s=0;s<t;s+=1){a=$("<li />");a.attr({title:r.users[s].username,"data-uid":r.users[s].uid,"data-username":r.users[s].username,"data-userslug":r.users[s].userslug,"data-picture":r.users[s].picture,"data-usericon-bgColor":r.users[s]["icon:bgColor"],"data-usericon-text":r.users[s]["icon:text"]}).append(r.users[s].picture?$("<img />").addClass("avatar avatar-sm").attr("src",r.users[s].picture):$("<div />").addClass("avatar avatar-sm").css("background-color",r.users[s]["icon:bgColor"]).html(r.users[s]["icon:text"])).append($("<span />").html(r.users[s].username));i.append(a)}}else{i.translateHtml("<li>[[admin/manage/groups:edit.no-users-found]]</li>")}})},200)});i.on("click","li[data-uid]",function(){var e=$(this);var a=parseInt(e.attr("data-uid"),10);socket.emit("admin.groups.join",{groupName:l,uid:a},function(a){if(a){return app.alertError(a.message)}var r={uid:e.attr("data-uid"),username:e.attr("data-username"),userslug:e.attr("data-userslug"),picture:e.attr("data-picture"),"icon:bgColor":e.attr("data-usericon-bgColor"),"icon:text":e.attr("data-usericon-text")};templates.parse("admin/partials/groups/memberlist","members",{group:{isOwner:ajaxify.data.group.isOwner,members:[r]}},function(e){t.translate(e,function(e){$('[component="groups/members"] tbody').prepend(e)})})})});$('[component="groups/members"]').on("click","[data-action]",function(){var e=$(this);var a=e.parents("[data-uid]");var r=a.find(".member-name i");var t=!r.hasClass("invisible");var s=a.attr("data-uid");var i=e.attr("data-action");switch(i){case"toggleOwnership":socket.emit("groups."+(t?"rescind":"grant"),{toUid:s,groupName:l},function(e){if(e){return app.alertError(e.message)}r.toggleClass("invisible")});break;case"kick":bootbox.confirm("[[admin/manage/groups:edit.confirm-remove-user]]",function(e){if(!e){return}socket.emit("admin.groups.leave",{uid:s,groupName:l},function(e){if(e){return app.alertError(e.message)}a.slideUp().remove()})});break;default:break}});$("#group-icon").on("click",function(){a.init(n)});r.enable(o,function(e,a){c.css("background-color","#"+a)});$("#save").on("click",function(){socket.emit("admin.groups.update",{groupName:l,values:{name:$("#change-group-name").val(),userTitle:u.val(),description:$("#change-group-desc").val(),icon:n.attr("value"),labelColor:o.val(),userTitleEnabled:$("#group-userTitleEnabled").is(":checked"),private:$("#group-private").is(":checked"),hidden:$("#group-hidden").is(":checked"),disableJoinRequests:$("#group-disableJoinRequests").is(":checked")}},function(e){if(e){return app.alertError(e.message)}var a=$("#change-group-name").val();if(l===a){app.alertSuccess("[[admin/manage/groups:edit.save-success]]")}else{ajaxify.go("admin/manage/groups/"+encodeURIComponent(a),undefined,true)}});return false})};return s});
//# sourceMappingURL=public/src/admin/manage/group.js.map