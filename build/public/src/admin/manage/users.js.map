{"version":3,"sources":["public/src/admin/manage/users.js"],"names":["define","translator","Users","init","navPills","$","pathname","window","location","find","length","config","relative_path","removeClass","parent","addClass","getSelectedUids","uids","each","this","is","push","attr","update","className","state","parents","toggleClass","unselectAll","prop","removeSelected","remove","done","successMessage","flag","err","app","alertError","message","alertSuccess","on","bootbox","confirm","socket","emit","reason","templates","parse","html","dialog","title","show","buttons","close","label","submit","callback","formData","serializeArray","reduce","data","cur","name","value","until","Date","now","parseInt","unit","indexOf","user","uid","toString","handleUserCreate","onEscape","cancel","create","createUser","call","modal","username","document","getElementById","email","password","passwordAgain","errorEl","translateHtml","ajaxify","refresh","timeoutId","clearTimeout","$this","type","setTimeout","searchBy","query","val","translate","not","first","after","timeago","users","compile","timing","handleInvite","prompt"],"mappings":"AAAA,aAGAA,OAAO,sBAAuB,cAAe,SAAUC,GACtD,IAAIC,KAEJA,EAAMC,KAAO,WACZ,IAAIC,EAAWC,EAAE,iBACjB,IAAIC,EAAWC,OAAOC,SAASF,SAC/B,IAAKF,EAASK,KAAK,WAAaH,EAAW,MAAMI,OAAQ,CACxDJ,EAAWK,OAAOC,cAAgB,6BAEnCR,EAASS,YAAY,UAAUJ,KAAK,WAAaH,EAAW,MAAMQ,SAASC,SAAS,UAEpF,SAASC,IACR,IAAIC,KAEJZ,EAAE,iDAAiDa,KAAK,WACvD,GAAIb,EAAEc,MAAMC,GAAG,YAAa,CAC3BH,EAAKI,KAAKhB,EAAEc,MAAMG,KAAK,gBAIzB,OAAOL,EAGR,SAASM,EAAOC,EAAWC,GAC1BpB,EAAE,yDAAyDqB,QAAQ,aAAajB,KAAKe,GAAWN,KAAK,WACpGb,EAAEc,MAAMQ,YAAY,UAAWF,KAIjC,SAASG,IACRvB,EAAE,iDAAiDwB,KAAK,UAAW,OACnExB,EAAE,8CAA8CwB,KAAK,UAAW,OAGjE,SAASC,IACRzB,EAAE,yDAAyDqB,QAAQ,aAAaK,SAGjF,SAASC,EAAKC,EAAgBT,EAAWU,GACxC,OAAO,SAAUC,GAChB,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BF,IAAIG,aAAaN,GACjB,GAAIT,EAAW,CACdD,EAAOC,EAAWU,GAEnBN,KAIFvB,EAAE,iCAAiCmC,GAAG,QAAS,WAC9C,GAAInC,EAAEc,MAAMC,GAAG,YAAa,CAC3Bf,EAAE,iDAAiDwB,KAAK,UAAW,UAC7D,CACNxB,EAAE,iDAAiDwB,KAAK,UAAW,UAIrExB,EAAE,aAAamC,GAAG,QAAS,WAC1B,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB0B,IAAIC,WAAW,+BACf,OAAO,MAGRI,QAAQC,QAASzB,EAAKP,OAAS,EAAI,kDAAoD,4CAA8C,SAAUgC,GAC9I,GAAIA,EAAS,CACZC,OAAOC,KAAK,iBAAmB3B,KAAMA,EAAM4B,OAAQ,IAAMb,EAAK,4CAA6C,OAAQ,YAKtH3B,EAAE,uBAAuBmC,GAAG,QAAS,WACpC,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB0B,IAAIC,WAAW,+BACf,OAAO,MAGRS,UAAUC,MAAM,kCAAoC,SAAUC,GAC7DP,QAAQQ,QACPzB,UAAW,YACX0B,MAAO,uBACPZ,QAASU,EACTG,KAAM,KACNC,SACCC,OACCC,MAAO,mBACP9B,UAAW,YAEZ+B,QACCD,MAAO,6CAA+CrC,EAAKP,OAAS,KACpE8C,SAAU,WACT,IAAIC,EAAWpD,EAAE,mBAAmBqD,iBAAiBC,OAAO,SAAUC,EAAMC,GAC3ED,EAAKC,EAAIC,MAAQD,EAAIE,MACrB,OAAOH,OAER,IAAII,EAAQP,EAAS/C,OAAUuD,KAAKC,MAAST,EAAS/C,OAAS,IAAO,GAAK,IAAMyD,SAASV,EAASW,KAAM,IAAM,GAAK,GAAO,EAC3HzB,OAAOC,KAAK,iBAAmB3B,KAAMA,EAAM+C,MAAOA,EAAOnB,OAAQY,EAASZ,QAAUb,EAAK,4CAA6C,OAAQ,gBAQpJ3B,EAAE,eAAemC,GAAG,QAAS,WAC5B,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB0B,IAAIC,WAAW,+BACf,OAAO,MAGRM,OAAOC,KAAK,kBAAmB3B,EAAMe,EAAK,8CAA+C,OAAQ,UAGlG3B,EAAE,kBAAkBmC,GAAG,QAAS,WAC/B,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAGDiC,OAAOC,KAAK,2BAA4B3B,EAAMe,EAAK,0DAGpD3B,EAAE,eAAemC,GAAG,QAAS,WAC5B,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAGD,GAAIO,EAAKoD,QAAQjC,IAAIkC,KAAKC,IAAIC,eAAiB,EAAG,CACjDpC,IAAIC,WAAW,8DACT,CACNM,OAAOC,KAAK,wBAAyB3B,EAAMe,EAAK,mDAAoD,iBAAkB,UAIxH3B,EAAE,sBAAsBmC,GAAG,QAAS,WACnC,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAGD,GAAIO,EAAKoD,QAAQjC,IAAIkC,KAAKC,IAAIC,eAAiB,EAAG,CACjDpC,IAAIC,WAAW,8DACT,CACNI,QAAQC,QAAQ,qDAAsD,SAAUA,GAC/E,GAAIA,EAAS,CACZC,OAAOC,KAAK,0BAA2B3B,EAAMe,EAAK,qDAAsD,iBAAkB,cAM9H3B,EAAE,mBAAmBmC,GAAG,QAAS,WAChC,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAGD+B,QAAQC,QAAQ,uDAAwD,SAAUA,GACjF,IAAKA,EAAS,CACb,OAEDC,OAAOC,KAAK,2BAA4B3B,EAAM,SAAUkB,GACvD,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BF,IAAIG,aAAa,wDACjBhB,EAAO,gBAAiB,OACxBA,EAAO,aAAc,MACrBK,UAKHvB,EAAE,0BAA0BmC,GAAG,QAAS,WACvC,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAEDiC,OAAOC,KAAK,iCAAkC3B,EAAM,SAAUkB,GAC7D,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BF,IAAIG,aAAa,4CAInBlC,EAAE,yBAAyBmC,GAAG,QAAS,WACtC,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAGD+B,QAAQC,QAAQ,uDAAwD,SAAUA,GACjF,GAAIA,EAAS,CACZC,OAAOC,KAAK,oCAAqC3B,EAAMe,EAAK,8CAK/D3B,EAAE,gBAAgBmC,GAAG,QAAS,WAC7B,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAGD+B,QAAQC,QAAQ,+CAAgD,SAAUA,GACzE,GAAIA,EAAS,CACZC,OAAOC,KAAK,yBAA0B3B,EAAM,SAAUkB,GACrD,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3BF,IAAIG,aAAa,gDACjBT,IACAF,WAMJvB,EAAE,4BAA4BmC,GAAG,QAAS,WACzC,IAAIvB,EAAOD,IACX,IAAKC,EAAKP,OAAQ,CACjB,OAED+B,QAAQC,QAAQ,8CAA+C,SAAUA,GACxE,GAAIA,EAAS,CACZC,OAAOC,KAAK,mCAAoC3B,EAAM,SAAUkB,GAC/D,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3BF,IAAIG,aAAa,gDACjBT,IACAF,WAMJ,SAAS6C,IACRpE,EAAE,eAAemC,GAAG,QAAS,WAC5BM,UAAUC,MAAM,sCAAwC,SAAUC,GACjEP,QAAQQ,QACPX,QAASU,EACTE,MAAO,uCACPwB,SAAU,KACVtB,SACCuB,QACCrB,MAAO,8CACP9B,UAAW,YAEZoD,QACCtB,MAAO,8CACP9B,UAAW,cACXgC,SAAU,WACTqB,EAAWC,KAAK3D,MAChB,OAAO,eASd,SAAS0D,IACR,IAAIE,EAAQ5D,KACZ,IAAI6D,EAAWC,SAASC,eAAe,oBAAoBnB,MAC3D,IAAIoB,EAAQF,SAASC,eAAe,qBAAqBnB,MACzD,IAAIqB,EAAWH,SAASC,eAAe,wBAAwBnB,MAC/D,IAAIsB,EAAgBJ,SAASC,eAAe,8BAA8BnB,MAE1E,IAAIuB,EAAUjF,EAAE,uBAEhB,GAAI+E,IAAaC,EAAe,CAC/B,OAAOC,EAAQC,cAAc,kGAAkG1E,YAAY,QAG5I,IAAIyD,GACHU,SAAUA,EACVG,MAAOA,EACPC,SAAUA,GAGXzC,OAAOC,KAAK,wBAAyB0B,EAAM,SAAUnC,GACpD,GAAIA,EAAK,CACR,OAAOmD,EAAQC,cAAc,wCAA0CpD,EAAIG,QAAU,MAAMzB,YAAY,QAGxGkE,EAAMA,MAAM,QACZA,EAAMvC,GAAG,kBAAmB,WAC3BgD,QAAQC,YAETrD,IAAIG,aAAa,kDAInB,IAAImD,EAAY,EAEhBrF,EAAE,0DAA0DmC,GAAG,QAAS,WACvE,GAAIkD,IAAc,EAAG,CACpBC,aAAaD,GACbA,EAAY,EAGb,IAAIE,EAAQvF,EAAEc,MACd,IAAI0E,EAAOD,EAAMtE,KAAK,oBAEtBoE,EAAYI,WAAW,WACtBzF,EAAE,eAAeQ,YAAY,UAE7B8B,OAAOC,KAAK,qBAAuBmD,SAAUF,EAAMG,MAAOJ,EAAMK,OAAS,SAAU9D,EAAKyB,GACvF,GAAIzB,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3BQ,UAAUC,MAAM,qBAAsB,QAASa,EAAM,SAAUZ,GAC9D/C,EAAWiG,UAAUlD,EAAM,SAAUA,GACpCA,EAAO3C,EAAE2C,GACT3C,EAAE,mBAAmB8F,IAAI,UAAUpE,SACnC1B,EAAE,mBAAmB+F,QAAQC,MAAMrD,GACnCA,EAAKvC,KAAK,YAAY6F,UACtBjG,EAAE,eAAeU,SAAS,UAE1B,GAAI6C,GAAQA,EAAK2C,MAAM7F,SAAW,EAAG,CACpCL,EAAE,yBAAyBkF,cAAc,2CACvC1E,YAAY,QACZE,SAAS,gBACTF,YAAY,qBACR,CACNR,EAAE,yBAAyBkF,cAActF,EAAWuG,QAAQ,0CAA2C5C,EAAK2C,MAAM7F,OAAQkD,EAAK6C,SAC7H5F,YAAY,QACZE,SAAS,iBACTF,YAAY,wBAKhB,OAGJ4D,IAEAiC,KAGD,SAASA,IACRrG,EAAE,6BAA6BmC,GAAG,QAAS,WAC1CC,QAAQkE,OAAO,6CAA8C,SAAUxB,GACtE,IAAKA,EAAO,CACX,OAGDxC,OAAOC,KAAK,cAAeuC,EAAO,SAAUhD,GAC3C,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BF,IAAIG,aAAa,8CAAgD4C,EAAQ,YAO7E,OAAOjF","file":"public/src/admin/manage/users.js","sourcesContent":["'use strict';\n\n\ndefine('admin/manage/users', ['translator'], function (translator) {\n\tvar Users = {};\n\n\tUsers.init = function () {\n\t\tvar navPills = $('.nav-pills li');\n\t\tvar pathname = window.location.pathname;\n\t\tif (!navPills.find('a[href=\"' + pathname + '\"]').length) {\n\t\t\tpathname = config.relative_path + '/admin/manage/users/latest';\n\t\t}\n\t\tnavPills.removeClass('active').find('a[href=\"' + pathname + '\"]').parent().addClass('active');\n\n\t\tfunction getSelectedUids() {\n\t\t\tvar uids = [];\n\n\t\t\t$('.users-table [component=\"user/select/single\"]').each(function () {\n\t\t\t\tif ($(this).is(':checked')) {\n\t\t\t\t\tuids.push($(this).attr('data-uid'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn uids;\n\t\t}\n\n\t\tfunction update(className, state) {\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').find(className).each(function () {\n\t\t\t\t$(this).toggleClass('hidden', !state);\n\t\t\t});\n\t\t}\n\n\t\tfunction unselectAll() {\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', false);\n\t\t\t$('.users-table [component=\"user/select/all\"]').prop('checked', false);\n\t\t}\n\n\t\tfunction removeSelected() {\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').remove();\n\t\t}\n\n\t\tfunction done(successMessage, className, flag) {\n\t\t\treturn function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess(successMessage);\n\t\t\t\tif (className) {\n\t\t\t\t\tupdate(className, flag);\n\t\t\t\t}\n\t\t\t\tunselectAll();\n\t\t\t};\n\t\t}\n\n\t\t$('[component=\"user/select/all\"]').on('click', function () {\n\t\t\tif ($(this).is(':checked')) {\n\t\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', true);\n\t\t\t} else {\n\t\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', false);\n\t\t\t}\n\t\t});\n\n\t\t$('.ban-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tbootbox.confirm((uids.length > 1 ? '[[admin/manage/users:alerts.confirm-ban-multi]]' : '[[admin/manage/users:alerts.confirm-ban]]'), function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, reason: '' }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.ban-user-temporary').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\ttemplates.parse('admin/partials/temporary-ban', {}, function (html) {\n\t\t\t\tbootbox.dialog({\n\t\t\t\t\tclassName: 'ban-modal',\n\t\t\t\t\ttitle: '[[user:ban_account]]',\n\t\t\t\t\tmessage: html,\n\t\t\t\t\tshow: true,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tclose: {\n\t\t\t\t\t\t\tlabel: '[[global:close]]',\n\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsubmit: {\n\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-ban-x, ' + uids.length + ']]',\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tvar formData = $('.ban-modal form').serializeArray().reduce(function (data, cur) {\n\t\t\t\t\t\t\t\t\tdata[cur.name] = cur.value;\n\t\t\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t\t\tvar until = formData.length ? (Date.now() + (formData.length * 1000 * 60 * 60 * (parseInt(formData.unit, 10) ? 24 : 1))) : 0;\n\t\t\t\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, until: until, reason: formData.reason }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.unban-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tsocket.emit('user.unbanUsers', uids, done('[[admin/manage/users:alerts.unban-success]]', '.ban', false));\n\t\t});\n\n\t\t$('.reset-lockout').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsocket.emit('admin.user.resetLockouts', uids, done('[[admin/manage/users:alerts.lockout-reset-success]]'));\n\t\t});\n\n\t\t$('.admin-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (uids.indexOf(app.user.uid.toString()) !== -1) {\n\t\t\t\tapp.alertError('[[admin/manage/users:alerts.no-remove-yourself-admin]]');\n\t\t\t} else {\n\t\t\t\tsocket.emit('admin.user.makeAdmins', uids, done('[[admin/manage/users:alerts.make-admin-success]]', '.administrator', true));\n\t\t\t}\n\t\t});\n\n\t\t$('.remove-admin-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (uids.indexOf(app.user.uid.toString()) !== -1) {\n\t\t\t\tapp.alertError('[[admin/manage/users:alerts.no-remove-yourself-admin]]');\n\t\t\t} else {\n\t\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-remove-admin]]', function (confirm) {\n\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\tsocket.emit('admin.user.removeAdmins', uids, done('[[admin/manage/users:alerts.remove-admin-success]]', '.administrator', false));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$('.validate-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-validate-email]]', function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsocket.emit('admin.user.validateEmail', uids, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.validate-email-success]]');\n\t\t\t\t\tupdate('.notvalidated', false);\n\t\t\t\t\tupdate('.validated', true);\n\t\t\t\t\tunselectAll();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.send-validation-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsocket.emit('admin.user.sendValidationEmail', uids, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\n\t\t\t});\n\t\t});\n\n\t\t$('.password-reset-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.password-reset-confirm]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.sendPasswordResetEmail', uids, done('[[notifications:email-confirm-sent]]'));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-delete]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsers', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\n\t\t\t\t\t\tremoveSelected();\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user-and-content').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-purge]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsersAndContent', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\n\t\t\t\t\t\tremoveSelected();\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tfunction handleUserCreate() {\n\t\t\t$('#createUser').on('click', function () {\n\t\t\t\ttemplates.parse('admin/partials/create_user_modal', {}, function (html) {\n\t\t\t\t\tbootbox.dialog({\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\ttitle: '[[admin/manage/users:alerts.create]]',\n\t\t\t\t\t\tonEscape: true,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tcancel: {\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-cancel]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-create]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\t\tcreateUser.call(this);\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction createUser() {\n\t\t\tvar modal = this;\n\t\t\tvar username = document.getElementById('create-user-name').value;\n\t\t\tvar email = document.getElementById('create-user-email').value;\n\t\t\tvar password = document.getElementById('create-user-password').value;\n\t\t\tvar passwordAgain = document.getElementById('create-user-password-again').value;\n\n\t\t\tvar errorEl = $('#create-modal-error');\n\n\t\t\tif (password !== passwordAgain) {\n\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]').removeClass('hide');\n\t\t\t}\n\n\t\t\tvar user = {\n\t\t\t\tusername: username,\n\t\t\t\temail: email,\n\t\t\t\tpassword: password,\n\t\t\t};\n\n\t\t\tsocket.emit('admin.user.createUser', user, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, ' + err.message + ']]').removeClass('hide');\n\t\t\t\t}\n\n\t\t\t\tmodal.modal('hide');\n\t\t\t\tmodal.on('hidden.bs.modal', function () {\n\t\t\t\t\tajaxify.refresh();\n\t\t\t\t});\n\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.create-success]]');\n\t\t\t});\n\t\t}\n\n\t\tvar timeoutId = 0;\n\n\t\t$('#search-user-name, #search-user-email, #search-user-ip').on('keyup', function () {\n\t\t\tif (timeoutId !== 0) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\n\t\t\tvar $this = $(this);\n\t\t\tvar type = $this.attr('data-search-type');\n\n\t\t\ttimeoutId = setTimeout(function () {\n\t\t\t\t$('.fa-spinner').removeClass('hidden');\n\n\t\t\t\tsocket.emit('admin.user.search', { searchBy: type, query: $this.val() }, function (err, data) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\n\t\t\t\t\ttemplates.parse('admin/manage/users', 'users', data, function (html) {\n\t\t\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\t\t\thtml = $(html);\n\t\t\t\t\t\t\t$('.users-table tr').not(':first').remove();\n\t\t\t\t\t\t\t$('.users-table tr').first().after(html);\n\t\t\t\t\t\t\thtml.find('.timeago').timeago();\n\t\t\t\t\t\t\t$('.fa-spinner').addClass('hidden');\n\n\t\t\t\t\t\t\tif (data && data.users.length === 0) {\n\t\t\t\t\t\t\t\t$('#user-notfound-notify').translateHtml('[[admin/manage/users:search.not-found]]')\n\t\t\t\t\t\t\t\t\t.removeClass('hide')\n\t\t\t\t\t\t\t\t\t.addClass('label-danger')\n\t\t\t\t\t\t\t\t\t.removeClass('label-success');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#user-notfound-notify').translateHtml(translator.compile('admin/manage/users:alerts.x-users-found', data.users.length, data.timing))\n\t\t\t\t\t\t\t\t\t.removeClass('hide')\n\t\t\t\t\t\t\t\t\t.addClass('label-success')\n\t\t\t\t\t\t\t\t\t.removeClass('label-danger');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, 250);\n\t\t});\n\n\t\thandleUserCreate();\n\n\t\thandleInvite();\n\t};\n\n\tfunction handleInvite() {\n\t\t$('[component=\"user/invite\"]').on('click', function () {\n\t\t\tbootbox.prompt('[[admin/manage/users:alerts.prompt-email]]', function (email) {\n\t\t\t\tif (!email) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit('user.invite', email, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.email-sent-to, ' + email + ']]');\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\n\treturn Users;\n});\n"]}