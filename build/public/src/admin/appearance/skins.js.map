{"version":3,"sources":["public/src/admin/appearance/skins.js"],"names":["define","translator","Skins","init","$","ajax","method","url","done","render","on","e","target","attr","parents","action","parentEl","themeType","cssSrc","themeId","socket","emit","type","id","src","err","app","alertError","message","highlightSelectedTheme","alert","alert_id","title","timeout","bootswatch","themeContainer","templates","parse","themes","map","theme","name","description","screenshot_url","thumbnail","preview","css","cssCdn","skin","showRevert","html","translate","config","match","replace","m","p1","p2","toUpperCase","text","split","select","current","removeClass","find","each","this","addClass"],"mappings":"AAAA,aAGAA,OAAO,0BAA2B,cAAe,SAAUC,GAC1D,IAAIC,KAEJA,EAAMC,KAAO,WAEZC,EAAEC,MACDC,OAAQ,MACRC,IAAK,sCACHC,KAAKN,EAAMO,QAEdL,EAAE,UAAUM,GAAG,QAAS,SAAUC,GACjC,IAAIC,EAASR,EAAEO,EAAEC,QAEjB,IAAKA,EAAOC,KAAK,eAAgB,CAChCD,EAASA,EAAOE,QAAQ,iBAGzB,IAAIC,EAASH,EAAOC,KAAK,eAEzB,GAAIE,GAAUA,IAAW,MAAO,CAC/B,IAAIC,EAAWJ,EAAOE,QAAQ,gBAC9B,IAAIG,EAAYD,EAASH,KAAK,aAC9B,IAAIK,EAASF,EAASH,KAAK,YAC3B,IAAIM,EAAUH,EAASH,KAAK,cAG5BO,OAAOC,KAAK,oBACXC,KAAML,EACNM,GAAIJ,EACJK,IAAKN,GACH,SAAUO,GACZ,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BC,EAAuBV,GAEvBO,IAAII,OACHC,SAAU,cACVT,KAAM,OACNU,MAAO,0CACPJ,QAAST,EAAW,6CAA+CA,EAAU,KAAQ,4CACrFc,QAAS,YAOd/B,EAAMO,OAAS,SAAUyB,GACxB,IAAIC,EAAiB/B,EAAE,qBAEvBgC,UAAUC,MAAM,6BACfC,OAAQJ,EAAWI,OAAOC,IAAI,SAAUC,GACvC,OACClB,KAAM,aACNC,GAAIiB,EAAMC,KACVA,KAAMD,EAAMC,KACZC,YAAaF,EAAME,YACnBC,eAAgBH,EAAMI,UACtBrC,IAAKiC,EAAMK,QACXC,IAAKN,EAAMO,OACXC,KAAM,QAGRC,WAAY,MACV,SAAUC,GACZjD,EAAWkD,UAAUD,EAAM,SAAUA,GACpCf,EAAee,KAAKA,GAEpB,GAAIE,OAAO,aAAc,CACxB,IAAIJ,EAAOI,OAAO,aACjBC,MAAM,oCAAoC,GAC1CC,QAAQ,iBAAkB,SAAUC,EAAGC,EAAIC,GAAM,OAAOD,EAAKC,EAAGC,gBAEjE7B,EAAuBmB,SAM3B,SAASnB,EAAuBV,GAC/BlB,EAAWkD,UAAU,sFAAuF,SAAUQ,GACrHA,EAAOA,EAAKC,MAAM,UAClB,IAAIC,EAASF,EAAK,GAClB,IAAIG,EAAUH,EAAK,GAEnBvD,EAAE,gBACA2D,YAAY,YACZC,KAAK,uBAAuBC,KAAK,WACjC,GAAI7D,EAAE8D,MAAMpD,QAAQ,gBAAgBD,KAAK,cAAe,CACvDT,EAAE8D,MACAhB,KAAKW,GACLE,YAAY,eACZI,SAAS,kBAId,IAAKhD,EAAS,CACb,OAGDf,EAAE,gBAAkBe,EAAU,MAC5BgD,SAAS,YACTH,KAAK,uBACJd,KAAKY,GACLC,YAAY,eACZI,SAAS,iBAId,OAAOjE","file":"public/src/admin/appearance/skins.js","sourcesContent":["'use strict';\n\n\ndefine('admin/appearance/skins', ['translator'], function (translator) {\n\tvar Skins = {};\n\n\tSkins.init = function () {\n\t\t// Populate skins from Bootswatch API\n\t\t$.ajax({\n\t\t\tmethod: 'get',\n\t\t\turl: 'https://bootswatch.com/api/3.json',\n\t\t}).done(Skins.render);\n\n\t\t$('#skins').on('click', function (e) {\n\t\t\tvar target = $(e.target);\n\n\t\t\tif (!target.attr('data-action')) {\n\t\t\t\ttarget = target.parents('[data-action]');\n\t\t\t}\n\n\t\t\tvar action = target.attr('data-action');\n\n\t\t\tif (action && action === 'use') {\n\t\t\t\tvar parentEl = target.parents('[data-theme]');\n\t\t\t\tvar themeType = parentEl.attr('data-type');\n\t\t\t\tvar cssSrc = parentEl.attr('data-css');\n\t\t\t\tvar themeId = parentEl.attr('data-theme');\n\n\n\t\t\t\tsocket.emit('admin.themes.set', {\n\t\t\t\t\ttype: themeType,\n\t\t\t\t\tid: themeId,\n\t\t\t\t\tsrc: cssSrc,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\thighlightSelectedTheme(themeId);\n\n\t\t\t\t\tapp.alert({\n\t\t\t\t\t\talert_id: 'admin:theme',\n\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\ttitle: '[[admin/appearance/skins:skin-updated]]',\n\t\t\t\t\t\tmessage: themeId ? ('[[admin/appearance/skins:applied-success, ' + themeId + ']]') : '[[admin/appearance/skins:revert-success]]',\n\t\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tSkins.render = function (bootswatch) {\n\t\tvar themeContainer = $('#bootstrap_themes');\n\n\t\ttemplates.parse('admin/partials/theme_list', {\n\t\t\tthemes: bootswatch.themes.map(function (theme) {\n\t\t\t\treturn {\n\t\t\t\t\ttype: 'bootswatch',\n\t\t\t\t\tid: theme.name,\n\t\t\t\t\tname: theme.name,\n\t\t\t\t\tdescription: theme.description,\n\t\t\t\t\tscreenshot_url: theme.thumbnail,\n\t\t\t\t\turl: theme.preview,\n\t\t\t\t\tcss: theme.cssCdn,\n\t\t\t\t\tskin: true,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tshowRevert: true,\n\t\t}, function (html) {\n\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\tthemeContainer.html(html);\n\n\t\t\t\tif (config['theme:src']) {\n\t\t\t\t\tvar skin = config['theme:src']\n\t\t\t\t\t.match(/latest\\/(\\S+)\\/bootstrap.min.css/)[1]\n\t\t\t\t\t.replace(/(^|\\s)([a-z])/g, function (m, p1, p2) { return p1 + p2.toUpperCase(); });\n\n\t\t\t\t\thighlightSelectedTheme(skin);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction highlightSelectedTheme(themeId) {\n\t\ttranslator.translate('[[admin/appearance/skins:select-skin]]  ||  [[admin/appearance/skins:current-skin]]', function (text) {\n\t\t\ttext = text.split('  ||  ');\n\t\t\tvar select = text[0];\n\t\t\tvar current = text[1];\n\n\t\t\t$('[data-theme]')\n\t\t\t\t.removeClass('selected')\n\t\t\t\t.find('[data-action=\"use\"]').each(function () {\n\t\t\t\t\tif ($(this).parents('[data-theme]').attr('data-theme')) {\n\t\t\t\t\t\t$(this)\n\t\t\t\t\t\t\t.html(select)\n\t\t\t\t\t\t\t.removeClass('btn-success')\n\t\t\t\t\t\t\t.addClass('btn-primary');\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tif (!themeId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$('[data-theme=\"' + themeId + '\"]')\n\t\t\t\t.addClass('selected')\n\t\t\t\t.find('[data-action=\"use\"]')\n\t\t\t\t\t.html(current)\n\t\t\t\t\t.removeClass('btn-primary')\n\t\t\t\t\t.addClass('btn-success');\n\t\t});\n\t}\n\n\treturn Skins;\n});\n"]}