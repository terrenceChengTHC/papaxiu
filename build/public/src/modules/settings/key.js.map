{"version":3,"sources":["public/src/modules/settings/key.js"],"names":["define","SettingsKey","helper","lastKey","oldKey","keyMap","Object","freeze","0","8","9","13","27","32","37","38","39","40","45","46","187","189","190","191","219","220","221","Key","this","c","a","s","m","code","char","getKey","event","anyModChange","ctrlKey","altKey","shiftKey","metaKey","modChange","key","which","convertKeyCodeToChar","String","fromCharCode","toUpperCase","getKeyString","human","short","separator","str","test","out","getKeyFromString","sep","exec","parts","split","i","length","part","num","handleEvent","element","window","keyCode","set","types","use","init","focus","data","keydown","preventDefault","keyup","value","removeClass","addClass","val","get","trim","empty","isFalse"],"mappings":"AAAA,aAEAA,OAAO,eAAgB,WACtB,IAAIC,EACJ,IAAIC,EAAS,KACb,IAAIC,EAAU,KACd,IAAIC,EAAS,KACb,IAAIC,EAASC,OAAOC,QACnBC,EAAG,GACHC,EAAG,YACHC,EAAG,MACHC,GAAI,QACJC,GAAI,SACJC,GAAI,QACJC,GAAI,OACJC,GAAI,KACJC,GAAI,QACJC,GAAI,OACJC,GAAI,SACJC,GAAI,SACJC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,KACLC,IAAK,MAGN,SAASC,IACRC,KAAKC,EAAI,MACTD,KAAKE,EAAI,MACTF,KAAKG,EAAI,MACTH,KAAKI,EAAI,MACTJ,KAAKK,KAAO,EACZL,KAAKM,KAAO,GAQb,SAASC,EAAOC,GACf,IAAIC,EAAeD,EAAME,UAAYnC,EAAQ0B,GAAKO,EAAMG,SAAWpC,EAAQ2B,GAAKM,EAAMI,WAAarC,EAAQ4B,GAAKK,EAAMK,UAAYtC,EAAQ6B,EAC1I,IAAIU,EAAYN,EAAME,QAAUF,EAAMG,OAASH,EAAMI,SAAWJ,EAAMK,QAAUtC,EAAQ0B,EAAI1B,EAAQ2B,EAAI3B,EAAQ4B,EAAI5B,EAAQ6B,EAC5H,IAAIW,EAAM,IAAIhB,EACdgB,EAAId,EAAIO,EAAME,QACdK,EAAIb,EAAIM,EAAMG,OACdI,EAAIZ,EAAIK,EAAMI,SACdG,EAAIX,EAAII,EAAMK,QACdtC,EAAUwC,EACV,GAAIN,EAAc,CACjB,GAAIK,EAAY,EAAG,CAClB,OAAO,KAERC,EAAIV,KAAO7B,EAAO6B,KAClBU,EAAIT,KAAO9B,EAAO8B,SACZ,CACNS,EAAIV,KAAOG,EAAMQ,MACjBD,EAAIT,KAAOW,EAAqBF,EAAIV,MAErC7B,EAASuC,EACT,OAAOA,EAQR,SAASE,EAAqBZ,GAC7BA,GAAQA,EACR,GAAIA,IAAS,EAAG,CACf,MAAO,QACD,GAAIA,GAAQ,IAAMA,GAAQ,GAAI,CACpC,OAAOa,OAAOC,aAAad,GAAMe,mBAC3B,GAAIf,GAAQ,KAAOA,GAAQ,IAAK,CACtC,MAAO,KAAOA,EAAO,KAEtB,OAAO5B,EAAO4B,IAAU,IAAMA,EAW/B,SAASgB,EAAaN,EAAKO,EAAOC,EAAOC,GACxC,IAAIC,EAAM,GACV,KAAMV,aAAehB,GAAM,CAC1B,OAAO0B,EAER,IAAKV,EAAIT,KAAM,CACd,GAAIgB,EAAO,CACV,MAAO,cAER,MAAO,GAER,IAAKE,GAAa,gBAAgBE,KAAKF,GAAY,CAClDA,EAAYF,EAAQ,MAAQ,IAE7B,GAAIP,EAAId,EAAG,CACVwB,IAAQF,EAAQ,IAAM,QAAUC,EAEjC,GAAIT,EAAIb,EAAG,CACVuB,IAAQF,EAAQ,IAAM,OAASC,EAEhC,GAAIT,EAAIZ,EAAG,CACVsB,IAAQF,EAAQ,IAAM,SAAWC,EAElC,GAAIT,EAAIX,EAAG,CACVqB,IAAQF,EAAQ,IAAM,QAAUC,EAGjC,IAAIG,EACJ,GAAIL,EAAO,CACVK,EAAMZ,EAAIT,UACJ,GAAIS,EAAIV,KAAM,CACpBsB,EAAM,IAAMZ,EAAIV,MAAQ,GAGzB,OAAOoB,EAAME,EAQd,SAASC,EAAiBH,GACzB,GAAIA,aAAe1B,EAAK,CACvB,OAAO0B,EAER,IAAIV,EAAM,IAAIhB,EACd,IAAI8B,EAAM,gCAAgCC,KAAKL,GAC/C,IAAIM,EAAQF,GAAO,KAAOJ,EAAIO,MAAMH,EAAI,KAAOJ,GAC/C,IAAK,IAAIQ,EAAI,EAAGA,EAAIF,EAAMG,OAAQD,GAAK,EAAG,CACzC,IAAIE,EAAOJ,EAAME,GACjB,OAAQE,GACR,IAAK,IACL,IAAK,OACJpB,EAAId,EAAI,KACR,MACD,IAAK,IACL,IAAK,MACJc,EAAIb,EAAI,KACR,MACD,IAAK,IACL,IAAK,QACJa,EAAIZ,EAAI,KACR,MACD,IAAK,IACL,IAAK,OACJY,EAAIX,EAAI,KACR,MACD,QACC,IAAIgC,EAAM,MAAMN,KAAKK,GACrB,GAAIC,GAAO,KAAM,CAChBrB,EAAIV,KAAO+B,EAAI,GAEhBrB,EAAIT,KAAOW,EAAqBF,EAAIV,OAGtC,OAAOU,EAGR,SAASsB,EAAYC,EAAS9B,GAC7BA,EAAQA,GAAS+B,OAAO/B,MACxBA,EAAMQ,MAAQR,EAAMQ,OAASR,EAAMgC,SAAWhC,EAAMO,IACpD,IAAIA,EAAMR,EAAOC,GACjB,GAAIO,GAAO,KAAM,CAChB1C,EAAYoE,IAAIH,EAASvB,IAK3B1C,GACCqE,OAAQ,OACRC,IAAK,WACJrE,EAAS0B,KAAK1B,QAEfsE,KAAM,SAAUN,GACfA,EAAQO,MAAM,WACbrE,EAAS8D,EAAQQ,KAAK,YAAc,IAAI/C,EACxCxB,EAAU,IAAIwB,IACZgD,QAAQ,SAAUvC,GACpBA,EAAMwC,iBACNX,EAAYC,EAAS9B,KACnByC,MAAM,SAAUzC,GAClB6B,EAAYC,EAAS9B,KAEtB,OAAO8B,GAERG,IAAK,SAAUH,EAASY,GACvB,IAAInC,EAAMa,EAAiBsB,GAAS,IACpCZ,EAAQQ,KAAK,UAAW/B,GACxB,GAAIA,EAAIV,KAAM,CACbiC,EAAQa,YAAY,oBACd,CACNb,EAAQc,SAAS,gBAElBd,EAAQe,IAAIhC,EAAaN,EAAK,KAAM,MAAO,SAE5CuC,IAAK,SAAUhB,EAASiB,EAAMC,GAC7B,IAAIzC,EAAMuB,EAAQQ,KAAK,WACvB,IAAItB,EAAYc,EAAQQ,KAAK,UAAYR,EAAQQ,KAAK,cAAgB,IACtE,IAAIvB,GAASjD,EAAOmF,QAAQnB,EAAQQ,KAAK,UACzC,GAAIS,EAAM,CACT,GAAIC,GAAUzC,GAAO,MAAQA,EAAIT,KAAO,CACvC,OAAOe,EAAaN,EAAK,MAAOQ,EAAOC,SAElC,GAAIgC,GAAUzC,GAAO,MAAQA,EAAIV,KAAO,CAC9C,OAAOU,KAKV,OAAO1C","file":"public/src/modules/settings/key.js","sourcesContent":["'use strict';\n\ndefine('settings/key', function () {\n\tvar SettingsKey;\n\tvar helper = null;\n\tvar lastKey = null;\n\tvar oldKey = null;\n\tvar keyMap = Object.freeze({\n\t\t0: '',\n\t\t8: 'Backspace',\n\t\t9: 'Tab',\n\t\t13: 'Enter',\n\t\t27: 'Escape',\n\t\t32: 'Space',\n\t\t37: 'Left',\n\t\t38: 'Up',\n\t\t39: 'Right',\n\t\t40: 'Down',\n\t\t45: 'Insert',\n\t\t46: 'Delete',\n\t\t187: '=',\n\t\t189: '-',\n\t\t190: '.',\n\t\t191: '/',\n\t\t219: '[',\n\t\t220: '\\\\',\n\t\t221: ']',\n\t});\n\n\tfunction Key() {\n\t\tthis.c = false;\n\t\tthis.a = false;\n\t\tthis.s = false;\n\t\tthis.m = false;\n\t\tthis.code = 0;\n\t\tthis.char = '';\n\t}\n\n\t/**\n\t Returns either a Key-Object representing the given event or null if only modification-keys got released.\n\t @param event The event to inspect.\n\t @returns Key | null The Key-Object the focused element should be set to.\n\t */\n\tfunction getKey(event) {\n\t\tvar anyModChange = event.ctrlKey !== lastKey.c || event.altKey !== lastKey.a || event.shiftKey !== lastKey.s || event.metaKey !== lastKey.m;\n\t\tvar modChange = event.ctrlKey + event.altKey + event.shiftKey + event.metaKey - lastKey.c - lastKey.a - lastKey.s - lastKey.m;\n\t\tvar key = new Key();\n\t\tkey.c = event.ctrlKey;\n\t\tkey.a = event.altKey;\n\t\tkey.s = event.shiftKey;\n\t\tkey.m = event.metaKey;\n\t\tlastKey = key;\n\t\tif (anyModChange) {\n\t\t\tif (modChange < 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tkey.code = oldKey.code;\n\t\t\tkey.char = oldKey.char;\n\t\t} else {\n\t\t\tkey.code = event.which;\n\t\t\tkey.char = convertKeyCodeToChar(key.code);\n\t\t}\n\t\toldKey = key;\n\t\treturn key;\n\t}\n\n\t/**\n\t Returns the string that represents the given key-code.\n\t @param code The key-code.\n\t @returns String Representation of the given key-code.\n\t */\n\tfunction convertKeyCodeToChar(code) {\n\t\tcode = +code;\n\t\tif (code === 0) {\n\t\t\treturn '';\n\t\t} else if (code >= 48 && code <= 90) {\n\t\t\treturn String.fromCharCode(code).toUpperCase();\n\t\t} else if (code >= 112 && code <= 123) {\n\t\t\treturn 'F' + (code - 111);\n\t\t}\n\t\treturn keyMap[code] || ('#' + code);\n\t}\n\n\t/**\n\t Returns a string to identify a Key-Object.\n\t @param key The Key-Object that should get identified.\n\t @param human Whether to show 'Enter a key' when key-char is empty.\n\t @param short Whether to shorten modification-names to first character.\n\t @param separator The separator between modification-names and key-char.\n\t @returns String The string to identify the given key-object the given way.\n\t */\n\tfunction getKeyString(key, human, short, separator) {\n\t\tvar str = '';\n\t\tif (!(key instanceof Key)) {\n\t\t\treturn str;\n\t\t}\n\t\tif (!key.char) {\n\t\t\tif (human) {\n\t\t\t\treturn 'Enter a key';\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\t\tif (!separator || /CtrlAShifMea#/.test(separator)) {\n\t\t\tseparator = human ? ' + ' : '+';\n\t\t}\n\t\tif (key.c) {\n\t\t\tstr += (short ? 'C' : 'Ctrl') + separator;\n\t\t}\n\t\tif (key.a) {\n\t\t\tstr += (short ? 'A' : 'Alt') + separator;\n\t\t}\n\t\tif (key.s) {\n\t\t\tstr += (short ? 'S' : 'Shift') + separator;\n\t\t}\n\t\tif (key.m) {\n\t\t\tstr += (short ? 'M' : 'Meta') + separator;\n\t\t}\n\n\t\tvar out;\n\t\tif (human) {\n\t\t\tout = key.char;\n\t\t} else if (key.code) {\n\t\t\tout = '#' + key.code || '';\n\t\t}\n\n\t\treturn str + out;\n\t}\n\n\t/**\n\t Parses the given string into a Key-Object.\n\t @param str The string to parse.\n\t @returns Key The Key-Object that got identified by the given string.\n\t */\n\tfunction getKeyFromString(str) {\n\t\tif (str instanceof Key) {\n\t\t\treturn str;\n\t\t}\n\t\tvar key = new Key();\n\t\tvar sep = /([^CtrlAShifMea#\\d]+)(?:#|\\d)/.exec(str);\n\t\tvar parts = sep != null ? str.split(sep[1]) : [str];\n\t\tfor (var i = 0; i < parts.length; i += 1) {\n\t\t\tvar part = parts[i];\n\t\t\tswitch (part) {\n\t\t\tcase 'C':\n\t\t\tcase 'Ctrl':\n\t\t\t\tkey.c = true;\n\t\t\t\tbreak;\n\t\t\tcase 'A':\n\t\t\tcase 'Alt':\n\t\t\t\tkey.a = true;\n\t\t\t\tbreak;\n\t\t\tcase 'S':\n\t\t\tcase 'Shift':\n\t\t\t\tkey.s = true;\n\t\t\t\tbreak;\n\t\t\tcase 'M':\n\t\t\tcase 'Meta':\n\t\t\t\tkey.m = true;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvar num = /\\d+/.exec(part);\n\t\t\t\tif (num != null) {\n\t\t\t\t\tkey.code = num[0];\n\t\t\t\t}\n\t\t\t\tkey.char = convertKeyCodeToChar(key.code);\n\t\t\t}\n\t\t}\n\t\treturn key;\n\t}\n\n\tfunction handleEvent(element, event) {\n\t\tevent = event || window.event;\n\t\tevent.which = event.which || event.keyCode || event.key;\n\t\tvar key = getKey(event);\n\t\tif (key != null) {\n\t\t\tSettingsKey.set(element, key);\n\t\t}\n\t}\n\n\n\tSettingsKey = {\n\t\ttypes: ['key'],\n\t\tuse: function () {\n\t\t\thelper = this.helper;\n\t\t},\n\t\tinit: function (element) {\n\t\t\telement.focus(function () {\n\t\t\t\toldKey = element.data('keyData') || new Key();\n\t\t\t\tlastKey = new Key();\n\t\t\t}).keydown(function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\thandleEvent(element, event);\n\t\t\t}).keyup(function (event) {\n\t\t\t\thandleEvent(element, event);\n\t\t\t});\n\t\t\treturn element;\n\t\t},\n\t\tset: function (element, value) {\n\t\t\tvar key = getKeyFromString(value || '');\n\t\t\telement.data('keyData', key);\n\t\t\tif (key.code) {\n\t\t\t\telement.removeClass('alert-danger');\n\t\t\t} else {\n\t\t\t\telement.addClass('alert-danger');\n\t\t\t}\n\t\t\telement.val(getKeyString(key, true, false, ' + '));\n\t\t},\n\t\tget: function (element, trim, empty) {\n\t\t\tvar key = element.data('keyData');\n\t\t\tvar separator = element.data('split') || element.data('separator') || '+';\n\t\t\tvar short = !helper.isFalse(element.data('short'));\n\t\t\tif (trim) {\n\t\t\t\tif (empty || (key != null && key.char)) {\n\t\t\t\t\treturn getKeyString(key, false, short, separator);\n\t\t\t\t}\n\t\t\t} else if (empty || (key != null && key.code)) {\n\t\t\t\treturn key;\n\t\t\t}\n\t\t},\n\t};\n\n\treturn SettingsKey;\n});\n"]}