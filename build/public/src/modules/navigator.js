"use strict";define("navigator",["forum/pagination","components"],function(o,t){var n={};var e=1;var a=0;var i=0;n.scrollActive=false;n.init=function(o,t,a,i,r,c){e=1;n.selector=o;n.callback=r;a=a||function(){};i=i||function(){};$(window).off("scroll",n.delayedUpdate).on("scroll",n.delayedUpdate);$(".pagination-block .dropdown-menu").off("click").on("click",function(o){o.stopPropagation()});$(".pagination-block").off("shown.bs.dropdown",".dropdown").on("shown.bs.dropdown",".dropdown",function(){setTimeout(function(){$(".pagination-block input").focus()},100)});$(".pagination-block .pageup").off("click").on("click",n.scrollUp);$(".pagination-block .pagedown").off("click").on("click",n.scrollDown);$(".pagination-block .pagetop").off("click").on("click",a);$(".pagination-block .pagebottom").off("click").on("click",i);$(".pagination-block input").on("keydown",function(o){if(o.which===13){var n=$(this);if(!utils.isNumber(n.val())){n.val("");return}var e=parseInt(n.val(),10);if(typeof c==="function"){e=c(e,t)}var a=l(e);n.val("");$(".pagination-block .dropdown-toggle").trigger("click");ajaxify.go(a)}});n.setCount(t);n.update(0)};function l(o){var t=window.location.pathname.replace(config.relative_path,"");var n=t.split("/");return n[1]+"/"+n[2]+"/"+n[3]+(o?"/"+o:"")}n.setCount=function(o){a=parseInt(o,10);n.updateTextAndProgressBar()};n.show=function(){r(true)};n.disable=function(){a=0;e=1;n.callback=null;n.selector=null;$(window).off("scroll",n.delayedUpdate);r(false)};function r(o){var t=ajaxify.removeRelativePath(window.location.pathname.slice(1));if(o&&(!t.startsWith("topic")&&!t.startsWith("category"))){return}$(".pagination-block").toggleClass("ready",o)}n.delayedUpdate=function(){if(i){clearTimeout(i);i=0}i=setTimeout(n.update,100)};n.update=function(o){o=typeof o==="number"?o:undefined;var i=$(n.selector);if(i.length){e=parseInt(i.first().attr("data-index"),10)+1}var l=$(window).scrollTop();var c=$(window).height();var s=$(document).height();var f=l+c/2;var d=Number.MAX_VALUE;i.each(function(){var o=Math.abs(f-$(this).offset().top);if(o>d){return false}if(o<d){e=parseInt($(this).attr("data-index"),10)+1;d=o}});var p=l===0&&parseInt(i.first().attr("data-index"),10)===0;var u=l+c>s-100&&parseInt(i.last().attr("data-index"),10)===a-1;if(p){e=1}else if(u){e=a}if(o===undefined&&ajaxify.data.template.topic===true){if(p){o=0}else{var g=t.get("post/anchor",e-1);if(g.length){var h=g.get(0).getBoundingClientRect();o=h.top}}}if(typeof n.callback==="function"){n.callback(e,a,o)}n.updateTextAndProgressBar();r(!!a)};n.updateTextAndProgressBar=function(){if(!utils.isNumber(e)){return}e=e>a?a:e;$(".pagination-block .pagination-text").translateHtml("[[global:pagination.out_of, "+e+", "+a+"]]");$(".pagination-block .progress-bar").width(e/a*100+"%")};n.scrollUp=function(){$("body,html").animate({scrollTop:$(window).scrollTop()-$(window).height()})};n.scrollDown=function(){$("body,html").animate({scrollTop:$(window).scrollTop()+$(window).height()})};n.scrollTop=function(o){if($(n.selector+'[data-index="'+o+'"]').length){n.scrollToIndex(o,true)}else{ajaxify.go(l())}};n.scrollBottom=function(o){if(parseInt(o,10)<0){return}if($(n.selector+'[data-index="'+o+'"]').length){n.scrollToIndex(o,true)}else{o=parseInt(o,10)+1;ajaxify.go(l(o))}};n.scrollToPost=function(o,t,e){console.log("[navigator.scrollToPost] deprecated please use, navigator.scrollToIndex");n.scrollToIndex(o,t,e)};n.scrollToIndex=function(e,a,i){var r=!!t.get("topic").length;var c=!!t.get("category").length;if(!utils.isNumber(e)||!r&&!c){return}i=i!==undefined?i:400;n.scrollActive=true;if(r&&t.get("post/anchor",e).length){return n.scrollToPostIndex(e,a,i)}if(c&&$('[component="category/topic"][data-index="'+e+'"]').length){return n.scrollToTopicIndex(e,a,i)}if(!config.usePagination){n.scrollActive=false;e=parseInt(e,10)+1;ajaxify.go(l(e));return}var s=r?n.scrollToPostIndex:n.scrollToTopicIndex;if(r){if(config.topicPostSort==="most_votes"||config.topicPostSort==="newest_to_oldest"){e=ajaxify.data.postcount-e}}else if(c){if(config.categoryTopicSort==="most_posts"||config.categoryTopicSort==="oldest_to_newest"){e=ajaxify.data.ajaxify.data.topic_count-e}}var f=Math.max(1,Math.ceil(e/config.postsPerPage));if(parseInt(f,10)!==ajaxify.data.pagination.currentPage){o.loadPage(f,function(){s(e,a,i)})}else{s(e,a,i)}};n.scrollToPostIndex=function(o,e,a){var i=t.get("post","index",o);n.scrollToElement(i,e,a)};n.scrollToTopicIndex=function(o,t,e){var a=$('[component="category/topic"][data-index="'+o+'"]');n.scrollToElement(a,t,e)};n.scrollToElement=function(o,e,a){if(!o.length){n.scrollActive=false;return}var i=o.height();var l=$(window).height();var r=t.get("navbar").height();$(window).off("scroll",n.update);a=a!==undefined?a:400;n.scrollActive=true;var c=false;function s(){var t=0;if(i<l){t=o.offset().top-l/2+i/2}else{t=o.offset().top-r}$("html, body").animate({scrollTop:t+"px"},a,function(){if(c){$(window).on("scroll",n.update);var t=o.get(0).getBoundingClientRect();n.update(t.top);return}c=true;n.scrollActive=false;f();$("body").scrollTop($("body").scrollTop()-1);$("html").scrollTop($("html").scrollTop()-1)})}function f(){if(e){o.addClass("highlight");setTimeout(function(){o.removeClass("highlight")},1e4)}}s()};return n});
//# sourceMappingURL=public/src/modules/navigator.js.map