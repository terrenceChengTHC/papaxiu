"use strict";define("uploader",["translator"],function(e){var r={};r.open=function(e,o,s,t){console.warn("[uploader] uploader.open() is deprecated, please use uploader.show() instead, and pass parameters as a singe option with callback, e.g. uploader.show({}, callback);");r.show({route:e,params:o,fileSize:s},t)};r.show=function(e,r){var t=e.hasOwnProperty("fileSize")&&e.fileSize!==undefined?parseInt(e.fileSize,10):false;s({showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==undefined?e.showHelp:true,fileSize:t,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(s){s=$(s);s.modal("show");s.on("hidden.bs.modal",function(){s.remove()});var a=s.find("#uploadForm");a.attr("action",e.route);a.find("#params").val(JSON.stringify(e.params));s.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled");a.submit()});a.submit(function(){o(s,t,r);return false})})};r.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function o(e,o,s){function i(o,s){r.hideAlerts(e);if(o==="error"){e.find("#fileUploadSubmitBtn").removeClass("disabled")}e.find("#alert-"+o).translateText(s).removeClass("hide")}i("status","[[uploads:uploading-file]]");e.find("#upload-progress-bar").css("width","0%");e.find("#upload-progress-box").show().removeClass("hide");var n=e.find("#fileInput");if(!n.val()){return i("error","[[uploads:select-file-to-upload]]")}if(!a(n[0],o)){return i("error","[[error:file-too-big, "+o+"]]")}e.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=t(e);i("error",e.responseJSON?e.responseJSON.error||e.statusText:"error uploading, code : "+e.status)},uploadProgress:function(r,o,s,t){e.find("#upload-progress-bar").css("width",t+"%")},success:function(o){o=t(o);if(o.error){return i("error",o.error)}s(o[0].url);i("success","[[uploads:upload-success]]");setTimeout(function(){r.hideAlerts(e);e.modal("hide")},750)}})}function s(r,o){templates.parse("partials/modals/upload_file_modal",r,function(r){e.translate(r,o)})}function t(e){if(typeof e==="string"){try{return $.parseJSON(e)}catch(e){return{error:"[[error:parse-error]]"}}}return e}function a(e,r){if(window.FileReader&&r){return e.files[0].size<=r*1e3}return true}return r});
//# sourceMappingURL=public/src/modules/uploader.js.map