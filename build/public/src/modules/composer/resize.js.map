{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/resize.js"],"names":["define","resize","oldRatio","minimumRatio","snapMargin","mediumMin","$body","$","$window","window","$headerMenu","html","document","documentElement","body","header","getSavedRatio","localStorage","getItem","saveRatio","ratio","setItem","Math","min","getBounds","headerRect","getBoundingClientRect","rect","top","left","right","innerWidth","bottom","innerHeight","width","height","boundedTop","boundedHeight","doResize","postContainer","bounds","elem","max","style","toString","paddingBottom","removeAttr","visibility","resizeIt","raf","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","setTimeout","trigger","reposition","addClass","maximize","state","handleResize","resizeOffset","resizeBegin","resizeEnd","$resizer","find","resizer","resizeStart","e","resizeRect","resizeCenterY","clientY","on","resizeAction","resizeStop","resizeTouchAction","position","preventDefault","focus","off","hasClass","removeClass","touches"],"mappings":"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","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/resize.js","sourcesContent":["\r\n'use strict';\r\n\r\n/* globals define */\r\n\r\ndefine('composer/resize', [], function() {\r\n\tvar resize = {};\r\n\tvar oldRatio = 0;\r\n\tvar minimumRatio = 0.3;\r\n\tvar snapMargin = 0.05;\r\n\tvar mediumMin = 992;\r\n\r\n\tvar $body = $('body');\r\n\tvar $window = $(window);\r\n\tvar $headerMenu = $('[component=\"navbar\"]');\r\n\r\n\tvar html = document.documentElement;\r\n\tvar body = document.body;\r\n\tvar header = $headerMenu[0];\r\n\r\n\tfunction getSavedRatio() {\r\n\t\treturn localStorage.getItem('composer:resizeRatio') || 0.5;\r\n\t}\r\n\r\n\tfunction saveRatio(ratio) {\r\n\t\tlocalStorage.setItem('composer:resizeRatio', Math.min(ratio, 1));\r\n\t}\r\n\r\n\tfunction getBounds() {\r\n\t\tvar headerRect = header.getBoundingClientRect();\r\n\r\n\t\tvar rect = {\r\n\t\t\ttop: 0,\r\n\t\t\tleft: 0,\r\n\t\t\tright: window.innerWidth,\r\n\t\t\tbottom: window.innerHeight,\r\n\t\t};\r\n\r\n\t\trect.width = rect.right;\r\n\t\trect.height = rect.bottom;\r\n\r\n\t\trect.boundedTop = headerRect.bottom;\r\n\t\trect.boundedHeight = rect.bottom - headerRect.bottom;\r\n\r\n\t\treturn rect;\r\n\t}\r\n\r\n\tfunction doResize(postContainer, ratio) {\r\n\t\tvar bounds = getBounds();\r\n\t\tvar elem = postContainer[0];\r\n\r\n\t\tif (bounds.width >= mediumMin) {\r\n\t\t\tratio = Math.min(Math.max(ratio, minimumRatio), 1);\r\n\r\n\t\t\tvar top = ratio * bounds.boundedHeight / bounds.height;\r\n\t\t\telem.style.top = ((1 - top) * 100).toString() + '%';\r\n\r\n\t\t\t// Add some extra space at the bottom of the body so that\r\n\t\t\t// the user can still scroll to the last post w/ composer open\r\n\t\t\tvar rect = elem.getBoundingClientRect();\r\n\t\t\tbody.style.paddingBottom = (rect.bottom - rect.top).toString() + 'px';\r\n\t\t} else {\r\n\t\t\tpostContainer.removeAttr('style');\r\n\t\t\tbody.style.paddingBottom = 0;\r\n\t\t}\r\n\r\n\t\tpostContainer.ratio = ratio;\r\n\t\telem.style.visibility = 'visible';\r\n\t}\r\n\r\n\tvar resizeIt = doResize;\r\n\tvar raf = window.requestAnimationFrame ||\r\n\t\twindow.webkitRequestAnimationFrame ||\r\n\t\twindow.mozRequestAnimationFrame;\r\n\r\n\tif (raf) {\r\n\t\tresizeIt = function(postContainer, ratio) {\r\n\t\t\traf(function() {\r\n\t\t\t\tdoResize(postContainer, ratio);\r\n\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t$window.trigger('action:composer.resize');\r\n\t\t\t\t\tpostContainer.trigger('action:composer.resize');\r\n\t\t\t\t}, 0);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\r\n\tresize.reposition = function(postContainer) {\r\n\t\tvar\tratio = getSavedRatio();\r\n\r\n\t\tif (ratio >= 1 - snapMargin) {\r\n\t\t\tratio = 1;\r\n\t\t\tpostContainer.addClass('maximized');\r\n\t\t}\r\n\r\n\t\tresizeIt(postContainer, ratio);\r\n\t};\r\n\r\n\tresize.maximize = function(postContainer, state) {\r\n\t\tif (state) {\r\n\t\t\tresizeIt(postContainer, 1);\r\n\t\t} else {\r\n\t\t\tresize.reposition(postContainer);\r\n\t\t}\r\n\t};\r\n\r\n\tresize.handleResize = function(postContainer) {\r\n\t\tvar resizeOffset = 0;\r\n\t\tvar resizeBegin = 0;\r\n\t\tvar resizeEnd = 0;\r\n\t\tvar $resizer = postContainer.find('.resizer');\r\n\t\tvar resizer = $resizer[0];\r\n\r\n\t\tfunction resizeStart(e) {\r\n\t\t\tvar resizeRect = resizer.getBoundingClientRect();\r\n\t\t\tvar resizeCenterY = (resizeRect.top + resizeRect.bottom) / 2;\r\n\r\n\t\t\tresizeOffset = (resizeCenterY - e.clientY) / 2;\r\n\t\t\tresizeBegin = e.clientY;\r\n\r\n\t\t\t$window.on('mousemove', resizeAction);\r\n\t\t\t$window.on('mouseup', resizeStop);\r\n\t\t\t$body.on('touchmove', resizeTouchAction);\r\n\t\t}\r\n\r\n\t\tfunction resizeAction(e) {\r\n\t\t\tvar position = e.clientY - resizeOffset;\r\n\t\t\tvar bounds = getBounds();\r\n\t\t\tvar ratio = (bounds.height - position) / (bounds.boundedHeight);\r\n\r\n\t\t\tresizeIt(postContainer, ratio);\r\n\t\t}\r\n\r\n\t\tfunction resizeStop(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tresizeEnd = e.clientY;\r\n\r\n\t\t\tpostContainer.find('textarea').focus();\r\n\t\t\t$window.off('mousemove', resizeAction);\r\n\t\t\t$window.off('mouseup', resizeStop);\r\n\t\t\t$body.off('touchmove', resizeTouchAction);\r\n\r\n\t\t\tvar position = resizeEnd - resizeOffset;\r\n\t\t\tvar bounds = getBounds();\r\n\t\t\tvar ratio = (bounds.height - position) / (bounds.boundedHeight);\r\n\r\n\t\t\tif (resizeEnd - resizeBegin === 0 && postContainer.hasClass('maximized')) {\r\n\t\t\t\tpostContainer.removeClass('maximized');\r\n\t\t\t\tratio = (!oldRatio || oldRatio >= 1 - snapMargin) ? 0.5 : oldRatio;\r\n\t\t\t\tresizeIt(postContainer, ratio);\r\n\t\t\t} else if (resizeEnd - resizeBegin === 0 || ratio >= 1 - snapMargin) {\r\n\t\t\t\tresizeIt(postContainer, 1);\r\n\t\t\t\tpostContainer.addClass('maximized');\r\n\t\t\t\toldRatio = ratio;\r\n\t\t\t} else {\r\n\t\t\t\tpostContainer.removeClass('maximized');\r\n\t\t\t}\r\n\r\n\t\t\tsaveRatio(ratio);\r\n\t\t}\r\n\r\n\t\tfunction resizeTouchAction(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tresizeAction(e.touches[0]);\r\n\t\t}\r\n\r\n\t\t$resizer\r\n\t\t\t.on('mousedown', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tresizeStart(e);\r\n\t\t\t})\r\n\t\t\t.on('touchstart', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tresizeStart(e.touches[0]);\r\n\t\t\t})\r\n\t\t\t.on('touchend', resizeStop);\r\n\t};\r\n\r\n\treturn resize;\r\n});\r\n"]}