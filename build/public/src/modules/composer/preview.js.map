{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/preview.js"],"names":["define","preview","timeoutId","render","postContainer","callback","clearTimeout","textarea","find","setTimeout","socket","emit","val","err","$","addClass","html","window","trigger","matchScroll","length","diff","scrollHeight","height","scrollPercent","scrollTop","Math","max","handleToggler","hidePreview","togglePreview","localStorage","setItem","showPreview","removeItem","show","previewContainer","toggleClass","writeContainer","showBtn","focus","hideBtn","on","getItem"],"mappings":"AAAA,aAIAA,OAAO,mBAAoB,WAC1B,IAAIC,KAEJ,IAAIC,EAAY,EAEhBD,EAAQE,OAAS,SAASC,EAAeC,GACxCA,EAAWA,GAAY,aACvB,GAAIH,EAAW,CACdI,aAAaJ,GACbA,EAAY,EAEb,IAAIK,EAAWH,EAAcI,KAAK,YAElCN,EAAYO,WAAW,WACtBC,OAAOC,KAAK,iCAAkCJ,EAASK,MAAO,SAASC,EAAKZ,GAC3EC,EAAY,EACZ,GAAIW,EAAK,CACR,OAEDZ,EAAUa,EAAEb,GACZA,EAAQO,KAAK,4BAA4BO,SAAS,kBAClDX,EAAcI,KAAK,YAAYQ,KAAKf,GACpCa,EAAEG,QAAQC,QAAQ,2BAClBb,OAEC,MAGJJ,EAAQkB,YAAc,SAASf,GAC9B,IAAIG,EAAWH,EAAcI,KAAK,YAClC,IAAIP,EAAUG,EAAcI,KAAK,YAEjC,GAAID,EAASa,QAAUnB,EAAQmB,OAAQ,CACtC,IAAIC,EAAOd,EAAS,GAAGe,aAAef,EAASgB,SAE/C,GAAIF,IAAS,EAAG,CACf,OAGD,IAAIG,EAAgBjB,EAASkB,YAAcJ,EAE3CpB,EAAQwB,UAAUC,KAAKC,IAAI1B,EAAQ,GAAGqB,aAAerB,EAAQsB,SAAU,GAAKC,KAI9EvB,EAAQ2B,cAAgB,SAASxB,GAChC,SAASyB,IACRC,EAAc,OACdC,aAAaC,QAAQ,0BAA2B,MAGjD,SAASC,IACRH,EAAc,MACdC,aAAaG,WAAW,2BAGzB,SAASJ,EAAcK,GACtBC,EAAiBC,YAAY,QAASF,GACtCG,EAAeD,YAAY,aAAcF,GACzCI,EAAQF,YAAY,OAAQF,GAE5BrB,EAAE,UAAU0B,QACZvC,EAAQkB,YAAYf,GAGrB,IAAImC,EAAUnC,EAAcI,KAAK,oCAChCiC,EAAUrC,EAAcI,KAAK,sCAC7B4B,EAAmBtB,EAAE,sBACrBwB,EAAiBxB,EAAE,oBAEpB2B,EAAQC,GAAG,QAASb,GACpBU,EAAQG,GAAG,QAAST,GAEpB,GAAIF,aAAaY,QAAQ,2BAA4B,CACpDd,QACM,CACNI,MAIF,OAAOhC","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/preview.js","sourcesContent":["'use strict';\r\n\r\n/* globals define, socket*/\r\n\r\ndefine('composer/preview', function() {\r\n\tvar preview = {};\r\n\r\n\tvar timeoutId = 0;\r\n\r\n\tpreview.render = function(postContainer, callback) {\r\n\t\tcallback = callback || function() {};\r\n\t\tif (timeoutId) {\r\n\t\t\tclearTimeout(timeoutId);\r\n\t\t\ttimeoutId = 0;\r\n\t\t}\r\n\t\tvar textarea = postContainer.find('textarea');\r\n\r\n\t\ttimeoutId = setTimeout(function() {\r\n\t\t\tsocket.emit('plugins.composer.renderPreview', textarea.val(), function(err, preview) {\r\n\t\t\t\ttimeoutId = 0;\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpreview = $(preview);\r\n\t\t\t\tpreview.find('img:not(.not-responsive)').addClass('img-responsive');\r\n\t\t\t\tpostContainer.find('.preview').html(preview);\r\n\t\t\t\t$(window).trigger('action:composer.preview');\r\n\t\t\t\tcallback();\r\n\t\t\t});\r\n\t\t}, 250);\r\n\t};\r\n\r\n\tpreview.matchScroll = function(postContainer) {\r\n\t\tvar textarea = postContainer.find('textarea');\r\n\t\tvar preview = postContainer.find('.preview');\r\n\r\n\t\tif (textarea.length && preview.length) {\r\n\t\t\tvar diff = textarea[0].scrollHeight - textarea.height();\r\n\r\n\t\t\tif (diff === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar scrollPercent = textarea.scrollTop() / diff;\r\n\r\n\t\t\tpreview.scrollTop(Math.max(preview[0].scrollHeight - preview.height(), 0) * scrollPercent);\r\n\t\t}\r\n\t};\r\n\r\n\tpreview.handleToggler = function(postContainer) {\r\n\t\tfunction hidePreview() {\r\n\t\t\ttogglePreview(false);\r\n\t\t\tlocalStorage.setItem('composer:previewToggled', true);\r\n\t\t}\r\n\r\n\t\tfunction showPreview() {\r\n\t\t\ttogglePreview(true);\r\n\t\t\tlocalStorage.removeItem('composer:previewToggled');\r\n\t\t}\r\n\r\n\t\tfunction togglePreview(show) {\r\n\t\t\tpreviewContainer.toggleClass('hide', !show);\r\n\t\t\twriteContainer.toggleClass('maximized', !show);\r\n\t\t\tshowBtn.toggleClass('hide', show);\r\n\r\n\t\t\t$('.write').focus();\r\n\t\t\tpreview.matchScroll(postContainer);\r\n\t\t}\r\n\r\n\t\tvar showBtn = postContainer.find('.write-container .toggle-preview'),\r\n\t\t\thideBtn = postContainer.find('.preview-container .toggle-preview'),\r\n\t\t\tpreviewContainer = $('.preview-container'),\r\n\t\t\twriteContainer = $('.write-container');\r\n\r\n\t\thideBtn.on('click', hidePreview);\r\n\t\tshowBtn.on('click', showPreview);\r\n\r\n\t\tif (localStorage.getItem('composer:previewToggled')) {\r\n\t\t\thidePreview();\r\n\t\t} else {\r\n\t\t\tshowPreview();\r\n\t\t}\r\n\t};\r\n\r\n\treturn preview;\r\n});"]}