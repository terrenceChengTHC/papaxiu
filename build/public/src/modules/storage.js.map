{"version":3,"sources":["public/src/modules/storage.js"],"names":["define","Storage","this","_store","_keys","prototype","isMock","setItem","key","val","String","indexOf","push","getItem","removeItem","filter","x","clear","n","parseInt","Object","defineProperty","get","length","storage","item","Date","now","toString","window","localStorage","Error","e","console","warn","sessionStorage"],"mappings":"AAAA,aAKAA,OAAO,UAAW,WACjB,SAASC,IACRC,KAAKC,UACLD,KAAKE,SAENH,EAAQI,UAAUC,OAAS,KAC3BL,EAAQI,UAAUE,QAAU,SAAUC,EAAKC,GAC1CD,EAAME,OAAOF,GACb,GAAIN,KAAKE,MAAMO,QAAQH,MAAU,EAAG,CACnCN,KAAKE,MAAMQ,KAAKJ,GAEjBN,KAAKC,OAAOK,GAAOC,GAEpBR,EAAQI,UAAUQ,QAAU,SAAUL,GACrCA,EAAME,OAAOF,GACb,GAAIN,KAAKE,MAAMO,QAAQH,MAAU,EAAG,CACnC,OAAO,KAGR,OAAON,KAAKC,OAAOK,IAEpBP,EAAQI,UAAUS,WAAa,SAAUN,GACxCA,EAAME,OAAOF,GACbN,KAAKE,MAAQF,KAAKE,MAAMW,OAAO,SAAUC,GACxC,OAAOA,IAAMR,IAEdN,KAAKC,OAAOK,GAAO,MAEpBP,EAAQI,UAAUY,MAAQ,WACzBf,KAAKE,SACLF,KAAKC,WAENF,EAAQI,UAAUG,IAAM,SAAUU,GACjCA,EAAIC,SAASD,EAAG,KAAO,EACvB,OAAOhB,KAAKE,MAAMc,IAEnB,GAAIE,OAAOC,eAAgB,CAC1BD,OAAOC,eAAepB,EAAQI,UAAW,UACxCiB,IAAK,WACJ,OAAOpB,KAAKE,MAAMmB,UAKrB,IAAIC,EACJ,IAAIC,EAAOC,KAAKC,MAAMC,WAEtB,IACCJ,EAAUK,OAAOC,aACjBN,EAAQjB,QAAQkB,EAAMA,GACtB,GAAID,EAAQX,QAAQY,KAAUA,EAAM,CACnC,MAAMM,MAAM,qCAEbP,EAAQV,WAAWW,GAEnB,OAAOD,EACN,MAAOQ,GACRC,QAAQC,KAAKF,GACbC,QAAQC,KAAK,uDAGb,IACCV,EAAUK,OAAOM,eACjBX,EAAQjB,QAAQkB,EAAMA,GACtB,GAAID,EAAQX,QAAQY,KAAUA,EAAM,CACnC,MAAMM,MAAM,uCAEbP,EAAQV,WAAWW,GAEnB,OAAOD,EACN,MAAOQ,GACRC,QAAQC,KAAKF,GACbC,QAAQC,KAAK,yDAGb,OAAO,IAAIjC","file":"public/src/modules/storage.js","sourcesContent":["'use strict';\n\n/**\n * Checks localStorage and provides a fallback if it doesn't exist or is disabled\n */\ndefine('storage', function () {\n\tfunction Storage() {\n\t\tthis._store = {};\n\t\tthis._keys = [];\n\t}\n\tStorage.prototype.isMock = true;\n\tStorage.prototype.setItem = function (key, val) {\n\t\tkey = String(key);\n\t\tif (this._keys.indexOf(key) === -1) {\n\t\t\tthis._keys.push(key);\n\t\t}\n\t\tthis._store[key] = val;\n\t};\n\tStorage.prototype.getItem = function (key) {\n\t\tkey = String(key);\n\t\tif (this._keys.indexOf(key) === -1) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._store[key];\n\t};\n\tStorage.prototype.removeItem = function (key) {\n\t\tkey = String(key);\n\t\tthis._keys = this._keys.filter(function (x) {\n\t\t\treturn x !== key;\n\t\t});\n\t\tthis._store[key] = null;\n\t};\n\tStorage.prototype.clear = function () {\n\t\tthis._keys = [];\n\t\tthis._store = {};\n\t};\n\tStorage.prototype.key = function (n) {\n\t\tn = parseInt(n, 10) || 0;\n\t\treturn this._keys[n];\n\t};\n\tif (Object.defineProperty) {\n\t\tObject.defineProperty(Storage.prototype, 'length', {\n\t\t\tget: function () {\n\t\t\t\treturn this._keys.length;\n\t\t\t},\n\t\t});\n\t}\n\n\tvar storage;\n\tvar item = Date.now().toString();\n\n\ttry {\n\t\tstorage = window.localStorage;\n\t\tstorage.setItem(item, item);\n\t\tif (storage.getItem(item) !== item) {\n\t\t\tthrow Error('localStorage behaved unexpectedly');\n\t\t}\n\t\tstorage.removeItem(item);\n\n\t\treturn storage;\n\t} catch (e) {\n\t\tconsole.warn(e);\n\t\tconsole.warn('localStorage failed, falling back on sessionStorage');\n\n\t\t// see if sessionStorage works, and if so, return that\n\t\ttry {\n\t\t\tstorage = window.sessionStorage;\n\t\t\tstorage.setItem(item, item);\n\t\t\tif (storage.getItem(item) !== item) {\n\t\t\t\tthrow Error('sessionStorage behaved unexpectedly');\n\t\t\t}\n\t\t\tstorage.removeItem(item);\n\n\t\t\treturn storage;\n\t\t} catch (e) {\n\t\t\tconsole.warn(e);\n\t\t\tconsole.warn('sessionStorage failed, falling back on memory storage');\n\n\t\t\t// return an object implementing mock methods\n\t\t\treturn new Storage();\n\t\t}\n\t}\n});\n"]}