{"version":3,"sources":["public/src/modules/sounds.js"],"names":["define","storage","Sounds","fileMap","soundMap","cache","loadMap","callback","socket","emit","err","map","app","alertError","message","loadData","outstanding","after","$","getJSON","config","relative_path","playSound","soundName","audio","Audio","pause","currentTime","play","type","id","item","getItem","setItem","setTimeout","removeItem","on"],"mappings":"AAAA,aAGAA,OAAO,UAAW,WAAY,SAAUC,GACvC,IAAIC,KAEJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,KAEJH,EAAOI,QAAU,SAASA,EAAQC,GACjCC,OAAOC,KAAK,iCAAkC,SAAUC,EAAKC,GAC5D,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAE3BV,EAAWO,EACX,GAAIJ,EAAU,CACbA,QAKH,SAASQ,EAASR,GACjB,IAAIS,EAAc,EAClB,SAASC,IACRD,GAAe,EACf,GAAIA,IAAgB,GAAKT,EAAU,CAClCA,KAGF,GAAIJ,EAAS,CACZa,GAAe,MACT,CACNE,EAAEC,QAAQC,OAAOC,cAAgB,8BAA+B,SAAUV,GACzER,EAAUQ,EACVM,MAIFf,EAAOI,QAAQW,GAGhBf,EAAOoB,UAAY,SAASA,EAAUC,GACrC,IAAKnB,IAAaD,EAAS,CAC1B,OAAOY,EAASE,GAGjB,SAASA,IACR,IAAKd,EAAQoB,GAAY,CACxB,OAED,IAAIC,EAAQnB,EAAMkB,IAAc,IAAIE,MAAML,OAAOC,cAAgB,kBAAoBlB,EAAQoB,IAC7FlB,EAAMkB,GAAaC,EACnBA,EAAME,QACNF,EAAMG,YAAc,EACpBH,EAAMI,OAGPX,KAGDf,EAAO0B,KAAO,SAASA,EAAKC,EAAMC,GACjC,SAASb,IACR,IAAKb,EAASyB,GAAO,CACpB,OAGD,GAAIC,EAAI,CACP,IAAIC,EAAO,kBAAoBD,EAC/B,GAAI7B,EAAQ+B,QAAQD,GAAO,CAC1B,OAED9B,EAAQgC,QAAQF,EAAM,MAEtBG,WAAW,WACVjC,EAAQkC,WAAWJ,IACjB,KAGJ7B,EAAOoB,UAAUlB,EAASyB,IAG3B,IAAKzB,IAAaD,EAAS,CAC1B,OAAOY,EAASE,GAGjBA,KAGDT,OAAO4B,GAAG,6BAA8B,WACvClC,EAAOI,YAGR,OAAOJ","file":"public/src/modules/sounds.js","sourcesContent":["'use strict';\n\n\ndefine('sounds', ['storage'], function (storage) {\n\tvar\tSounds = {};\n\n\tvar fileMap;\n\tvar soundMap;\n\tvar cache = {};\n\n\tSounds.loadMap = function loadMap(callback) {\n\t\tsocket.emit('modules.sounds.getUserSoundMap', function (err, map) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tsoundMap = map;\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction loadData(callback) {\n\t\tvar outstanding = 2;\n\t\tfunction after() {\n\t\t\toutstanding -= 1;\n\t\t\tif (outstanding === 0 && callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t\tif (fileMap) {\n\t\t\toutstanding -= 1;\n\t\t} else {\n\t\t\t$.getJSON(config.relative_path + '/assets/sounds/fileMap.json', function (map) {\n\t\t\t\tfileMap = map;\n\t\t\t\tafter();\n\t\t\t});\n\t\t}\n\n\t\tSounds.loadMap(after);\n\t}\n\n\tSounds.playSound = function playSound(soundName) {\n\t\tif (!soundMap || !fileMap) {\n\t\t\treturn loadData(after);\n\t\t}\n\n\t\tfunction after() {\n\t\t\tif (!fileMap[soundName]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar audio = cache[soundName] || new Audio(config.relative_path + '/assets/sounds/' + fileMap[soundName]);\n\t\t\tcache[soundName] = audio;\n\t\t\taudio.pause();\n\t\t\taudio.currentTime = 0;\n\t\t\taudio.play();\n\t\t}\n\n\t\tafter();\n\t};\n\n\tSounds.play = function play(type, id) {\n\t\tfunction after() {\n\t\t\tif (!soundMap[type]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (id) {\n\t\t\t\tvar item = 'sounds.handled:' + id;\n\t\t\t\tif (storage.getItem(item)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tstorage.setItem(item, true);\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tstorage.removeItem(item);\n\t\t\t\t}, 5000);\n\t\t\t}\n\n\t\t\tSounds.playSound(soundMap[type]);\n\t\t}\n\n\t\tif (!soundMap || !fileMap) {\n\t\t\treturn loadData(after);\n\t\t}\n\n\t\tafter();\n\t};\n\n\tsocket.on('event:sounds.reloadMapping', function () {\n\t\tSounds.loadMap();\n\t});\n\n\treturn Sounds;\n});\n"]}