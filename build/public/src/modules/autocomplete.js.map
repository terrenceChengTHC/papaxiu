{"version":3,"sources":["public/src/modules/autocomplete.js"],"names":["define","module","user","input","onselect","app","loadJQueryUI","autocomplete","delay","open","$","this","css","select","source","request","response","socket","emit","query","term","err","result","alertError","message","users","names","map","username","html","text","label","value","uid","name","slug","userslug","attr","group","results","length","tag","event","ui","e","jQuery","Event","which","keyCode","setTimeout","trigger","cid","ajaxify","data","tags"],"mappings":"AACA,aAGAA,OAAO,eAAgB,WACtB,IAAIC,KAEJA,EAAOC,KAAO,SAAUC,EAAOC,GAC9BC,IAAIC,aAAa,WAChBH,EAAMI,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,MAE/CC,OAAQT,EACRU,OAAQ,SAAUC,EAASC,GAC1BC,OAAOC,KAAK,eAAiBC,MAAOJ,EAAQK,MAAQ,SAAUC,EAAKC,GAClE,GAAID,EAAK,CACR,OAAOhB,IAAIkB,WAAWF,EAAIG,SAG3B,GAAIF,GAAUA,EAAOG,MAAO,CAC3B,IAAIC,EAAQJ,EAAOG,MAAME,IAAI,SAAUzB,GACtC,IAAI0B,EAAWlB,EAAE,UAAUmB,KAAK3B,EAAK0B,UAAUE,OAC/C,OAAO5B,IACN6B,MAAOH,EACPI,MAAOJ,EACP1B,MACC+B,IAAK/B,EAAK+B,IACVC,KAAMhC,EAAK0B,SACXO,KAAMjC,EAAKkC,aAIdpB,EAASU,GAEVhB,EAAE,sBAAsB2B,KAAK,eAAgB,iBAOlDpC,EAAOqC,MAAQ,SAAUnC,EAAOC,GAC/BC,IAAIC,aAAa,WAChBH,EAAMI,cACLC,MAAO,IACPK,OAAQT,EACRU,OAAQ,SAAUC,EAASC,GAC1BC,OAAOC,KAAK,iBACXC,MAAOJ,EAAQK,MACb,SAAUC,EAAKkB,GACjB,GAAIlB,EAAK,CACR,OAAOhB,IAAIkB,WAAWF,EAAIG,SAG3B,GAAIe,GAAWA,EAAQC,OAAQ,CAC9B,IAAId,EAAQa,EAAQZ,IAAI,SAAUW,GACjC,OAAOA,IACNP,MAAOO,EAAMJ,KACbF,MAAOM,EAAMJ,KACbI,OACCJ,KAAMI,EAAMJ,KACZC,KAAMG,EAAMH,SAIfnB,EAASU,GAEVhB,EAAE,sBAAsB2B,KAAK,eAAgB,iBAOlDpC,EAAOwC,IAAM,SAAUtC,EAAOC,GAC7BC,IAAIC,aAAa,WAChBH,EAAMI,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,MAE/CC,OAAQ,SAAU6B,EAAOC,GACxBvC,EAAWA,GAAY,aACvB,IAAIwC,EAAIC,OAAOC,MAAM,YACrBF,EAAEG,MAAQ,GACVH,EAAEI,QAAU,GACZC,WAAW,WACV9C,EAAM+C,QAAQN,IACZ,KACHxC,EAASsC,EAAOC,IAEjB7B,OAAQ,SAAUC,EAASC,GAC1BC,OAAOC,KAAK,2BACXC,MAAOJ,EAAQK,KACf+B,IAAKC,QAAQC,KAAKF,KAAO,GACvB,SAAU9B,EAAKiC,GACjB,GAAIjC,EAAK,CACR,OAAOhB,IAAIkB,WAAWF,EAAIG,SAE3B,GAAI8B,EAAM,CACTtC,EAASsC,GAEV5C,EAAE,sBAAsB2B,KAAK,eAAgB,iBAOlD,OAAOpC","file":"public/src/modules/autocomplete.js","sourcesContent":["\n'use strict';\n\n\ndefine('autocomplete', function () {\n\tvar module = {};\n\n\tmodule.user = function (input, onselect) {\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 200,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 20000);\n\t\t\t\t},\n\t\t\t\tselect: onselect,\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tsocket.emit('user.search', { query: request.term }, function (err, result) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (result && result.users) {\n\t\t\t\t\t\t\tvar names = result.users.map(function (user) {\n\t\t\t\t\t\t\t\tvar username = $('<div/>').html(user.username).text();\n\t\t\t\t\t\t\t\treturn user && {\n\t\t\t\t\t\t\t\t\tlabel: username,\n\t\t\t\t\t\t\t\t\tvalue: username,\n\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\tuid: user.uid,\n\t\t\t\t\t\t\t\t\t\tname: user.username,\n\t\t\t\t\t\t\t\t\t\tslug: user.userslug,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresponse(names);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tmodule.group = function (input, onselect) {\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 200,\n\t\t\t\tselect: onselect,\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tsocket.emit('groups.search', {\n\t\t\t\t\t\tquery: request.term,\n\t\t\t\t\t}, function (err, results) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (results && results.length) {\n\t\t\t\t\t\t\tvar names = results.map(function (group) {\n\t\t\t\t\t\t\t\treturn group && {\n\t\t\t\t\t\t\t\t\tlabel: group.name,\n\t\t\t\t\t\t\t\t\tvalue: group.name,\n\t\t\t\t\t\t\t\t\tgroup: {\n\t\t\t\t\t\t\t\t\t\tname: group.name,\n\t\t\t\t\t\t\t\t\t\tslug: group.slug,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresponse(names);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tmodule.tag = function (input, onselect) {\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 100,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 20000);\n\t\t\t\t},\n\t\t\t\tselect: function (event, ui) {\n\t\t\t\t\tonselect = onselect || function () {};\n\t\t\t\t\tvar e = jQuery.Event('keypress');\n\t\t\t\t\te.which = 13;\n\t\t\t\t\te.keyCode = 13;\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tinput.trigger(e);\n\t\t\t\t\t}, 100);\n\t\t\t\t\tonselect(event, ui);\n\t\t\t\t},\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tsocket.emit('topics.autocompleteTags', {\n\t\t\t\t\t\tquery: request.term,\n\t\t\t\t\t\tcid: ajaxify.data.cid || 0,\n\t\t\t\t\t}, function (err, tags) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (tags) {\n\t\t\t\t\t\t\tresponse(tags);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\treturn module;\n});\n"]}