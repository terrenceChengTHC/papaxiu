"use strict";define("pictureCropper",["translator","cropper"],function(e,a){var t={};t.show=function(e,a){var t=e.hasOwnProperty("fileSize")&&e.fileSize!==undefined?parseInt(e.fileSize,10):false;o({showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==undefined?e.showHelp:true,fileSize:t,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(t){t=$(t);t.modal("show");t.on("hidden.bs.modal",function(){t.remove()});t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled");e.uploadModal=t;i(e,a);return false})})};t.handleImageCrop=function(t,i){$("#crop-picture-modal").remove();templates.parse("modals/crop_picture",{url:t.url},function(o){e.translate(o,function(e){var o=$(e);o.modal({backdrop:"static"}).modal("show");var r=parseInt($(window).height()/2,10);var n=document.getElementById("cropped-image");$(n).css("max-height",r);var d=new a.default(n,{aspectRatio:t.aspectRatio,autoCropArea:1,viewMode:1,cropmove:function(){if(t.restrictImageDimension){if(d.cropBoxData.width>t.imageDimension){d.setCropBoxData({width:t.imageDimension})}if(d.cropBoxData.height>t.imageDimension){d.setCropBoxData({height:t.imageDimension})}}},ready:function(){if(t.restrictImageDimension){var e=n.width<n.height?n.width:n.height;var r=e>t.imageDimension?t.imageDimension:e;d.setCropBoxData({width:r,height:r})}o.find(".rotate").on("click",function(){var e=this.getAttribute("data-degrees");d.rotate(e)});o.find(".flip").on("click",function(){var e=this.getAttribute("data-option");var a=this.getAttribute("data-method");if(a==="scaleX"){d.scaleX(e)}else{d.scaleY(e)}this.setAttribute("data-option",e*-1)});o.find(".reset").on("click",function(){d.reset()});o.find(".crop-btn").on("click",function(){$(this).addClass("disabled");var e=t.imageType?d.getCroppedCanvas().toDataURL(t.imageType):d.getCroppedCanvas().toDataURL();o.find("#upload-progress-bar").css("width","100%");o.find("#upload-progress-box").show().removeClass("hide");var a={};a[t.paramName]=t.paramValue;a.imageData=e;socket.emit(t.socketMethod,a,function(e,a){if(e){o.find("#upload-progress-box").hide();o.find(".upload-btn").removeClass("disabled");o.find(".crop-btn").removeClass("disabled");return app.alertError(e.message)}i(a.url);o.modal("hide")})});o.find(".upload-btn").on("click",function(){$(this).addClass("disabled");d.destroy();d=new a.default(n,{viewMode:1,autoCropArea:1,ready:function(){o.find(".crop-btn").trigger("click")}})})}})})})};function i(e,a){function i(a,i){t.hideAlerts(e.uploadModal);if(a==="error"){e.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled")}e.uploadModal.find("#alert-"+a).translateText(i).removeClass("hide")}var o=e.uploadModal.find("#fileInput");if(!o.val()){return i("error","[[uploads:select-file-to-upload]]")}var r=o[0].files[0];var n=new FileReader;var d;var s=r.type;n.addEventListener("load",function(){d=n.result;e.uploadModal.modal("hide");t.handleImageCrop({url:d,imageType:s,socketMethod:e.socketMethod,aspectRatio:e.aspectRatio,allowSkippingCrop:e.allowSkippingCrop,restrictImageDimension:e.restrictImageDimension,imageDimension:e.imageDimension,paramName:e.paramName,paramValue:e.paramValue},a)},false);if(r){n.readAsDataURL(r)}}function o(a,t){templates.parse("partials/modals/upload_file_modal",a,function(a){e.translate(a,t)})}return t});
//# sourceMappingURL=public/src/modules/pictureCropper.js.map