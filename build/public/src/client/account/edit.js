"use strict";define("forum/account/edit",["forum/account/header","translator","components","pictureCropper"],function(a,t,e,i){var r={};r.init=function(){a.init();$("#submitBtn").on("click",n);app.loadJQueryUI(function(){$("#inputBirthday").datepicker({changeMonth:true,changeYear:true,yearRange:"1900:-5y",defaultDate:"-13y"})});o();c();s();p();m()};function n(){var a={uid:$("#inputUID").val(),fullname:$("#inputFullname").val(),website:$("#inputWebsite").val(),birthday:$("#inputBirthday").val(),location:$("#inputLocation").val(),groupTitle:$("#groupTitle").val(),signature:$("#inputSignature").val(),aboutme:$("#inputAboutMe").val()};$(window).trigger("action:profile.update",a);socket.emit("user.updateProfile",a,function(a,t){if(a){return app.alertError(a.message)}app.alertSuccess("[[user:profile_update_success]]");if(t.picture){$("#user-current-picture").attr("src",t.picture)}u(t.picture)});return false}function u(a){if(parseInt(ajaxify.data.theirid,10)!==parseInt(ajaxify.data.yourid,10)){return}if(!a&&ajaxify.data.defaultAvatar){a=ajaxify.data.defaultAvatar}e.get("header/userpicture")[a?"show":"hide"]();e.get("header/usericon")[!a?"show":"hide"]();if(a){e.get("header/userpicture").attr("src",a)}}function o(){$("#changePictureBtn").on("click",function(){socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(a,e){if(a){return app.alertError(a.message)}var i=e.reduce(function(a,t){return a||t.type==="uploaded"},false);templates.parse("partials/modals/change_picture_modal",{pictures:e,uploaded:i,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads},function(a){t.translate(a,function(a){var t=bootbox.dialog({className:"picture-switcher",title:"[[user:change_picture]]",message:a,show:true,buttons:{close:{label:"[[global:close]]",callback:r,className:"btn-link"},update:{label:"[[global:save_changes]]",callback:i}}});t.on("shown.bs.modal",e);t.on("click",".list-group-item",function a(){t.find(".list-group-item").removeClass("active");$(this).addClass("active")});l(t);function e(){if(!ajaxify.data.picture){t.find(".list-group-item .user-icon").parents(".list-group-item").addClass("active")}else{t.find(".list-group-item img").each(function(){if(this.getAttribute("src")===ajaxify.data.picture){$(this).parents(".list-group-item").addClass("active")}})}}function i(){var a=t.find(".list-group-item.active").attr("data-type");f(a,function(e){if(e){return app.alertError(e.message)}u(a==="default"?"":t.find(".list-group-item.active img").attr("src"));ajaxify.refresh()})}function r(){t.modal("hide")}})})});return false})}function c(){$("#deleteAccountBtn").on("click",function(){t.translate("[[user:delete_account_confirm]]",function(a){var t=bootbox.confirm(a+'<p><input type="text" class="form-control" id="confirm-username" /></p>',function(a){if(!a){return}if($("#confirm-username").val()!==app.user.username){app.alertError("[[error:invalid-username]]");return false}socket.emit("user.deleteAccount",{},function(a){if(a){return app.alertError(a.message)}window.location.href=config.relative_path+"/"})});t.on("shown.bs.modal",function(){t.find("input").focus()})});return false})}function l(a){function e(a){a=config.relative_path+a+"?"+Date.now();u(a);if(ajaxify.data.picture.length){$("#user-current-picture, img.avatar").attr("src",a);ajaxify.data.uploadedpicture=a}else{ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",a)})}}function r(){if(ajaxify.data.uploadedpicture===ajaxify.data.picture){ajaxify.refresh();u()}}a.find('[data-action="upload"]').on("click",function(){a.modal("hide");i.show({socketMethod:"user.uploadCroppedPicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:false,title:"[[user:upload_picture]]",description:"[[user:upload_a_picture]]",accept:".png,.jpg,.bmp"},function(a){e(a)});return false});a.find('[data-action="upload-url"]').on("click",function(){a.modal("hide");templates.parse("partials/modals/upload_picture_from_url_modal",{},function(a){t.translate(a,function(a){var t=$(a);t.modal("show");t.find(".upload-btn").on("click",function(){var a=t.find("#uploadFromUrl").val();if(!a){return false}socket.emit("user.uploadProfileImageFromUrl",{uid:ajaxify.data.uid,url:a},function(a,r){if(a){return app.alertError(a)}t.modal("hide");i.handleImageCrop({url:r,socketMethod:"user.uploadCroppedPicture",aspectRatio:"1 / 1",allowSkippingCrop:false,paramName:"uid",paramValue:ajaxify.data.theirid},e)});return false})})});return false});a.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(t){a.modal("hide");if(t){return app.alertError(t.message)}r()})})}function s(){$("#confirm-email").on("click",function(){var a=$(this).attr("disabled",true);socket.emit("user.emailConfirm",{},function(t){a.removeAttr("disabled");if(t){return app.alertError(t.message)}app.alertSuccess("[[notifications:email-confirm-sent]]")})})}function f(a,t){socket.emit("user.changePicture",{type:a,uid:ajaxify.data.theirid},t)}function d(a,t){return a.length?"("+a.val().length+"/"+t+")":""}function p(){var a=$("#inputSignature");$("#signatureCharCountLeft").html(d(a,ajaxify.data.maximumSignatureLength));a.on("keyup change",function(){$("#signatureCharCountLeft").html(d(a,ajaxify.data.maximumSignatureLength))})}function m(){var a=$("#inputAboutMe");$("#aboutMeCharCountLeft").html(d(a,ajaxify.data.maximumAboutMeLength));a.on("keyup change",function(){$("#aboutMeCharCountLeft").html(d(a,ajaxify.data.maximumAboutMeLength))})}return r});
//# sourceMappingURL=public/src/client/account/edit.js.map