{"version":3,"sources":["public/src/client/account/info.js"],"names":["define","header","components","Info","init","handleModerationNote","prepareSessionRevoking","$","on","note","val","socket","emit","uid","ajaxify","data","err","app","alertError","message","alertSuccess","timestamp","Date","now","user","timestampISO","utils","toISOString","parseAndTranslate","moderationNotes","html","prepend","find","timeago","get","parentEl","this","parents","uuid","attr","ajax","url","config","relative_path","userslug","method","headers","x-csrf-token","csrf_token","done","remove","fail","errorObj","JSON","parse","responseText","loggedIn","window","location","href","title","e"],"mappings":"AAAA,aAGAA,OAAO,sBAAuB,uBAAwB,cAAe,SAAUC,EAAQC,GACtF,IAAIC,KAEJA,EAAKC,KAAO,WACXH,EAAOG,OACPC,IACAC,KAGD,SAASD,IACRE,EAAE,8CAA8CC,GAAG,QAAS,WAC3D,IAAIC,EAAOF,EAAE,yCAAyCG,MACtDC,OAAOC,KAAK,0BAA4BC,IAAKC,QAAQC,KAAKF,IAAKJ,KAAMA,GAAQ,SAAUO,GACtF,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BZ,EAAE,yCAAyCG,IAAI,IAC/CO,IAAIG,aAAa,yCACjB,IAAIC,EAAYC,KAAKC,MACrB,IAAIR,IACHN,KAAMA,EACNe,KAAMP,IAAIO,KACVH,UAAWA,EACXI,aAAcC,MAAMC,YAAYN,KAEjCJ,IAAIW,kBAAkB,eAAgB,mBAAqBC,gBAAiBd,GAAQ,SAAUe,GAC7FvB,EAAE,8CAA8CwB,QAAQD,GACxDA,EAAKE,KAAK,YAAYC,gBAM1B,SAAS3B,IACRJ,EAAWgC,IAAI,iBAAiB1B,GAAG,QAAS,gBAAiB,WAC5D,IAAI2B,EAAW5B,EAAE6B,MAAMC,QAAQ,eAC/B,IAAIC,EAAOH,EAASI,KAAK,aAEzB,GAAID,EAAM,CAGT/B,EAAEiC,MACDC,IAAKC,OAAOC,cAAgB,aAAe7B,QAAQC,KAAK6B,SAAW,YAAcN,EACjFO,OAAQ,SACRC,SACCC,eAAgBL,OAAOM,cAEtBC,KAAK,WACPd,EAASe,WACPC,KAAK,SAAUnC,GACjB,IACC,IAAIoC,EAAWC,KAAKC,MAAMtC,EAAIuC,cAC9B,GAAIH,EAASI,WAAa,MAAO,CAChCC,OAAOC,SAASC,KAAOjB,OAAOC,cAAgB,gBAAkBS,EAASQ,MAE1E3C,IAAIC,WAAWkC,EAASQ,OACvB,MAAOC,GACR5C,IAAIC,WAAW,gCAOpB,OAAOf","file":"public/src/client/account/info.js","sourcesContent":["'use strict';\n\n\ndefine('forum/account/info', ['forum/account/header', 'components'], function (header, components) {\n\tvar Info = {};\n\n\tInfo.init = function () {\n\t\theader.init();\n\t\thandleModerationNote();\n\t\tprepareSessionRevoking();\n\t};\n\n\tfunction handleModerationNote() {\n\t\t$('[component=\"account/save-moderation-note\"]').on('click', function () {\n\t\t\tvar note = $('[component=\"account/moderation-note\"]').val();\n\t\t\tsocket.emit('user.setModerationNote', { uid: ajaxify.data.uid, note: note }, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\t$('[component=\"account/moderation-note\"]').val('');\n\t\t\t\tapp.alertSuccess('[[user:info.moderation-note.success]]');\n\t\t\t\tvar timestamp = Date.now();\n\t\t\t\tvar data = [{\n\t\t\t\t\tnote: note,\n\t\t\t\t\tuser: app.user,\n\t\t\t\t\ttimestamp: timestamp,\n\t\t\t\t\ttimestampISO: utils.toISOString(timestamp),\n\t\t\t\t}];\n\t\t\t\tapp.parseAndTranslate('account/info', 'moderationNotes', { moderationNotes: data }, function (html) {\n\t\t\t\t\t$('[component=\"account/moderation-note/list\"]').prepend(html);\n\t\t\t\t\thtml.find('.timeago').timeago();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction prepareSessionRevoking() {\n\t\tcomponents.get('user/sessions').on('click', '[data-action]', function () {\n\t\t\tvar parentEl = $(this).parents('[data-uuid]');\n\t\t\tvar uuid = parentEl.attr('data-uuid');\n\n\t\t\tif (uuid) {\n\t\t\t\t// This is done via DELETE because a user shouldn't be able to\n\t\t\t\t// revoke his own session! This is what logout is for\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: config.relative_path + '/api/user/' + ajaxify.data.userslug + '/session/' + uuid,\n\t\t\t\t\tmethod: 'delete',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'x-csrf-token': config.csrf_token,\n\t\t\t\t\t},\n\t\t\t\t}).done(function () {\n\t\t\t\t\tparentEl.remove();\n\t\t\t\t}).fail(function (err) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar errorObj = JSON.parse(err.responseText);\n\t\t\t\t\t\tif (errorObj.loggedIn === false) {\n\t\t\t\t\t\t\twindow.location.href = config.relative_path + '/login?error=' + errorObj.title;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.alertError(errorObj.title);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tapp.alertError('[[error:invalid-data]]');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\treturn Info;\n});\n"]}