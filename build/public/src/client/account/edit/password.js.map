{"version":3,"sources":["public/src/client/account/edit/password.js"],"names":["define","header","translator","zxcvbn","AccountEditPassword","init","handlePasswordChange","currentPassword","$","password_notify","password_confirm_notify","password","password_confirm","passwordvalid","passwordsmatch","onPasswordChanged","passwordStrength","val","length","ajaxify","data","minimumPasswordLength","showError","utils","isPasswordValid","username","email","score","minimumPasswordStrength","showSuccess","onPasswordConfirmChanged","parent","removeClass","children","show","find","html","on","btn","this","app","user","isAdmin","addClass","socket","emit","newPassword","uid","theirid","err","alertError","message","window","location","href","config","relative_path","element","msg","translate"],"mappings":"AAAA,aAGAA,OAAO,+BAAgC,uBAAwB,aAAc,UAAW,SAAUC,EAAQC,EAAYC,GACrH,IAAIC,KAEJA,EAAoBC,KAAO,WAC1BJ,EAAOI,OAEPC,KAGD,SAASA,IACR,IAAIC,EAAkBC,EAAE,yBACxB,IAAIC,EAAkBD,EAAE,oBACxB,IAAIE,EAA0BF,EAAE,4BAChC,IAAIG,EAAWH,EAAE,qBACjB,IAAII,EAAmBJ,EAAE,0BACzB,IAAIK,EAAgB,MACpB,IAAIC,EAAiB,MAErB,SAASC,IACR,IAAIC,EAAmBb,EAAOQ,EAASM,OACvCJ,EAAgB,MAChB,GAAIF,EAASM,MAAMC,OAASC,QAAQC,KAAKC,sBAAuB,CAC/DC,EAAUb,EAAiB,8CACrB,IAAKc,MAAMC,gBAAgBb,EAASM,OAAQ,CAClDK,EAAUb,EAAiB,uCACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKK,SAAU,CACpDH,EAAUb,EAAiB,2CACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKM,MAAO,CACjDJ,EAAUb,EAAiB,wCACrB,GAAIO,EAAiBW,MAAQR,QAAQC,KAAKQ,wBAAyB,CACzEN,EAAUb,EAAiB,8BACrB,CACNoB,EAAYpB,GACZI,EAAgB,MAIlB,SAASiB,IACR,GAAInB,EAASM,QAAUL,EAAiBK,MAAO,CAC9CK,EAAUZ,EAAyB,wCACnCI,EAAiB,UACX,CACN,GAAIH,EAASM,MAAO,CACnBY,EAAYnB,OACN,CACNA,EAAwBqB,SAASC,YAAY,8BAC7CtB,EAAwBuB,WAAWC,OACnCxB,EAAwByB,KAAK,QAAQC,KAAK,IAG3CtB,EAAiB,MAInBH,EAAS0B,GAAG,OAAQtB,GACpBH,EAAiByB,GAAG,OAAQP,GAE5BtB,EAAE,sBAAsB6B,GAAG,QAAS,WACnCtB,IACAe,IAEA,IAAIQ,EAAM9B,EAAE+B,MACZ,GAAK1B,GAAiBC,GAAmB0B,IAAIC,KAAKC,QAAS,CAC1DJ,EAAIK,SAAS,YAAYR,KAAK,KAAKH,YAAY,QAC/CY,OAAOC,KAAK,uBACXtC,gBAAiBA,EAAgBU,MACjC6B,YAAanC,EAASM,MACtB8B,IAAK5B,QAAQC,KAAK4B,SAChB,SAAUC,GACZX,EAAIN,YAAY,YAAYG,KAAK,KAAKQ,SAAS,QAC/CpC,EAAgBU,IAAI,IACpBN,EAASM,IAAI,IACbL,EAAiBK,IAAI,IACrBH,EAAiB,MACjBD,EAAgB,MAEhB,GAAIoC,EAAK,CACRlC,IACAe,IACA,OAAOU,IAAIU,WAAWD,EAAIE,SAG3BC,OAAOC,SAASC,KAAOC,OAAOC,cAAgB,eAEzC,CACN,IAAK1C,EAAgB,CACpB0B,IAAIU,WAAW,wCAGhB,IAAKrC,EAAe,CACnB2B,IAAIU,WAAW,mCAGjB,OAAO,QAIT,SAAS5B,EAAUmC,EAASC,GAC3BxD,EAAWyD,UAAUD,EAAK,SAAUA,GACnCD,EAAQrB,KAAKsB,GAEbD,EAAQ1B,SACNC,YAAY,gBACZW,SAAS,iBAIb,SAASd,EAAY4B,GACpBA,EAAQrB,KAAK,IACbqB,EAAQ1B,SACNC,YAAY,eACZW,SAAS,gBAGZ,OAAOvC","file":"public/src/client/account/edit/password.js","sourcesContent":["'use strict';\n\n\ndefine('forum/account/edit/password', ['forum/account/header', 'translator', 'zxcvbn'], function (header, translator, zxcvbn) {\n\tvar AccountEditPassword = {};\n\n\tAccountEditPassword.init = function () {\n\t\theader.init();\n\n\t\thandlePasswordChange();\n\t};\n\n\tfunction handlePasswordChange() {\n\t\tvar currentPassword = $('#inputCurrentPassword');\n\t\tvar password_notify = $('#password-notify');\n\t\tvar password_confirm_notify = $('#password-confirm-notify');\n\t\tvar password = $('#inputNewPassword');\n\t\tvar password_confirm = $('#inputNewPasswordAgain');\n\t\tvar passwordvalid = false;\n\t\tvar passwordsmatch = false;\n\n\t\tfunction onPasswordChanged() {\n\t\t\tvar passwordStrength = zxcvbn(password.val());\n\t\t\tpasswordvalid = false;\n\t\t\tif (password.val().length < ajaxify.data.minimumPasswordLength) {\n\t\t\t\tshowError(password_notify, '[[user:change_password_error_length]]');\n\t\t\t} else if (!utils.isPasswordValid(password.val())) {\n\t\t\t\tshowError(password_notify, '[[user:change_password_error]]');\n\t\t\t} else if (password.val() === ajaxify.data.username) {\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_username]]');\n\t\t\t} else if (password.val() === ajaxify.data.email) {\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_email]]');\n\t\t\t} else if (passwordStrength.score < ajaxify.data.minimumPasswordStrength) {\n\t\t\t\tshowError(password_notify, '[[user:weak_password]]');\n\t\t\t} else {\n\t\t\t\tshowSuccess(password_notify);\n\t\t\t\tpasswordvalid = true;\n\t\t\t}\n\t\t}\n\n\t\tfunction onPasswordConfirmChanged() {\n\t\t\tif (password.val() !== password_confirm.val()) {\n\t\t\t\tshowError(password_confirm_notify, '[[user:change_password_error_match]]');\n\t\t\t\tpasswordsmatch = false;\n\t\t\t} else {\n\t\t\t\tif (password.val()) {\n\t\t\t\t\tshowSuccess(password_confirm_notify);\n\t\t\t\t} else {\n\t\t\t\t\tpassword_confirm_notify.parent().removeClass('alert-success alert-danger');\n\t\t\t\t\tpassword_confirm_notify.children().show();\n\t\t\t\t\tpassword_confirm_notify.find('.msg').html('');\n\t\t\t\t}\n\n\t\t\t\tpasswordsmatch = true;\n\t\t\t}\n\t\t}\n\n\t\tpassword.on('blur', onPasswordChanged);\n\t\tpassword_confirm.on('blur', onPasswordConfirmChanged);\n\n\t\t$('#changePasswordBtn').on('click', function () {\n\t\t\tonPasswordChanged();\n\t\t\tonPasswordConfirmChanged();\n\n\t\t\tvar btn = $(this);\n\t\t\tif ((passwordvalid && passwordsmatch) || app.user.isAdmin) {\n\t\t\t\tbtn.addClass('disabled').find('i').removeClass('hide');\n\t\t\t\tsocket.emit('user.changePassword', {\n\t\t\t\t\tcurrentPassword: currentPassword.val(),\n\t\t\t\t\tnewPassword: password.val(),\n\t\t\t\t\tuid: ajaxify.data.theirid,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tbtn.removeClass('disabled').find('i').addClass('hide');\n\t\t\t\t\tcurrentPassword.val('');\n\t\t\t\t\tpassword.val('');\n\t\t\t\t\tpassword_confirm.val('');\n\t\t\t\t\tpasswordsmatch = false;\n\t\t\t\t\tpasswordvalid = false;\n\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tonPasswordChanged();\n\t\t\t\t\t\tonPasswordConfirmChanged();\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.location.href = config.relative_path + '/login';\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (!passwordsmatch) {\n\t\t\t\t\tapp.alertError('[[user:change_password_error_match]]');\n\t\t\t\t}\n\n\t\t\t\tif (!passwordvalid) {\n\t\t\t\t\tapp.alertError('[[user:change_password_error]]');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction showError(element, msg) {\n\t\ttranslator.translate(msg, function (msg) {\n\t\t\telement.html(msg);\n\n\t\t\telement.parent()\n\t\t\t\t.removeClass('show-success')\n\t\t\t\t.addClass('show-danger');\n\t\t});\n\t}\n\n\tfunction showSuccess(element) {\n\t\telement.html('');\n\t\telement.parent()\n\t\t\t.removeClass('show-danger')\n\t\t\t.addClass('show-success');\n\t}\n\n\treturn AccountEditPassword;\n});\n"]}