{"version":3,"sources":["public/src/client/account/header.js"],"names":["define","coverPhoto","pictureCropper","components","translator","AccountHeader","isAdminOrSelfOrGlobalMod","init","ajaxify","data","isAdmin","isSelf","isGlobalModerator","hidePrivateLinks","selectActivePill","setupCoverPhoto","get","on","toggleFollow","socket","emit","uid","err","roomId","app","alertError","message","openChat","newChat","parent","removeClass","banAccount","unbanAccount","deleteAccount","flagAccount","user","parseInt","theirid","$","addClass","each","href","this","find","attr","decodeURIComponent","window","location","pathname","imageData","position","callback","show","title","socketMethod","aspectRatio","NaN","allowSkippingCrop","restrictImageDimension","paramName","paramValue","accept","imageUrlOnServer","css","config","removeCover","type","toggleClass","alertSuccess","username","templates","parse","html","bootbox","dialog","className","buttons","close","label","submit","formData","serializeArray","reduce","cur","name","value","until","length","Date","now","unit","uids","reason","refresh","translate","translated","confirm","history","back","require","flags","showFlagModal","id"],"mappings":"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","file":"public/src/client/account/header.js","sourcesContent":["'use strict';\n\n\ndefine('forum/account/header', [\n\t'coverPhoto',\n\t'pictureCropper',\n\t'components',\n\t'translator',\n], function (coverPhoto, pictureCropper, components, translator) {\n\tvar AccountHeader = {};\n\tvar isAdminOrSelfOrGlobalMod;\n\n\tAccountHeader.init = function () {\n\t\tisAdminOrSelfOrGlobalMod = ajaxify.data.isAdmin || ajaxify.data.isSelf || ajaxify.data.isGlobalModerator;\n\n\t\thidePrivateLinks();\n\t\tselectActivePill();\n\n\t\tif (isAdminOrSelfOrGlobalMod) {\n\t\t\tsetupCoverPhoto();\n\t\t}\n\n\t\tcomponents.get('account/follow').on('click', function () {\n\t\t\ttoggleFollow('follow');\n\t\t});\n\n\t\tcomponents.get('account/unfollow').on('click', function () {\n\t\t\ttoggleFollow('unfollow');\n\t\t});\n\n\t\tcomponents.get('account/chat').on('click', function () {\n\t\t\tsocket.emit('modules.chats.hasPrivateChat', ajaxify.data.uid, function (err, roomId) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tif (roomId) {\n\t\t\t\t\tapp.openChat(roomId);\n\t\t\t\t} else {\n\t\t\t\t\tapp.newChat(ajaxify.data.uid);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tcomponents.get('account/new-chat').on('click', function () {\n\t\t\tapp.newChat(ajaxify.data.uid, function () {\n\t\t\t\tcomponents.get('account/chat').parent().removeClass('hidden');\n\t\t\t});\n\t\t});\n\n\n\t\tcomponents.get('account/ban').on('click', banAccount);\n\t\tcomponents.get('account/unban').on('click', unbanAccount);\n\t\tcomponents.get('account/delete').on('click', deleteAccount);\n\t\tcomponents.get('account/flag').on('click', flagAccount);\n\t};\n\n\tfunction hidePrivateLinks() {\n\t\tif (!app.user.uid || app.user.uid !== parseInt(ajaxify.data.theirid, 10)) {\n\t\t\t$('.account-sub-links .plugin-link.private').addClass('hide');\n\t\t}\n\t}\n\n\tfunction selectActivePill() {\n\t\t$('.account-sub-links li').removeClass('active').each(function () {\n\t\t\tvar href = $(this).find('a').attr('href');\n\n\t\t\tif (decodeURIComponent(href) === decodeURIComponent(window.location.pathname)) {\n\t\t\t\t$(this).addClass('active');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction setupCoverPhoto() {\n\t\tcoverPhoto.init(components.get('account/cover'),\n\t\t\tfunction (imageData, position, callback) {\n\t\t\t\tsocket.emit('user.updateCover', {\n\t\t\t\t\tuid: ajaxify.data.uid,\n\t\t\t\t\timageData: imageData,\n\t\t\t\t\tposition: position,\n\t\t\t\t}, callback);\n\t\t\t},\n\t\t\tfunction () {\n\t\t\t\tpictureCropper.show({\n\t\t\t\t\ttitle: '[[user:upload_cover_picture]]',\n\t\t\t\t\tsocketMethod: 'user.updateCover',\n\t\t\t\t\taspectRatio: NaN,\n\t\t\t\t\tallowSkippingCrop: true,\n\t\t\t\t\trestrictImageDimension: false,\n\t\t\t\t\tparamName: 'uid',\n\t\t\t\t\tparamValue: ajaxify.data.theirid,\n\t\t\t\t\taccept: '.png,.jpg,.bmp',\n\t\t\t\t}, function (imageUrlOnServer) {\n\t\t\t\t\tcomponents.get('account/cover').css('background-image', 'url(' + imageUrlOnServer + '?' + config['cache-buster'] + ')');\n\t\t\t\t});\n\t\t\t},\n\t\t\tremoveCover\n\t\t);\n\t}\n\n\tfunction toggleFollow(type) {\n\t\tsocket.emit('user.' + type, {\n\t\t\tuid: ajaxify.data.uid,\n\t\t}, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tcomponents.get('account/follow').toggleClass('hide', type === 'follow');\n\t\t\tcomponents.get('account/unfollow').toggleClass('hide', type === 'unfollow');\n\t\t\tapp.alertSuccess('[[global:alert.' + type + ', ' + ajaxify.data.username + ']]');\n\t\t});\n\t\treturn false;\n\t}\n\n\tfunction banAccount() {\n\t\ttemplates.parse('admin/partials/temporary-ban', {}, function (html) {\n\t\t\tbootbox.dialog({\n\t\t\t\tclassName: 'ban-modal',\n\t\t\t\ttitle: '[[user:ban_account]]',\n\t\t\t\tmessage: html,\n\t\t\t\tshow: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tclose: {\n\t\t\t\t\t\tlabel: '[[global:close]]',\n\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t},\n\t\t\t\t\tsubmit: {\n\t\t\t\t\t\tlabel: '[[user:ban_account]]',\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\tvar formData = $('.ban-modal form').serializeArray().reduce(function (data, cur) {\n\t\t\t\t\t\t\t\tdata[cur.name] = cur.value;\n\t\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t\tvar until = parseInt(formData.length, 10) ? (Date.now() + (formData.length * 1000 * 60 * 60 * (parseInt(formData.unit, 10) ? 24 : 1))) : 0;\n\n\t\t\t\t\t\t\tsocket.emit('user.banUsers', {\n\t\t\t\t\t\t\t\tuids: [ajaxify.data.theirid],\n\t\t\t\t\t\t\t\tuntil: until,\n\t\t\t\t\t\t\t\treason: formData.reason || '',\n\t\t\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction unbanAccount() {\n\t\tsocket.emit('user.unbanUsers', [ajaxify.data.theirid], function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tajaxify.refresh();\n\t\t});\n\t}\n\n\tfunction deleteAccount() {\n\t\ttranslator.translate('[[user:delete_this_account_confirm]]', function (translated) {\n\t\t\tbootbox.confirm(translated, function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit('admin.user.deleteUsersAndContent', [ajaxify.data.theirid], function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[user:account-deleted]]');\n\t\t\t\t\thistory.back();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction flagAccount() {\n\t\trequire(['flags'], function (flags) {\n\t\t\tflags.showFlagModal({\n\t\t\t\ttype: 'user',\n\t\t\t\tid: ajaxify.data.uid,\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction removeCover() {\n\t\ttranslator.translate('[[user:remove_cover_picture_confirm]]', function (translated) {\n\t\t\tbootbox.confirm(translated, function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit('user.removeCover', {\n\t\t\t\t\tuid: ajaxify.data.uid,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (!err) {\n\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapp.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\treturn AccountHeader;\n});\n"]}