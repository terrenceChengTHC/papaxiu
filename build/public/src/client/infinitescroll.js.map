{"version":3,"sources":["public/src/client/infinitescroll.js"],"names":["define","scroll","callback","previousScrollTop","loadingMore","container","init","el","cb","$","window","off","onScroll","on","bsEnv","utils","findBootstrapEnvironment","mobileComposerOpen","hasClass","currentScrollTop","scrollTop","wh","height","viewportHeight","offsetTop","offset","top","scrollPercent","bottom","direction","loadMore","method","data","hookData","trigger","socket","emit","err","app","alertError","message","removeExtra","els","count","length","removeCount","document","slice","remove"],"mappings":"AAAA,aAGAA,OAAO,uBAAwB,WAC9B,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAAoB,EACxB,IAAIC,EAAc,MAClB,IAAIC,EAEJJ,EAAOK,KAAO,SAAUC,EAAIC,GAC3B,UAAWD,IAAO,WAAY,CAC7BL,EAAWK,EACXF,EAAYI,EAAE,YACR,CACNP,EAAWM,EACXH,EAAYE,GAAME,EAAE,QAGrBA,EAAEC,QAAQC,IAAI,SAAUC,GAAUC,GAAG,SAAUD,IAGhD,SAASA,IACR,IAAIE,EAAQC,MAAMC,2BAClB,IAAIC,GAAsBH,IAAU,MAAQA,IAAU,OAASL,EAAE,QAAQS,SAAS,aAClF,GAAId,GAAea,EAAoB,CACtC,OAED,IAAIE,EAAmBV,EAAEC,QAAQU,YACjC,IAAIC,EAAKZ,EAAEC,QAAQY,SACnB,IAAIC,EAAiBlB,EAAUiB,SAAWD,EAC1C,IAAIG,EAAYnB,EAAUoB,SAAWpB,EAAUoB,SAASC,IAAM,EAC9D,IAAIC,EAAgB,KAAOR,EAAmBK,IAAcD,GAAkB,EAAIF,EAAKE,GAEvF,IAAIG,EAAM,GACV,IAAIE,EAAS,GAEb,IAAIC,EAAYV,EAAmBhB,EAAoB,GAAK,EAE5D,GAAIwB,EAAgBD,GAAOP,EAAmBhB,EAAmB,CAChED,EAAS2B,QACH,GAAIF,EAAgBC,GAAUT,EAAmBhB,EAAmB,CAC1ED,EAAS2B,QACH,GAAIF,EAAgB,GAAKE,EAAY,GAAKN,EAAiB,EAAG,CACpErB,EAAS2B,GAGV1B,EAAoBgB,EAGrBlB,EAAO6B,SAAW,SAAUC,EAAQC,EAAM9B,GACzC,GAAIE,EAAa,CAChB,OAEDA,EAAc,KAEd,IAAI6B,GAAaF,OAAQA,EAAQC,KAAMA,GACvCvB,EAAEC,QAAQwB,QAAQ,iCAAkCD,GAEpDE,OAAOC,KAAKH,EAASF,OAAQE,EAASD,KAAM,SAAUK,EAAKL,GAC1D,GAAIK,EAAK,CACRjC,EAAc,MACd,OAAOkC,IAAIC,WAAWF,EAAIG,SAE3BtC,EAAS8B,EAAM,WACd5B,EAAc,WAKjBH,EAAOwC,YAAc,SAAUC,EAAKb,EAAWc,GAC9C,GAAID,EAAIE,QAAUD,EAAO,CACxB,OAGD,IAAIE,EAAcH,EAAIE,OAASD,EAC/B,GAAId,EAAY,EAAG,CAClB,IAAIP,EAASb,EAAEqC,UAAUxB,SACzB,IAAIF,EAAYX,EAAEC,QAAQU,YAE1BsB,EAAIK,MAAM,EAAGF,GAAaG,SAE1BvC,EAAEC,QAAQU,UAAUA,GAAaX,EAAEqC,UAAUxB,SAAWA,QAClD,CACNoB,EAAIK,MAAML,EAAIE,OAASC,GAAaG,WAItC,OAAO/C","file":"public/src/client/infinitescroll.js","sourcesContent":["'use strict';\n\n\ndefine('forum/infinitescroll', function () {\n\tvar scroll = {};\n\tvar callback;\n\tvar previousScrollTop = 0;\n\tvar loadingMore\t= false;\n\tvar container;\n\n\tscroll.init = function (el, cb) {\n\t\tif (typeof el === 'function') {\n\t\t\tcallback = el;\n\t\t\tcontainer = $('body');\n\t\t} else {\n\t\t\tcallback = cb;\n\t\t\tcontainer = el || $('body');\n\t\t}\n\n\t\t$(window).off('scroll', onScroll).on('scroll', onScroll);\n\t};\n\n\tfunction onScroll() {\n\t\tvar bsEnv = utils.findBootstrapEnvironment();\n\t\tvar mobileComposerOpen = (bsEnv === 'xs' || bsEnv === 'sm') && $('html').hasClass('composing');\n\t\tif (loadingMore || mobileComposerOpen) {\n\t\t\treturn;\n\t\t}\n\t\tvar currentScrollTop = $(window).scrollTop();\n\t\tvar wh = $(window).height();\n\t\tvar viewportHeight = container.height() - wh;\n\t\tvar offsetTop = container.offset() ? container.offset().top : 0;\n\t\tvar scrollPercent = 100 * (currentScrollTop - offsetTop) / (viewportHeight <= 0 ? wh : viewportHeight);\n\n\t\tvar top = 20;\n\t\tvar bottom = 80;\n\n\t\tvar direction = currentScrollTop > previousScrollTop ? 1 : -1;\n\n\t\tif (scrollPercent < top && currentScrollTop < previousScrollTop) {\n\t\t\tcallback(direction);\n\t\t} else if (scrollPercent > bottom && currentScrollTop > previousScrollTop) {\n\t\t\tcallback(direction);\n\t\t} else if (scrollPercent < 0 && direction > 0 && viewportHeight < 0) {\n\t\t\tcallback(direction);\n\t\t}\n\n\t\tpreviousScrollTop = currentScrollTop;\n\t}\n\n\tscroll.loadMore = function (method, data, callback) {\n\t\tif (loadingMore) {\n\t\t\treturn;\n\t\t}\n\t\tloadingMore = true;\n\n\t\tvar hookData = { method: method, data: data };\n\t\t$(window).trigger('action:infinitescroll.loadmore', hookData);\n\n\t\tsocket.emit(hookData.method, hookData.data, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\tloadingMore = false;\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tcallback(data, function () {\n\t\t\t\tloadingMore = false;\n\t\t\t});\n\t\t});\n\t};\n\n\tscroll.removeExtra = function (els, direction, count) {\n\t\tif (els.length <= count) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar removeCount = els.length - count;\n\t\tif (direction > 0) {\n\t\t\tvar height = $(document).height();\n\t\t\tvar scrollTop = $(window).scrollTop();\n\n\t\t\tels.slice(0, removeCount).remove();\n\n\t\t\t$(window).scrollTop(scrollTop + ($(document).height() - height));\n\t\t} else {\n\t\t\tels.slice(els.length - removeCount).remove();\n\t\t}\n\t};\n\n\treturn scroll;\n});\n"]}