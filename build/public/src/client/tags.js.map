{"version":3,"sources":["public/src/client/tags.js"],"names":["define","infinitescroll","Tags","timeoutId","init","app","enterRoom","$","on","clearTimeout","val","length","resetSearch","setTimeout","socket","emit","query","err","results","alertError","message","onTagsLoaded","tags","loadMoreTags","direction","loadMore","after","attr","data","done","nextStart","replace","callback","parseAndTranslate","html","utils","makeNumbersHumanReadable","find"],"mappings":"AAAA,aAGAA,OAAO,cAAe,wBAAyB,SAAUC,GACxD,IAAIC,KACJ,IAAIC,EAAY,EAEhBD,EAAKE,KAAO,WACXC,IAAIC,UAAU,QAEdC,EAAE,eAAeC,GAAG,uBAAwB,WAC3C,GAAIL,EAAW,CACdM,aAAaN,GACbA,EAAY,EAGb,IAAKI,EAAE,eAAeG,MAAMC,OAAQ,CACnC,OAAOC,IAGRT,EAAYU,WAAW,WACtBC,OAAOC,KAAK,4BAA8BC,MAAOT,EAAE,eAAeG,OAAS,SAAUO,EAAKC,GACzF,GAAID,EAAK,CACR,OAAOZ,IAAIc,WAAWF,EAAIG,SAE3BC,EAAaH,EAAQI,KAAM,KAAM,WAChCnB,EAAY,OAGZ,OAGJF,EAAeG,KAAKF,EAAKqB,eAG1BrB,EAAKqB,aAAe,SAAUC,GAC7B,GAAIA,EAAY,IAAMjB,EAAE,aAAaI,QAAUJ,EAAE,eAAeG,MAAO,CACtE,OAGDT,EAAewB,SAAS,uBACvBC,MAAOnB,EAAE,aAAaoB,KAAK,mBACzB,SAAUC,EAAMC,GAClB,GAAID,GAAQA,EAAKN,MAAQM,EAAKN,KAAKX,OAAQ,CAC1CU,EAAaO,EAAKN,KAAM,MAAOO,GAC/BtB,EAAE,aAAaoB,KAAK,iBAAkBC,EAAKE,eACrC,CACND,QAKH,SAASjB,IACRE,OAAOC,KAAK,uBACXW,MAAO,GACL,SAAUT,EAAKW,GACjB,GAAIX,EAAK,CACR,OAAOZ,IAAIc,WAAWF,EAAIG,SAE3BC,EAAaO,EAAKN,KAAM,QAI1B,SAASD,EAAaC,EAAMS,EAASC,GACpCA,EAAWA,GAAY,aACvB3B,IAAI4B,kBAAkB,OAAQ,QAAUX,KAAMA,GAAQ,SAAUY,GAC/D3B,EAAE,aAAawB,EAAU,OAAS,UAAUG,GAC5CC,MAAMC,yBAAyBF,EAAKG,KAAK,2BACzCL,MAIF,OAAO9B","file":"public/src/client/tags.js","sourcesContent":["'use strict';\n\n\ndefine('forum/tags', ['forum/infinitescroll'], function (infinitescroll) {\n\tvar Tags = {};\n\tvar timeoutId = 0;\n\n\tTags.init = function () {\n\t\tapp.enterRoom('tags');\n\n\t\t$('#tag-search').on('input propertychange', function () {\n\t\t\tif (timeoutId) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\n\t\t\tif (!$('#tag-search').val().length) {\n\t\t\t\treturn resetSearch();\n\t\t\t}\n\n\t\t\ttimeoutId = setTimeout(function () {\n\t\t\t\tsocket.emit('topics.searchAndLoadTags', { query: $('#tag-search').val() }, function (err, results) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tonTagsLoaded(results.tags, true, function () {\n\t\t\t\t\t\ttimeoutId = 0;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, 100);\n\t\t});\n\n\t\tinfinitescroll.init(Tags.loadMoreTags);\n\t};\n\n\tTags.loadMoreTags = function (direction) {\n\t\tif (direction < 0 || !$('.tag-list').length || $('#tag-search').val()) {\n\t\t\treturn;\n\t\t}\n\n\t\tinfinitescroll.loadMore('topics.loadMoreTags', {\n\t\t\tafter: $('.tag-list').attr('data-nextstart'),\n\t\t}, function (data, done) {\n\t\t\tif (data && data.tags && data.tags.length) {\n\t\t\t\tonTagsLoaded(data.tags, false, done);\n\t\t\t\t$('.tag-list').attr('data-nextstart', data.nextStart);\n\t\t\t} else {\n\t\t\t\tdone();\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction resetSearch() {\n\t\tsocket.emit('topics.loadMoreTags', {\n\t\t\tafter: 0,\n\t\t}, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tonTagsLoaded(data.tags, true);\n\t\t});\n\t}\n\n\tfunction onTagsLoaded(tags, replace, callback) {\n\t\tcallback = callback || function () {};\n\t\tapp.parseAndTranslate('tags', 'tags', { tags: tags }, function (html) {\n\t\t\t$('.tag-list')[replace ? 'html' : 'append'](html);\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\n\t\t\tcallback();\n\t\t});\n\t}\n\n\treturn Tags;\n});\n"]}