{"version":3,"sources":["public/src/client/topic/delete-posts.js"],"names":["define","components","postSelect","DeletePosts","modal","deleteBtn","purgeBtn","init","$","on","onDeletePostsClicked","window","onAjaxifyStart","closeModal","off","app","parseAndTranslate","html","append","find","checkButtonEnable","showPostsSelected","deletePosts","btn","command","attr","socket","emit","tid","ajaxify","data","pids","err","removeAttr","alertError","message","length","translateHtml","forEach","pid","get","toggleClass","remove","enableClicksOnPosts"],"mappings":"AAAA,aAGAA,OAAO,4BAA6B,aAAc,cAAe,SAAUC,EAAYC,GACtF,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAAYI,KAAO,WAClBC,EAAE,UAAUC,GAAG,QAAS,mCAAoCC,GAC5DF,EAAEG,QAAQF,GAAG,uBAAwBG,IAGtC,SAASA,IACRC,IACAL,EAAEG,QAAQG,IAAI,uBAAwBF,GAGvC,SAASF,IACRK,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClEb,EAAQa,EAERT,EAAE,QAAQU,OAAOd,GAEjBC,EAAYD,EAAMe,KAAK,yBACvBb,EAAWF,EAAMe,KAAK,wBAEtBf,EAAMe,KAAK,+BAA+BV,GAAG,QAASI,GAEtDX,EAAWK,KAAK,WACfa,IACAC,MAEDA,IAEAhB,EAAUI,GAAG,QAAS,WACrBa,EAAYjB,EAAW,uBAExBC,EAASG,GAAG,QAAS,WACpBa,EAAYhB,EAAU,wBAKzB,SAASgB,EAAYC,EAAKC,GACzBD,EAAIE,KAAK,WAAY,MACrBC,OAAOC,KAAKH,GACXI,IAAKC,QAAQC,KAAKF,IAClBG,KAAM7B,EAAW6B,MACf,SAAUC,GACZT,EAAIU,WAAW,YACf,GAAID,EAAK,CACR,OAAOjB,IAAImB,WAAWF,EAAIG,SAG3BtB,MAIF,SAASQ,IACR,GAAInB,EAAW6B,KAAKK,OAAQ,CAC3BhC,EAAMe,KAAK,SAASkB,cAAc,2BAA6BnC,EAAW6B,KAAKK,OAAS,UAClF,CACNhC,EAAMe,KAAK,SAASkB,cAAc,2BAIpC,SAASjB,IACR,GAAIlB,EAAW6B,KAAKK,OAAQ,CAC3B/B,EAAU4B,WAAW,YACrB3B,EAAS2B,WAAW,gBACd,CACN5B,EAAUoB,KAAK,WAAY,MAC3BnB,EAASmB,KAAK,WAAY,OAI5B,SAASZ,IACRX,EAAW6B,KAAKO,QAAQ,SAAUC,GACjCtC,EAAWuC,IAAI,OAAQ,MAAOD,GAAKE,YAAY,aAAc,SAG9D,GAAIrC,EAAO,CACVA,EAAMsC,SACNtC,EAAQ,KAGTH,EAAWuC,IAAI,SAAS1B,IAAI,QAAS,cACrCZ,EAAWyC,sBAGZ,OAAOxC","file":"public/src/client/topic/delete-posts.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/delete-posts', ['components', 'postSelect'], function (components, postSelect) {\n\tvar DeletePosts = {};\n\tvar modal;\n\tvar deleteBtn;\n\tvar purgeBtn;\n\n\tDeletePosts.init = function () {\n\t\t$('.topic').on('click', '[component=\"topic/delete/posts\"]', onDeletePostsClicked);\n\t\t$(window).on('action:ajaxify.start', onAjaxifyStart);\n\t};\n\n\tfunction onAjaxifyStart() {\n\t\tcloseModal();\n\t\t$(window).off('action:ajaxify.start', onAjaxifyStart);\n\t}\n\n\tfunction onDeletePostsClicked() {\n\t\tapp.parseAndTranslate('partials/delete_posts_modal', {}, function (html) {\n\t\t\tmodal = html;\n\n\t\t\t$('body').append(modal);\n\n\t\t\tdeleteBtn = modal.find('#delete_posts_confirm');\n\t\t\tpurgeBtn = modal.find('#purge_posts_confirm');\n\n\t\t\tmodal.find('.close,#delete_posts_cancel').on('click', closeModal);\n\n\t\t\tpostSelect.init(function () {\n\t\t\t\tcheckButtonEnable();\n\t\t\t\tshowPostsSelected();\n\t\t\t});\n\t\t\tshowPostsSelected();\n\n\t\t\tdeleteBtn.on('click', function () {\n\t\t\t\tdeletePosts(deleteBtn, 'posts.deletePosts');\n\t\t\t});\n\t\t\tpurgeBtn.on('click', function () {\n\t\t\t\tdeletePosts(purgeBtn, 'posts.purgePosts');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction deletePosts(btn, command) {\n\t\tbtn.attr('disabled', true);\n\t\tsocket.emit(command, {\n\t\t\ttid: ajaxify.data.tid,\n\t\t\tpids: postSelect.pids,\n\t\t}, function (err) {\n\t\t\tbtn.removeAttr('disabled');\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tcloseModal();\n\t\t});\n\t}\n\n\tfunction showPostsSelected() {\n\t\tif (postSelect.pids.length) {\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\n\t\t} else {\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\n\t\t}\n\t}\n\n\tfunction checkButtonEnable() {\n\t\tif (postSelect.pids.length) {\n\t\t\tdeleteBtn.removeAttr('disabled');\n\t\t\tpurgeBtn.removeAttr('disabled');\n\t\t} else {\n\t\t\tdeleteBtn.attr('disabled', true);\n\t\t\tpurgeBtn.attr('disabled', true);\n\t\t}\n\t}\n\n\tfunction closeModal() {\n\t\tpostSelect.pids.forEach(function (pid) {\n\t\t\tcomponents.get('post', 'pid', pid).toggleClass('bg-success', false);\n\t\t});\n\n\t\tif (modal) {\n\t\t\tmodal.remove();\n\t\t\tmodal = null;\n\t\t}\n\n\t\tcomponents.get('topic').off('click', '[data-pid]');\n\t\tpostSelect.enableClicksOnPosts();\n\t}\n\n\treturn DeletePosts;\n});\n"]}