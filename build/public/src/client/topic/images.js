"use strict";define("forum/topic/images",["forum/topic/postTools","navigator","components"],function(t,a,e){var n={_imageLoaderTimeout:undefined};n.unloadImages=function(t){var a=t.find('[component="post/content"] img:not(.not-responsive)');if(config.delayImageLoading){a.each(function(){$(this).attr("data-src",$(this).attr("src"))}).attr("data-state","unloaded").attr("src","about:blank")}else{a.attr("data-state","loaded");n.wrapImagesInLinks(t)}};n.loadImages=function(t){if(n._imageLoaderTimeout){clearTimeout(n._imageLoaderTimeout)}if(!config.delayImageLoading){return}n._imageLoaderTimeout=setTimeout(function(){var a=e.get("post/content").find('img[data-state="unloaded"]');var i=a.filter(function(){return utils.isElementInViewport(this)});var o=$.unique(i.map(function(){return $(this).parents('[component="post"]').get(0)}));var r=$(window).scrollTop();var s=false;var c=[];var d;var l;function u(){s=true;d=document.body.clientHeight;$(this).attr("data-state","loaded");l=document.body.clientHeight;var a=this.getBoundingClientRect();if(a.top<t){r+=l-d;$(window).scrollTop(r)}if(c.length){c.pop()()}else{s=false;n.wrapImagesInLinks(o);o.length=0}}i.attr("data-state","loading");i.each(function(t,a){a=$(a);a.on("load",function(){if(!s){u.call(this)}else{c.push(u.bind(this))}});a.attr("src",a.attr("data-src"));a.removeAttr("data-src")})},250)};n.wrapImagesInLinks=function(t){t.find('[component="post/content"] img:not(.emoji)').each(function(){var t=$(this);var a=t.attr("src")||"";var e=t.attr("alt")||"";var n=/-resized(\.[\w]+)?$/;if(a==="about:blank"){return}if(utils.isRelativeUrl(a)&&n.test(a)){a=a.replace(n,"$1")}var i=a.split(".").slice(1).pop();var o=e.split("/").pop();var r=o.split(".").slice(1).pop();if(!t.parent().is("a")){t.wrap('<a href="'+a+'" '+(!i&&r?' download="'+o+'" ':"")+' target="_blank" >')}})};return n});
//# sourceMappingURL=public/src/client/topic/images.js.map