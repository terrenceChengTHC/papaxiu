"use strict";define("forum/topic/events",["forum/topic/postTools","forum/topic/threadTools","forum/topic/posts","forum/topic/images","components","translator"],function(t,e,o,a,n,i){var s={};var p={"event:user_status_change":r,"event:voted":d,"event:bookmarked":c,"event:topic_deleted":e.setDeleteState,"event:topic_restored":e.setDeleteState,"event:topic_purged":u,"event:topic_locked":e.setLockedState,"event:topic_unlocked":e.setLockedState,"event:topic_pinned":e.setPinnedState,"event:topic_unpinned":e.setPinnedState,"event:topic_moved":l,"event:post_edited":f,"event:post_purged":m,"event:post_deleted":v,"event:post_restored":v,"posts.bookmark":k,"posts.unbookmark":k,"posts.upvote":h,"posts.downvote":h,"posts.unvote":h,"event:new_notification":I,"event:new_post":o.onNewPost};s.init=function(){s.removeListeners();for(var t in p){if(p.hasOwnProperty(t)){socket.on(t,p[t])}}};s.removeListeners=function(){for(var t in p){if(p.hasOwnProperty(t)){socket.removeListener(t,p[t])}}};function r(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function d(t){var e=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});var o=$('.reputation[data-uid="'+t.post.uid+'"]');e.html(t.post.votes).attr("data-votes",t.post.votes);o.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function c(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function u(){if(ajaxify.data.category&&ajaxify.data.category.slug){ajaxify.go("category/"+ajaxify.data.category.slug,null,true)}}function l(t){if(t&&t.slug){ajaxify.go("topic/"+t.slug,null,true)}}function f(t){if(!t||!t.post){return}var e=n.get("post/content",t.post.pid).filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});var o=$('[data-pid="'+t.post.pid+'"] [component="post/editor"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});var s=n.get("topic/title");var p=n.get("navbar/title").find("span");var r=n.get("breadcrumb/current");if(s.length&&t.topic.title&&s.html()!==t.topic.title){ajaxify.data.title=t.topic.title;var d="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:d},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+d);s.fadeOut(250,function(){s.html(t.topic.title).fadeIn(250)});r.fadeOut(250,function(){r.html(t.topic.title).fadeIn(250)});p.fadeOut(250,function(){p.html(t.topic.title).fadeIn(250)})}e.fadeOut(250,function(){e.html(i.unescape(t.post.content));e.find("img:not(.not-responsive)").addClass("img-responsive");app.replaceSelfLinks(e.find("a"));a.wrapImagesInLinks(e.parent());a.unloadImages(e.parent());a.loadImages();e.fadeIn(250);var n={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};templates.parse("partials/topic/post-editor",n,function(e){i.translate(e,function(a){e=$(a);o.replaceWith(e);$('[data-pid="'+t.post.pid+'"] [component="post/editor"] .timeago').timeago();$(window).trigger("action:posts.edited",t)})})});if(t.topic.tags&&g(t.topic.tags)){templates.parse("partials/post_bar","tags",{tags:t.topic.tags},function(t){var e=$(".tags");e.fadeOut(250,function(){e.html(t).fadeIn(250)})})}}function g(t){if(t.length!==$(".tags").first().children().length){return true}for(var e=0;e<t.length;e+=1){if(!$('.tags .tag-item[data-tag="'+t[e].value+'"]').length){return true}}return false}function m(e){n.get("post","pid",e.pid).fadeOut(500,function(){$(this).remove();o.showBottomPostBar()});ajaxify.data.postcount-=1;t.updatePostCount(ajaxify.data.postcount);require(["forum/topic/replies"],function(t){t.onPostPurged(e)})}function v(e){var o=n.get("post","pid",e.pid);if(!o.length){return}o.toggleClass("deleted");var a=o.hasClass("deleted");t.toggle(e.pid,a);if(!ajaxify.data.privileges.isAdminOrMod&&parseInt(e.uid,10)!==parseInt(app.user.uid,10)){o.find('[component="post/tools"]').toggleClass("hidden",a);if(a){o.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]")}else{o.find('[component="post/content"]').html(i.unescape(e.content))}}}function k(t){var e=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});if(!e.length){return}e.attr("data-bookmarked",t.isBookmarked);e.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked);e.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked)}function h(t){var e=$('[data-pid="'+t.post.pid+'"]');e.find('[component="post/upvote"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("upvoted",t.upvote);e.find('[component="post/downvote"]').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("downvoted",t.downvote)}function I(t){var e=ajaxify.data.tid;if(t&&t.tid&&parseInt(t.tid,10)===parseInt(e,10)){socket.emit("topics.markTopicNotificationsRead",[e])}}return s});
//# sourceMappingURL=public/src/client/topic/events.js.map