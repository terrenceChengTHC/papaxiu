{"version":3,"sources":["public/src/client/topic/fork.js"],"names":["define","components","postSelect","Fork","forkModal","forkCommit","init","$","on","onForkThreadClicked","window","onAjaxifyStart","closeForkModal","off","app","parseAndTranslate","html","find","document","body","append","checkForkButtonEnable","showPostsSelected","createTopicFromPosts","attr","socket","emit","title","val","pids","fromTid","ajaxify","data","tid","err","newTopic","fadeOutAndRemove","pid","get","fadeOut","this","remove","removeAttr","alertError","message","alert","timeout","type","clickfn","go","slug","forEach","length","translateHtml","toggleClass","enableClicksOnPosts"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,aAAc,cAAe,SAAUC,EAAYC,GAC9E,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJF,EAAKG,KAAO,WACXC,EAAE,UAAUC,GAAG,QAAS,2BAA4BC,GACpDF,EAAEG,QAAQF,GAAG,uBAAwBG,IAGtC,SAASA,IACRC,IACAL,EAAEG,QAAQG,IAAI,uBAAwBF,GAGvC,SAASF,IACRK,IAAIC,kBAAkB,gCAAkC,SAAUC,GACjEZ,EAAYY,EAEZX,EAAaD,EAAUa,KAAK,uBAE5BV,EAAEW,SAASC,MAAMC,OAAOhB,GAExBA,EAAUa,KAAK,8BAA8BT,GAAG,QAASI,GACzDR,EAAUa,KAAK,eAAeT,GAAG,QAASa,GAE1CnB,EAAWI,KAAK,WACfe,IACAC,MAEDA,IAEAjB,EAAWG,GAAG,QAASe,KAIzB,SAASA,IACRlB,EAAWmB,KAAK,WAAY,MAC5BC,OAAOC,KAAK,+BACXC,MAAOvB,EAAUa,KAAK,eAAeW,MACrCC,KAAM3B,EAAW2B,KACjBC,QAASC,QAAQC,KAAKC,KACpB,SAAUC,EAAKC,GACjB,SAASC,EAAiBC,GACzBpC,EAAWqC,IAAI,OAAQ,MAAOD,GAAKE,QAAQ,IAAK,WAC/ChC,EAAEiC,MAAMC,WAGVpC,EAAWqC,WAAW,YACtB,GAAIR,EAAK,CACR,OAAOpB,IAAI6B,WAAWT,EAAIU,SAG3B9B,IAAI+B,OACHC,QAAS,IACTnB,MAAO,2BACPiB,QAAS,yBACTG,KAAM,UACNC,QAAS,WACRjB,QAAQkB,GAAG,SAAWd,EAASe,SAIjChD,EAAW2B,KAAKsB,QAAQ,SAAUd,GACjCD,EAAiBC,KAGlBzB,MAIF,SAASU,IACR,GAAIpB,EAAW2B,KAAKuB,OAAQ,CAC3BhD,EAAUa,KAAK,cAAcoC,cAAc,2BAA6BnD,EAAW2B,KAAKuB,OAAS,UAC3F,CACNhD,EAAUa,KAAK,cAAcoC,cAAc,2BAI7C,SAAShC,IACR,GAAIjB,EAAUa,KAAK,eAAeW,MAAMwB,QAAUlD,EAAW2B,KAAKuB,OAAQ,CACzE/C,EAAWqC,WAAW,gBAChB,CACNrC,EAAWmB,KAAK,WAAY,OAI9B,SAASZ,IACRV,EAAW2B,KAAKsB,QAAQ,SAAUd,GACjCpC,EAAWqC,IAAI,OAAQ,MAAOD,GAAKiB,YAAY,aAAc,SAG9D,GAAIlD,EAAW,CACdA,EAAUqC,SACVrC,EAAY,KAGbH,EAAWqC,IAAI,SAASzB,IAAI,QAAS,cACrCX,EAAWqD,sBAGZ,OAAOpD","file":"public/src/client/topic/fork.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/fork', ['components', 'postSelect'], function (components, postSelect) {\n\tvar Fork = {};\n\tvar forkModal;\n\tvar forkCommit;\n\n\tFork.init = function () {\n\t\t$('.topic').on('click', '[component=\"topic/fork\"]', onForkThreadClicked);\n\t\t$(window).on('action:ajaxify.start', onAjaxifyStart);\n\t};\n\n\tfunction onAjaxifyStart() {\n\t\tcloseForkModal();\n\t\t$(window).off('action:ajaxify.start', onAjaxifyStart);\n\t}\n\n\tfunction onForkThreadClicked() {\n\t\tapp.parseAndTranslate('partials/fork_thread_modal', {}, function (html) {\n\t\t\tforkModal = html;\n\n\t\t\tforkCommit = forkModal.find('#fork_thread_commit');\n\n\t\t\t$(document.body).append(forkModal);\n\n\t\t\tforkModal.find('.close,#fork_thread_cancel').on('click', closeForkModal);\n\t\t\tforkModal.find('#fork-title').on('keyup', checkForkButtonEnable);\n\n\t\t\tpostSelect.init(function () {\n\t\t\t\tcheckForkButtonEnable();\n\t\t\t\tshowPostsSelected();\n\t\t\t});\n\t\t\tshowPostsSelected();\n\n\t\t\tforkCommit.on('click', createTopicFromPosts);\n\t\t});\n\t}\n\n\tfunction createTopicFromPosts() {\n\t\tforkCommit.attr('disabled', true);\n\t\tsocket.emit('topics.createTopicFromPosts', {\n\t\t\ttitle: forkModal.find('#fork-title').val(),\n\t\t\tpids: postSelect.pids,\n\t\t\tfromTid: ajaxify.data.tid,\n\t\t}, function (err, newTopic) {\n\t\t\tfunction fadeOutAndRemove(pid) {\n\t\t\t\tcomponents.get('post', 'pid', pid).fadeOut(500, function () {\n\t\t\t\t\t$(this).remove();\n\t\t\t\t});\n\t\t\t}\n\t\t\tforkCommit.removeAttr('disabled');\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tapp.alert({\n\t\t\t\ttimeout: 5000,\n\t\t\t\ttitle: '[[global:alert.success]]',\n\t\t\t\tmessage: '[[topic:fork_success]]',\n\t\t\t\ttype: 'success',\n\t\t\t\tclickfn: function () {\n\t\t\t\t\tajaxify.go('topic/' + newTopic.slug);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tpostSelect.pids.forEach(function (pid) {\n\t\t\t\tfadeOutAndRemove(pid);\n\t\t\t});\n\n\t\t\tcloseForkModal();\n\t\t});\n\t}\n\n\tfunction showPostsSelected() {\n\t\tif (postSelect.pids.length) {\n\t\t\tforkModal.find('#fork-pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\n\t\t} else {\n\t\t\tforkModal.find('#fork-pids').translateHtml('[[topic:fork_no_pids]]');\n\t\t}\n\t}\n\n\tfunction checkForkButtonEnable() {\n\t\tif (forkModal.find('#fork-title').val().length && postSelect.pids.length) {\n\t\t\tforkCommit.removeAttr('disabled');\n\t\t} else {\n\t\t\tforkCommit.attr('disabled', true);\n\t\t}\n\t}\n\n\tfunction closeForkModal() {\n\t\tpostSelect.pids.forEach(function (pid) {\n\t\t\tcomponents.get('post', 'pid', pid).toggleClass('bg-success', false);\n\t\t});\n\n\t\tif (forkModal) {\n\t\t\tforkModal.remove();\n\t\t\tforkModal = null;\n\t\t}\n\n\t\tcomponents.get('topic').off('click', '[data-pid]');\n\t\tpostSelect.enableClicksOnPosts();\n\t}\n\n\treturn Fork;\n});\n"]}