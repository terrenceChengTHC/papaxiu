"use strict";define("forum/topic/votes",["components","translator"],function(t,o){var e={};e.addVoteHandler=function(){t.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',n);t.get("topic").on("mouseout",'[data-pid] [component="post/vote-count"]',function(){var t=$(this).parent();t.on("shown.bs.tooltip",function(){$(".tooltip").tooltip("destroy");t.off("shown.bs.tooltip")});$(".tooltip").tooltip("destroy")})};function n(t){t.stopPropagation();var o=$(this);var e=o.parent();var r=e.parents("[data-pid]").attr("data-pid");$(".tooltip").tooltip("destroy");o.off("mouseenter",n);socket.emit("posts.getUpvoters",[r],function(t,r){if(t){return app.alertError(t.message)}if(r.length){a(e,r[0])}o.off("mouseenter").on("mouseenter",n)});return false}function a(t,e){function n(o){t.attr("title",o).tooltip("fixTitle").tooltip("show")}var a=e.usernames;if(!a.length){return}if(a.length+e.otherCount>6){a=a.join(", ").replace(/,/g,"|");o.translate("[[topic:users_and_others, "+a+", "+e.otherCount+"]]",function(t){t=t.replace(/\|/g,",");n(t)})}else{a=a.join(", ");n(a)}}e.toggleVote=function(t,o,n){var a=t.parents("[data-pid]");var r=a.find(o).length;socket.emit(r?"posts.unvote":n,{pid:a.attr("data-pid"),room_id:"topic_"+ajaxify.data.tid},function(t){if(t){if(t.message==="self-vote"){e.showVotes(a.attr("data-pid"))}else{app.alertError(t.message)}}});return false};e.showVotes=function(t){socket.emit("posts.getVoters",{pid:t,cid:ajaxify.data.cid},function(t,e){if(t){if(t.message==="[[error:no-privileges]]"){return}return app.alertError(t.message)}templates.parse("partials/modals/votes_modal",e,function(t){o.translate(t,function(t){var o=bootbox.dialog({title:"Voters",message:t,className:"vote-modal",show:true});o.on("click",function(){o.modal("hide")})})})})};return e});
//# sourceMappingURL=public/src/client/topic/votes.js.map