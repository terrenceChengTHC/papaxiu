"use strict";define("forum/groups/details",["forum/groups/memberlist","iconSelect","components","coverPhoto","pictureCropper","translator","vendor/colorpicker/colorpicker"],function(e,a,r,t,o,i){var n={};var s;n.init=function(){var a=r.get("groups/container");s=ajaxify.data.group.name;if(ajaxify.data.group.isOwner){n.prepareSettings();t.init(r.get("groups/cover"),function(e,a,r){socket.emit("groups.cover.update",{groupName:s,imageData:e,position:a},r)},function(){o.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:true,restrictImageDimension:false,paramName:"groupName",paramValue:s},function(e){r.get("groups/cover").css("background-image","url("+e+")")})},u)}e.init();c();r.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-responsive");a.on("click","[data-action]",function(){var e=$(this);var a=e.parents("[data-uid]");var r=a.find(".member-name > i");var t=!r.hasClass("invisible");var o=a.attr("data-uid");var c=e.attr("data-action");switch(c){case"toggleOwnership":socket.emit("groups."+(t?"rescind":"grant"),{toUid:o,groupName:s},function(e){if(!e){r.toggleClass("invisible")}else{app.alertError(e.message)}});break;case"kick":i.translate("[[groups:details.kick_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("groups.kick",{uid:o,groupName:s},function(e){if(!e){a.slideUp().remove()}else{app.alertError(e.message)}})})});break;case"update":n.update();break;case"delete":n.deleteGroup();break;case"join":case"leave":case"accept":case"reject":case"issueInvite":case"rescindInvite":case"acceptInvite":case"rejectInvite":case"acceptAll":case"rejectAll":socket.emit("groups."+c,{toUid:o,groupName:s},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}});break}})};n.prepareSettings=function(){var e=r.get("groups/settings");var t=e.find('[data-action="color-select"]');var o=e.find('[name="labelColor"]');var i=e.find('[data-action="icon-select"]');var n=e.find(".label");var s=n.find("i");var c=e.find('[name="userTitle"]');var u=e.find('[name="userTitleEnabled"]');var p=e.find('[name="icon"]');t.ColorPicker({color:o.val()||"#000",onChange:function(e,a){o.val("#"+a);n.css("background-color","#"+a)},onShow:function(e){$(e).css("z-index",1051)}});i.on("click",function(){a.init(s,function(){p.val(s.val())})});c.on("keyup",function(){var a=s.detach();n.text(" "+(this.value||e.find("#name").val()));n.prepend(a)});u.on("change",function(){var e=r.get("groups/userTitleOption");if(this.checked){e.removeAttr("disabled");n.removeClass("hide")}else{e.attr("disabled","disabled");n.addClass("hide")}})};n.update=function(){var e=r.get("groups/settings");var a=e.find('input[type="checkbox"][name]');if(e.length){require(["vendor/jquery/serializeObject/jquery.ba-serializeobject.min"],function(){var r=e.serializeObject();a.each(function(e,a){a=$(a);if(a.length){r[a.attr("name")]=a.prop("checked")}});socket.emit("groups.update",{groupName:s,values:r},function(e){if(e){return app.alertError(e.message)}if(r.name){var a=window.location.pathname;a=a.substr(1,a.lastIndexOf("/"));ajaxify.go(a+utils.slugify(r.name))}else{ajaxify.refresh()}app.alertSuccess("[[groups:event.updated]]")})})}};n.deleteGroup=function(){bootbox.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(s),function(e){if(e){bootbox.prompt("Please enter the name of this group in order to delete it:",function(e){if(e===s){socket.emit("groups.delete",{groupName:s},function(e){if(!e){app.alertSuccess("[[groups:event.deleted, "+utils.escapeHTML(s)+"]]");ajaxify.go("groups")}else{app.alertError(e.message)}})}})}})};function c(){if(!ajaxify.data.group.isOwner){return}var e=$('[component="groups/members/invite"]');require(["autocomplete"],function(a){a.user(e,function(e,a){socket.emit("groups.issueInvite",{toUid:a.item.user.uid,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})});$('[component="groups/members/bulk-invite-button"]').on("click",function(){var e=$('[component="groups/members/bulk-invite"]').val();if(!e){return false}socket.emit("groups.issueMassInvite",{usernames:e,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()});return false})}function u(){i.translate("[[groups:remove_group_cover_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}})})})}return n});
//# sourceMappingURL=public/src/client/groups/details.js.map