{"version":3,"sources":["public/src/client/groups/memberlist.js"],"names":["define","MemberList","searchInterval","groupName","templateName","init","_templateName","ajaxify","data","group","name","handleMemberSearch","handleMemberInfiniteScroll","$","on","query","this","val","clearInterval","setTimeout","socket","emit","err","results","app","alertError","message","parseAndTranslate","users","html","attr","$this","bottom","scrollHeight","innerHeight","scrollTop","loadMoreMembers","members","after","length","onMembersLoaded","removeAttr","nextStart","callback","filter","user","uid","append","isOwner"],"mappings":"AAAA,aAGAA,OAAO,2BAA4B,aAAc,wBAAyB,WACzE,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAAWI,KAAO,SAAUC,GAC3BF,EAAeE,GAAiB,iBAChCH,EAAYI,QAAQC,KAAKC,MAAMC,KAE/BC,IACAC,KAGD,SAASD,IACRE,EAAE,uCAAuCC,GAAG,QAAS,WACpD,IAAIC,EAAQF,EAAEG,MAAMC,MACpB,GAAIf,EAAgB,CACnBgB,cAAchB,GACdA,EAAiB,EAGlBA,EAAiBiB,WAAW,WAC3BC,OAAOC,KAAK,wBAA0BlB,UAAWA,EAAWY,MAAOA,GAAS,SAAUO,EAAKC,GAC1F,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAE3BC,EAAkBJ,EAAQK,MAAO,SAAUC,GAC1ChB,EAAE,sCAAsCgB,KAAKA,GAC7ChB,EAAE,gCAAgCiB,KAAK,iBAAkB,SAGzD,OAIL,SAASlB,IACRC,EAAE,sCAAsCC,GAAG,SAAU,WACpD,IAAIiB,EAAQlB,EAAEG,MACd,IAAIgB,GAAUD,EAAM,GAAGE,aAAeF,EAAMG,eAAiB,GAE7D,GAAIH,EAAMI,YAAcH,EAAQ,CAC/BI,OAKH,SAASA,IACR,IAAIC,EAAUxB,EAAE,gCAChB,GAAIwB,EAAQP,KAAK,WAAY,CAC5B,OAGDO,EAAQP,KAAK,UAAW,GACxBV,OAAOC,KAAK,0BACXlB,UAAWA,EACXmC,MAAOD,EAAQP,KAAK,mBAClB,SAAUR,EAAKd,GACjB,GAAIc,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3B,GAAIlB,GAAQA,EAAKoB,MAAMW,OAAQ,CAC9BC,EAAgBhC,EAAKoB,MAAO,WAC3BS,EAAQI,WAAW,WACnBJ,EAAQP,KAAK,iBAAkBtB,EAAKkC,iBAE/B,CACNL,EAAQI,WAAW,cAKtB,SAASD,EAAgBZ,EAAOe,GAC/Bf,EAAQA,EAAMgB,OAAO,SAAUC,GAC9B,OAAQhC,EAAE,2CAA6CgC,EAAKC,IAAM,MAAMP,SAGzEZ,EAAkBC,EAAO,SAAUC,GAClChB,EAAE,sCAAsCkC,OAAOlB,GAC/Cc,MAIF,SAAShB,EAAkBC,EAAOe,GACjCnB,IAAIG,kBAAkBvB,EAAc,WACnCK,OACC4B,QAAST,EACToB,QAASzC,QAAQC,KAAKC,MAAMuC,UAE3BL,GAGJ,OAAO1C","file":"public/src/client/groups/memberlist.js","sourcesContent":["'use strict';\n\n\ndefine('forum/groups/memberlist', ['components', 'forum/infinitescroll'], function () {\n\tvar MemberList = {};\n\tvar searchInterval;\n\tvar groupName;\n\tvar templateName;\n\n\tMemberList.init = function (_templateName) {\n\t\ttemplateName = _templateName || 'groups/details';\n\t\tgroupName = ajaxify.data.group.name;\n\n\t\thandleMemberSearch();\n\t\thandleMemberInfiniteScroll();\n\t};\n\n\tfunction handleMemberSearch() {\n\t\t$('[component=\"groups/members/search\"]').on('keyup', function () {\n\t\t\tvar query = $(this).val();\n\t\t\tif (searchInterval) {\n\t\t\t\tclearInterval(searchInterval);\n\t\t\t\tsearchInterval = 0;\n\t\t\t}\n\n\t\t\tsearchInterval = setTimeout(function () {\n\t\t\t\tsocket.emit('groups.searchMembers', { groupName: groupName, query: query }, function (err, results) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tparseAndTranslate(results.users, function (html) {\n\t\t\t\t\t\t$('[component=\"groups/members\"] tbody').html(html);\n\t\t\t\t\t\t$('[component=\"groups/members\"]').attr('data-nextstart', 20);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, 250);\n\t\t});\n\t}\n\n\tfunction handleMemberInfiniteScroll() {\n\t\t$('[component=\"groups/members\"] tbody').on('scroll', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar bottom = ($this[0].scrollHeight - $this.innerHeight()) * 0.9;\n\n\t\t\tif ($this.scrollTop() > bottom) {\n\t\t\t\tloadMoreMembers();\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction loadMoreMembers() {\n\t\tvar members = $('[component=\"groups/members\"]');\n\t\tif (members.attr('loading')) {\n\t\t\treturn;\n\t\t}\n\n\t\tmembers.attr('loading', 1);\n\t\tsocket.emit('groups.loadMoreMembers', {\n\t\t\tgroupName: groupName,\n\t\t\tafter: members.attr('data-nextstart'),\n\t\t}, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tif (data && data.users.length) {\n\t\t\t\tonMembersLoaded(data.users, function () {\n\t\t\t\t\tmembers.removeAttr('loading');\n\t\t\t\t\tmembers.attr('data-nextstart', data.nextStart);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmembers.removeAttr('loading');\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction onMembersLoaded(users, callback) {\n\t\tusers = users.filter(function (user) {\n\t\t\treturn !$('[component=\"groups/members\"] [data-uid=\"' + user.uid + '\"]').length;\n\t\t});\n\n\t\tparseAndTranslate(users, function (html) {\n\t\t\t$('[component=\"groups/members\"] tbody').append(html);\n\t\t\tcallback();\n\t\t});\n\t}\n\n\tfunction parseAndTranslate(users, callback) {\n\t\tapp.parseAndTranslate(templateName, 'members', {\n\t\t\tgroup: {\n\t\t\t\tmembers: users,\n\t\t\t\tisOwner: ajaxify.data.group.isOwner,\n\t\t\t},\n\t\t}, callback);\n\t}\n\n\treturn MemberList;\n});\n"]}