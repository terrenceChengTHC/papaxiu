"use strict";define("forum/register",["translator","zxcvbn"],function(e,r){var a={};var s=false;var n="";a.init=function(){var r=$("#email");var a=$("#username");var n=$("#password");var f=$("#password-confirm");var u=$("#register");c();$("#referrer").val(app.previousUrl);r.on("blur",function(){if(r.val().length){i(r.val())}});var m=utils.params();if(m.email&&m.token){r.val(decodeURIComponent(m.email));$("#token").val(m.token)}a.on("keyup",function(){$("#yourUsername").text(this.value.length>0?utils.slugify(this.value):"username")});a.on("blur",function(){if(a.val().length){t(a.val())}});n.on("blur",function(){if(n.val().length){o(n.val(),f.val())}});f.on("blur",function(){if(f.val().length){l(n.val(),f.val())}});function d(e){s=false;o(n.val(),f.val());l(n.val(),f.val());i(r.val(),function(){t(a.val(),e)})}u.on("click",function(r){var a=$(this);var n=$("#register-error-notify");n.addClass("hidden");r.preventDefault();d(function(){if(s){return}a.addClass("disabled");a.parents("form").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},success:function(e){a.removeClass("disabled");if(!e){return}if(e.referrer){window.location.href=e.referrer}else if(e.message){require(["translator"],function(r){r.translate(e.message,function(e){bootbox.alert(e);ajaxify.go("/")})})}},error:function(r){e.translate(r.responseText,config.defaultLang,function(e){if(r.status===403&&r.responseText==="Forbidden"){window.location.href=config.relative_path+"/register?error=csrf-invalid"}else{n.find("p").text(e);n.removeClass("hidden");a.removeClass("disabled")}})}})})})};function i(e,r){r=r||function(){};var a=$("#email-notify");if(!utils.isEmailValid(e)){f(a,"[[error:invalid-email]]");return r()}socket.emit("user.emailExists",{email:e},function(e,s){if(e){app.alertError(e.message);return r()}if(s){f(a,"[[error:email-taken]]")}else{u(a,n)}r()})}function t(e,r){r=r||function(){};var a=$("#username-notify");if(e.length<ajaxify.data.minimumUsernameLength){f(a,"[[error:username-too-short]]")}else if(e.length>ajaxify.data.maximumUsernameLength){f(a,"[[error:username-too-long]]")}else if(!utils.isUserNameValid(e)||!utils.slugify(e)){f(a,"[[error:invalid-username]]")}else{socket.emit("user.exists",{username:e},function(e,s){if(e){return app.alertError(e.message)}if(s){f(a,"[[error:username-taken]]")}else{u(a,n)}r()})}}function o(e,a){var s=$("#password-notify");var i=$("#password-confirm-notify");var t=r(e);if(e.length<ajaxify.data.minimumPasswordLength){f(s,"[[user:change_password_error_length]]")}else if(e.length>4096){f(s,"[[error:password-too-long]]")}else if(!utils.isPasswordValid(e)){f(s,"[[user:change_password_error]]")}else if(e===$("#username").val()){f(s,"[[user:password_same_as_username]]")}else if(e===$("#email").val()){f(s,"[[user:password_same_as_email]]")}else if(t.score<ajaxify.data.minimumPasswordStrength){f(s,"[[user:weak_password]]")}else{u(s,n)}if(e!==a&&a!==""){f(i,"[[user:change_password_error_match]]")}}function l(e,r){var a=$("#password-notify");var s=$("#password-confirm-notify");if(!e||a.hasClass("alert-error")){return}if(e!==r){f(s,"[[user:change_password_error_match]]")}else{u(s,n)}}function f(r,a){e.translate(a,function(e){r.html(e);r.parent().removeClass("register-success").addClass("register-danger");r.show()});s=true}function u(r,a){e.translate(a,function(e){r.html(e);r.parent().removeClass("register-danger").addClass("register-success");r.show()})}function c(){if(!app.user.uid&&config.defaultLang!==config.userLang){var e=$('[component="register/local"]');var r=$('<input type="hidden" name="userLang" value="'+config.userLang+'" />');e.append(r)}}return a});
//# sourceMappingURL=public/src/client/register.js.map