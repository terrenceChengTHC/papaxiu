"use strict";define("forum/category/tools",["forum/topic/move","topicSelect","components","translator"],function(e,t,n,o){var i={};i.init=function(o){i.cid=o;t.init(l);L();n.get("topic/delete").on("click",function(){c("delete",t.getSelectedTids());return false});n.get("topic/restore").on("click",function(){c("restore",t.getSelectedTids());return false});n.get("topic/purge").on("click",function(){c("purge",t.getSelectedTids());return false});n.get("topic/lock").on("click",function(){var e=t.getSelectedTids();if(e.length){socket.emit("topics.lock",{tids:e,cid:i.cid},s)}return false});n.get("topic/unlock").on("click",function(){var e=t.getSelectedTids();if(e.length){socket.emit("topics.unlock",{tids:e,cid:i.cid},s)}return false});n.get("topic/pin").on("click",function(){var e=t.getSelectedTids();if(e.length){socket.emit("topics.pin",{tids:e,cid:i.cid},s)}return false});n.get("topic/unpin").on("click",function(){var e=t.getSelectedTids();if(e.length){socket.emit("topics.unpin",{tids:e,cid:i.cid},s)}return false});n.get("topic/mark-unread-for-all").on("click",function(){var e=t.getSelectedTids();if(e.length){socket.emit("topics.markAsUnreadForAll",e,function(t){if(t){return app.alertError(t.message)}app.alertSuccess("[[topic:markAsUnreadForAll.success]]");e.forEach(function(e){$('[component="category/topic"][data-tid="'+e+'"]').addClass("unread")});s()})}return false});n.get("topic/move").on("click",function(){var n=t.getSelectedTids();if(n.length){e.init(n,o,s)}return false});n.get("topic/move-all").on("click",function(){e.init(null,o,function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})});i.removeListeners();socket.on("event:topic_deleted",v);socket.on("event:topic_restored",v);socket.on("event:topic_purged",C);socket.on("event:topic_locked",h);socket.on("event:topic_unlocked",h);socket.on("event:topic_pinned",m);socket.on("event:topic_unpinned",m);socket.on("event:topic_moved",_)};function c(e,t){if(!t.length){return}o.translate("[[topic:thread_tools."+e+"_confirm]]",function(n){bootbox.confirm(n,function(n){if(!n){return}socket.emit("topics."+e,{tids:t,cid:i.cid},d)})})}i.removeListeners=function(){socket.removeListener("event:topic_deleted",v);socket.removeListener("event:topic_restored",v);socket.removeListener("event:topic_purged",C);socket.removeListener("event:topic_locked",h);socket.removeListener("event:topic_unlocked",h);socket.removeListener("event:topic_pinned",m);socket.removeListener("event:topic_unpinned",m);socket.removeListener("event:topic_moved",_)};function r(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function s(e){if(e){return app.alertError(e.message)}r();t.unselectAll()}function d(e){if(e){return app.alertError(e.message)}r();l()}function l(){var e=t.getSelectedTids();var o=a(u,e);var i=p(u,e);var c=a(f,e);var r=a(g,e);n.get("topic/delete").toggleClass("hidden",o);n.get("topic/restore").toggleClass("hidden",!o);n.get("topic/purge").toggleClass("hidden",!i);n.get("topic/lock").toggleClass("hidden",r);n.get("topic/unlock").toggleClass("hidden",!r);n.get("topic/pin").toggleClass("hidden",c);n.get("topic/unpin").toggleClass("hidden",!c)}function a(e,t){for(var n=0;n<t.length;n+=1){if(e(t[n])){return true}}return false}function p(e,t){for(var n=0;n<t.length;n+=1){if(!e(t[n])){return false}}return true}function u(e){return k(e).hasClass("deleted")}function g(e){return k(e).hasClass("locked")}function f(e){return k(e).hasClass("pinned")}function k(e){return n.get("category/topic","tid",e)}function v(e){var t=k(e.tid);t.toggleClass("deleted",e.isDeleted);t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function m(e){var t=k(e.tid);t.toggleClass("pinned",e.isPinned);t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned);ajaxify.refresh()}function h(e){var t=k(e.tid);t.toggleClass("locked",e.isLocked);t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function _(e){k(e.tid).remove()}function C(e){k(e.tid).remove()}function L(){if(!ajaxify.data.privileges.isAdminOrMod){return}app.loadJQueryUI(function(){$('[component="category"]').sortable({items:'[component="category/topic"].pinned',update:function(){var e=[];var t=$('[component="category/topic"].pinned');t.each(function(n,o){e.push({tid:$(o).attr("data-tid"),order:t.length-n-1})});socket.emit("topics.orderPinnedTopics",e,function(e){if(e){return app.alertError(e.message)}})}})})}return i});
//# sourceMappingURL=public/src/client/category/tools.js.map