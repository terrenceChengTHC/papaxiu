{"version":3,"sources":["public/src/client/flags/detail.js"],"names":["define","FlagsList","components","translator","Flags","init","$","val","ajaxify","data","state","removeAttr","assignee","on","action","this","getAttribute","socket","emit","flagId","serializeArray","err","history","app","alertError","message","alertSuccess","reloadHistory","note","document","getElementById","value","payload","reloadNotes","notes","enableFilterForm","enableChatButtons","templates","parse","html","wrapperEl","get","empty","find","timeago","translate","translated"],"mappings":"AAAA,aAIAA,OAAO,sBAAuB,mBAAoB,aAAc,cAAe,SAAUC,EAAWC,EAAYC,GAC/G,IAAIC,KAEJA,EAAMC,KAAO,WAEZC,EAAE,UAAUC,IAAIC,QAAQC,KAAKC,OAAOC,WAAW,YAC/CL,EAAE,aAAaC,IAAIC,QAAQC,KAAKG,UAAUD,WAAW,YAErDL,EAAE,iBAAiBO,GAAG,QAAS,WAC9B,IAAIC,EAASC,KAAKC,aAAa,eAE/B,OAAQF,GACR,IAAK,SACJG,OAAOC,KAAK,gBACXC,OAAQX,QAAQC,KAAKU,OACrBV,KAAMH,EAAE,eAAec,kBACrB,SAAUC,EAAKC,GACjB,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAE3BF,IAAIG,aAAa,qBACjBtB,EAAMuB,cAAcL,KAErB,MAED,IAAK,aACJL,OAAOC,KAAK,oBACXC,OAAQX,QAAQC,KAAKU,OACrBS,KAAMC,SAASC,eAAe,QAAQC,OACpC,SAAUV,EAAKW,GACjB,GAAIX,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAE3BF,IAAIG,aAAa,wBACjBtB,EAAM6B,YAAYD,EAAQE,OAC1B9B,EAAMuB,cAAcK,EAAQV,WAE7B,SAIFrB,EAAUkC,mBACVlC,EAAUmC,qBAGXhC,EAAM6B,YAAc,SAAUC,GAC7BG,UAAUC,MAAM,eAAgB,SAC/BJ,MAAOA,GACL,SAAUK,GACZ,IAAIC,EAAYtC,EAAWuC,IAAI,cAC/BD,EAAUE,QACVF,EAAUD,KAAKA,GACfC,EAAUG,KAAK,gBAAgBC,UAC/Bf,SAASC,eAAe,QAAQC,MAAQ,MAI1C3B,EAAMuB,cAAgB,SAAUL,GAC/Be,UAAUC,MAAM,eAAgB,WAC/BhB,QAASA,GACP,SAAUiB,GACZpC,EAAW0C,UAAUN,EAAM,SAAUO,GACpC,IAAIN,EAAYtC,EAAWuC,IAAI,gBAC/BD,EAAUE,QACVF,EAAUD,KAAKO,GACfN,EAAUG,KAAK,gBAAgBC,eAKlC,OAAOxC","file":"public/src/client/flags/detail.js","sourcesContent":["'use strict';\n\n/* globals define */\n\ndefine('forum/flags/detail', ['forum/flags/list', 'components', 'translator'], function (FlagsList, components, translator) {\n\tvar Flags = {};\n\n\tFlags.init = function () {\n\t\t// Update attributes\n\t\t$('#state').val(ajaxify.data.state).removeAttr('disabled');\n\t\t$('#assignee').val(ajaxify.data.assignee).removeAttr('disabled');\n\n\t\t$('[data-action]').on('click', function () {\n\t\t\tvar action = this.getAttribute('data-action');\n\n\t\t\tswitch (action) {\n\t\t\tcase 'update':\n\t\t\t\tsocket.emit('flags.update', {\n\t\t\t\t\tflagId: ajaxify.data.flagId,\n\t\t\t\t\tdata: $('#attributes').serializeArray(),\n\t\t\t\t}, function (err, history) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[flags:updated]]');\n\t\t\t\t\tFlags.reloadHistory(history);\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase 'appendNote':\n\t\t\t\tsocket.emit('flags.appendNote', {\n\t\t\t\t\tflagId: ajaxify.data.flagId,\n\t\t\t\t\tnote: document.getElementById('note').value,\n\t\t\t\t}, function (err, payload) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[flags:note-added]]');\n\t\t\t\t\tFlags.reloadNotes(payload.notes);\n\t\t\t\t\tFlags.reloadHistory(payload.history);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tFlagsList.enableFilterForm();\n\t\tFlagsList.enableChatButtons();\n\t};\n\n\tFlags.reloadNotes = function (notes) {\n\t\ttemplates.parse('flags/detail', 'notes', {\n\t\t\tnotes: notes,\n\t\t}, function (html) {\n\t\t\tvar wrapperEl = components.get('flag/notes');\n\t\t\twrapperEl.empty();\n\t\t\twrapperEl.html(html);\n\t\t\twrapperEl.find('span.timeago').timeago();\n\t\t\tdocument.getElementById('note').value = '';\n\t\t});\n\t};\n\n\tFlags.reloadHistory = function (history) {\n\t\ttemplates.parse('flags/detail', 'history', {\n\t\t\thistory: history,\n\t\t}, function (html) {\n\t\t\ttranslator.translate(html, function (translated) {\n\t\t\t\tvar wrapperEl = components.get('flag/history');\n\t\t\t\twrapperEl.empty();\n\t\t\t\twrapperEl.html(translated);\n\t\t\t\twrapperEl.find('span.timeago').timeago();\n\t\t\t});\n\t\t});\n\t};\n\n\treturn Flags;\n});\n"]}