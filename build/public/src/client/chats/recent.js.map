{"version":3,"sources":["public/src/client/chats/recent.js"],"names":["define","recent","init","$","on","$this","this","bottom","scrollHeight","height","scrollTop","loadMoreRecentChats","recentChats","attr","socket","emit","uid","ajaxify","data","after","err","app","alertError","message","rooms","length","onRecentChatsLoaded","removeAttr","nextStart","callback","parseAndTranslate","html","append","find","timeago"],"mappings":"AAAA,aAGAA,OAAO,qBAAsB,WAC5B,IAAIC,KAEJA,EAAOC,KAAO,WACbC,EAAE,6BAA6BC,GAAG,SAAU,WAC3C,IAAIC,EAAQF,EAAEG,MACd,IAAIC,GAAUF,EAAM,GAAGG,aAAeH,EAAMI,UAAY,GACxD,GAAIJ,EAAMK,YAAcH,EAAQ,CAC/BI,QAKH,SAASA,IACR,IAAIC,EAAcT,EAAE,6BACpB,GAAIS,EAAYC,KAAK,WAAY,CAChC,OAEDD,EAAYC,KAAK,UAAW,GAC5BC,OAAOC,KAAK,gCACXC,IAAKC,QAAQC,KAAKF,IAClBG,MAAOP,EAAYC,KAAK,mBACtB,SAAUO,EAAKF,GACjB,GAAIE,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3B,GAAIL,GAAQA,EAAKM,MAAMC,OAAQ,CAC9BC,EAAoBR,EAAM,WACzBN,EAAYe,WAAW,WACvBf,EAAYC,KAAK,iBAAkBK,EAAKU,iBAEnC,CACNhB,EAAYe,WAAW,cAK1B,SAASD,EAAoBR,EAAMW,GAClC,IAAKX,EAAKM,MAAMC,OAAQ,CACvB,OAAOI,IAGRR,IAAIS,kBAAkB,QAAS,QAASZ,EAAM,SAAUa,GACvD5B,EAAE,6BAA6B6B,OAAOD,GACtCA,EAAKE,KAAK,YAAYC,UACtBL,MAKF,OAAO5B","file":"public/src/client/chats/recent.js","sourcesContent":["'use strict';\n\n\ndefine('forum/chats/recent', function () {\n\tvar recent = {};\n\n\trecent.init = function () {\n\t\t$('[component=\"chat/recent\"]').on('scroll', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar bottom = ($this[0].scrollHeight - $this.height()) * 0.9;\n\t\t\tif ($this.scrollTop() > bottom) {\n\t\t\t\tloadMoreRecentChats();\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction loadMoreRecentChats() {\n\t\tvar recentChats = $('[component=\"chat/recent\"]');\n\t\tif (recentChats.attr('loading')) {\n\t\t\treturn;\n\t\t}\n\t\trecentChats.attr('loading', 1);\n\t\tsocket.emit('modules.chats.getRecentChats', {\n\t\t\tuid: ajaxify.data.uid,\n\t\t\tafter: recentChats.attr('data-nextstart'),\n\t\t}, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tif (data && data.rooms.length) {\n\t\t\t\tonRecentChatsLoaded(data, function () {\n\t\t\t\t\trecentChats.removeAttr('loading');\n\t\t\t\t\trecentChats.attr('data-nextstart', data.nextStart);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\trecentChats.removeAttr('loading');\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction onRecentChatsLoaded(data, callback) {\n\t\tif (!data.rooms.length) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tapp.parseAndTranslate('chats', 'rooms', data, function (html) {\n\t\t\t$('[component=\"chat/recent\"]').append(html);\n\t\t\thtml.find('.timeago').timeago();\n\t\t\tcallback();\n\t\t});\n\t}\n\n\n\treturn recent;\n});\n"]}