{"version":3,"sources":["public/src/client/category.js"],"names":["define","infinitescroll","share","navigator","categoryTools","sort","components","translator","topicSelect","pagination","storage","Category","$","window","on","ev","data","url","startsWith","disable","removeListeners","socket","removeListener","onNewTopic","init","cid","ajaxify","app","enterRoom","addShareHandlers","name","handleSort","slug","enableInfiniteLoadingOrPagination","clickedIndex","this","parents","attr","each","index","el","offset","top","scrollTop","setItem","handleScrollToTopicIndex","handleIgnoreWatch","trigger","topics","parts","location","pathname","split","topicIndex","length","utils","isNumber","Math","max","parseInt","search","indexOf","scrollToElement","$this","command","emit","err","alertError","message","toggleClass","alertSuccess","toTop","toBottom","count","scrollBottom","navigatorCallback","topIndex","bottomIndex","template","category","bookmarkIndex","getItem","removeItem","config","usePagination","page","ceil","topicsPerPage","currentPage","loadPage","scrollToTopic","highlightTopic","empty","loadTopicsAfter","one","highlight","get","hasClass","addClass","setTimeout","removeClass","duration","scrollTo","animate","undefined","update","topic_count","loadMoreTopics","topic","editable","templates","parse","privileges","showSelect","html","translate","translatedHTML","container","numTopics","noTopicsWarning","remove","widgets","render","slice","x","pinned","insertBefore","insertAfter","append","hide","fadeIn","find","timeago","createUserTooltips","updateTopicCount","topicCount","setCount","direction","children","afterEl","last","first","after","callback","params","loadMore","author","tag","categoryTopicSort","done","onTopicsLoaded","removeAlreadyAddedTopics","filter","tid","before","parseAndTranslate","height","document","getSelectedTids","removeExtra","makeNumbersHumanReadable"],"mappings":"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","file":"public/src/client/category.js","sourcesContent":["'use strict';\n\n\ndefine('forum/category', [\n\t'forum/infinitescroll',\n\t'share',\n\t'navigator',\n\t'forum/category/tools',\n\t'sort',\n\t'components',\n\t'translator',\n\t'topicSelect',\n\t'forum/pagination',\n\t'storage',\n], function (infinitescroll, share, navigator, categoryTools, sort, components, translator, topicSelect, pagination, storage) {\n\tvar Category = {};\n\n\t$(window).on('action:ajaxify.start', function (ev, data) {\n\t\tif (data.url && !data.url.startsWith('category/')) {\n\t\t\tnavigator.disable();\n\n\t\t\tremoveListeners();\n\t\t}\n\t});\n\n\tfunction removeListeners() {\n\t\tsocket.removeListener('event:new_topic', Category.onNewTopic);\n\t\tcategoryTools.removeListeners();\n\t}\n\n\tCategory.init = function () {\n\t\tvar\tcid = ajaxify.data.cid;\n\n\t\tapp.enterRoom('category_' + cid);\n\n\t\tshare.addShareHandlers(ajaxify.data.name);\n\n\t\tsocket.removeListener('event:new_topic', Category.onNewTopic);\n\t\tsocket.on('event:new_topic', Category.onNewTopic);\n\n\t\tcategoryTools.init(cid);\n\n\t\tsort.handleSort('categoryTopicSort', 'user.setCategorySort', 'category/' + ajaxify.data.slug);\n\n\t\tenableInfiniteLoadingOrPagination();\n\n\t\t$('[component=\"category\"]').on('click', '[component=\"topic/header\"]', function () {\n\t\t\tvar clickedIndex = $(this).parents('[data-index]').attr('data-index');\n\t\t\t$('[component=\"category/topic\"]').each(function (index, el) {\n\t\t\t\tif ($(el).offset().top - $(window).scrollTop() > 0) {\n\t\t\t\t\tstorage.setItem('category:' + cid + ':bookmark', $(el).attr('data-index'));\n\t\t\t\t\tstorage.setItem('category:' + cid + ':bookmark:clicked', clickedIndex);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\thandleScrollToTopicIndex();\n\n\t\thandleIgnoreWatch(cid);\n\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\n\t\t$(window).trigger('action:category.loaded', { cid: ajaxify.data.cid });\n\t};\n\n\tfunction handleScrollToTopicIndex() {\n\t\tvar parts = window.location.pathname.split('/');\n\t\tvar topicIndex = parts[parts.length - 1];\n\t\tif (topicIndex && utils.isNumber(topicIndex)) {\n\t\t\ttopicIndex = Math.max(0, parseInt(topicIndex, 10) - 1);\n\t\t\tif (topicIndex && window.location.search.indexOf('page=') === -1) {\n\t\t\t\tnavigator.scrollToElement($('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]'), true, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleIgnoreWatch(cid) {\n\t\t$('[component=\"category/watching\"], [component=\"category/ignoring\"]').on('click', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar command = $this.attr('component') === 'category/watching' ? 'watch' : 'ignore';\n\n\t\t\tsocket.emit('categories.' + command, cid, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\t$('[component=\"category/watching/menu\"]').toggleClass('hidden', command !== 'watch');\n\t\t\t\t$('[component=\"category/watching/check\"]').toggleClass('fa-check', command === 'watch');\n\n\t\t\t\t$('[component=\"category/ignoring/menu\"]').toggleClass('hidden', command !== 'ignore');\n\t\t\t\t$('[component=\"category/ignoring/check\"]').toggleClass('fa-check', command === 'ignore');\n\n\t\t\t\tapp.alertSuccess('[[category:' + command + '.message]]');\n\t\t\t});\n\t\t});\n\t}\n\n\tCategory.toTop = function () {\n\t\tnavigator.scrollTop(0);\n\t};\n\n\tCategory.toBottom = function () {\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, count) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tnavigator.scrollBottom(count - 1);\n\t\t});\n\t};\n\n\tCategory.navigatorCallback = function (topIndex, bottomIndex) {\n\t\treturn bottomIndex;\n\t};\n\n\t$(window).on('action:popstate', function () {\n\t\tif (ajaxify.data.template.category && ajaxify.data.cid) {\n\t\t\tvar bookmarkIndex = storage.getItem('category:' + ajaxify.data.cid + ':bookmark');\n\t\t\tvar clickedIndex = storage.getItem('category:' + ajaxify.data.cid + ':bookmark:clicked');\n\n\t\t\tstorage.removeItem('category:' + ajaxify.data.cid + ':bookmark');\n\t\t\tstorage.removeItem('category:' + ajaxify.data.cid + ':bookmark:clicked');\n\n\t\t\tbookmarkIndex = Math.max(0, parseInt(bookmarkIndex, 10) || 0);\n\t\t\tclickedIndex = Math.max(0, parseInt(clickedIndex, 10) || 0);\n\t\t\tif (!parseInt(bookmarkIndex, 10)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (config.usePagination) {\n\t\t\t\tvar page = Math.ceil((parseInt(bookmarkIndex, 10) + 1) / config.topicsPerPage);\n\t\t\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\n\t\t\t\t\tpagination.loadPage(page, function () {\n\t\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (bookmarkIndex === 0) {\n\t\t\t\t\tCategory.highlightTopic(clickedIndex);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$('[component=\"category\"]').empty();\n\n\t\t\t\tloadTopicsAfter(Math.max(0, bookmarkIndex - 1) + 1, 1, function () {\n\t\t\t\t\t$(window).one('action:topics.loaded', function () {\n\t\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tCategory.highlightTopic = function (topicIndex) {\n\t\tvar highlight = components.get('category/topic', 'index', topicIndex);\n\n\t\tif (highlight.length && !highlight.hasClass('highlight')) {\n\t\t\thighlight.addClass('highlight');\n\t\t\tsetTimeout(function () {\n\t\t\t\thighlight.removeClass('highlight');\n\t\t\t}, 5000);\n\t\t}\n\t};\n\n\tCategory.scrollToTopic = function (bookmarkIndex, clickedIndex, duration, offset) {\n\t\tif (!bookmarkIndex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!offset) {\n\t\t\toffset = 0;\n\t\t}\n\n\t\tvar scrollTo = components.get('category/topic', 'index', bookmarkIndex);\n\n\t\tif (scrollTo.length) {\n\t\t\t$('html, body').animate({\n\t\t\t\tscrollTop: (scrollTo.offset().top - offset) + 'px',\n\t\t\t}, duration !== undefined ? duration : 400, function () {\n\t\t\t\tCategory.highlightTopic(clickedIndex);\n\t\t\t\tnavigator.update();\n\t\t\t});\n\t\t}\n\t};\n\n\tfunction enableInfiniteLoadingOrPagination() {\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.init('[component=\"category/topic\"]', ajaxify.data.topic_count, Category.toTop, Category.toBottom, Category.navigatorCallback);\n\t\t\tinfinitescroll.init($('[component=\"category\"]'), Category.loadMoreTopics);\n\t\t} else {\n\t\t\tnavigator.disable();\n\t\t}\n\t}\n\n\tCategory.onNewTopic = function (topic) {\n\t\tvar\tcid = ajaxify.data.cid;\n\t\tif (!topic || parseInt(topic.cid, 10) !== parseInt(cid, 10)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$(window).trigger('filter:categories.new_topic', topic);\n\n\t\tvar editable = !!$('.thread-tools').length;\n\n\t\ttemplates.parse('category', 'topics', {\n\t\t\tprivileges: { editable: editable },\n\t\t\tshowSelect: editable,\n\t\t\ttopics: [topic],\n\t\t\ttemplate: { category: true },\n\t\t}, function (html) {\n\t\t\ttranslator.translate(html, function (translatedHTML) {\n\t\t\t\tvar topic = $(translatedHTML);\n\t\t\t\tvar container = $('[component=\"category\"]');\n\t\t\t\tvar topics = $('[component=\"category/topic\"]');\n\t\t\t\tvar numTopics = topics.length;\n\n\t\t\t\t$('[component=\"category\"]').removeClass('hidden');\n\t\t\t\t$('.category-sidebar').removeClass('hidden');\n\n\t\t\t\tvar noTopicsWarning = $('#category-no-topics');\n\t\t\t\tif (noTopicsWarning.length) {\n\t\t\t\t\tnoTopicsWarning.remove();\n\t\t\t\t\tajaxify.widgets.render('category', window.location.pathname.slice(1));\n\t\t\t\t}\n\n\t\t\t\tif (numTopics > 0) {\n\t\t\t\t\tfor (var x = 0; x < numTopics; x += 1) {\n\t\t\t\t\t\tvar pinned = $(topics[x]).hasClass('pinned');\n\t\t\t\t\t\tif (!pinned) {\n\t\t\t\t\t\t\ttopic.insertBefore(topics[x]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (x === numTopics - 1) {\n\t\t\t\t\t\t\ttopic.insertAfter(topics[x]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.append(topic);\n\t\t\t\t}\n\n\t\t\t\ttopic.hide().fadeIn('slow');\n\n\t\t\t\ttopic.find('.timeago').timeago();\n\t\t\t\tapp.createUserTooltips();\n\t\t\t\tupdateTopicCount();\n\n\t\t\t\t$(window).trigger('action:categories.new_topic.loaded');\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction updateTopicCount() {\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, topicCount) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tnavigator.setCount(topicCount);\n\t\t});\n\t}\n\n\tCategory.loadMoreTopics = function (direction) {\n\t\tif (!$('[component=\"category\"]').length || !$('[component=\"category\"]').children().length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar topics = $('[component=\"category/topic\"]');\n\t\tvar afterEl = direction > 0 ? topics.last() : topics.first();\n\t\tvar after = (parseInt(afterEl.attr('data-index'), 10) || 0) + 1;\n\n\t\tloadTopicsAfter(after, direction);\n\t};\n\n\tfunction loadTopicsAfter(after, direction, callback) {\n\t\tcallback = callback || function () {};\n\t\tif (!utils.isNumber(after) || (after === 0 && components.get('category/topic', 'index', 0).length)) {\n\t\t\treturn callback();\n\t\t}\n\n\t\t$(window).trigger('action:category.loading');\n\t\tvar params = utils.params();\n\t\tinfinitescroll.loadMore('categories.loadMore', {\n\t\t\tcid: ajaxify.data.cid,\n\t\t\tafter: after,\n\t\t\tdirection: direction,\n\t\t\tauthor: params.author,\n\t\t\ttag: params.tag,\n\t\t\tcategoryTopicSort: config.categoryTopicSort,\n\t\t}, function (data, done) {\n\t\t\tif (data.topics && data.topics.length) {\n\t\t\t\tCategory.onTopicsLoaded(data, direction, done);\n\t\t\t} else {\n\t\t\t\tdone();\n\t\t\t}\n\n\t\t\t$(window).trigger('action:category.loaded');\n\t\t\tcallback();\n\t\t});\n\t}\n\n\n\tCategory.onTopicsLoaded = function (data, direction, callback) {\n\t\tif (!data || !data.topics.length) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tfunction removeAlreadyAddedTopics(topics) {\n\t\t\treturn topics.filter(function (topic) {\n\t\t\t\treturn components.get('category/topic', 'tid', topic.tid).length === 0;\n\t\t\t});\n\t\t}\n\n\t\tdata.topics = removeAlreadyAddedTopics(data.topics);\n\t\tif (!data.topics.length) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tdata.showSelect = data.privileges.editable;\n\n\t\tvar after;\n\t\tvar before;\n\t\tvar topics = $('[component=\"category/topic\"]');\n\n\t\tif (direction > 0 && topics.length) {\n\t\t\tafter = topics.last();\n\t\t} else if (direction < 0 && topics.length) {\n\t\t\tbefore = topics.first();\n\t\t}\n\n\t\tapp.parseAndTranslate('category', 'topics', data, function (html) {\n\t\t\t$('[component=\"category\"]').removeClass('hidden');\n\t\t\t$('.category-sidebar').removeClass('hidden');\n\n\t\t\t$('#category-no-topics').remove();\n\n\t\t\tif (after) {\n\t\t\t\thtml.insertAfter(after);\n\t\t\t} else if (before) {\n\t\t\t\tvar height = $(document).height();\n\t\t\t\tvar scrollTop = $(window).scrollTop();\n\n\t\t\t\thtml.insertBefore(before);\n\n\t\t\t\t$(window).scrollTop(scrollTop + ($(document).height() - height));\n\t\t\t} else {\n\t\t\t\t$('[component=\"category\"]').append(html);\n\t\t\t}\n\n\t\t\tif (!topicSelect.getSelectedTids().length) {\n\t\t\t\tinfinitescroll.removeExtra($('[component=\"category/topic\"]'), direction, config.topicsPerPage * 3);\n\t\t\t}\n\n\t\t\thtml.find('.timeago').timeago();\n\t\t\tapp.createUserTooltips();\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\n\n\t\t\t$(window).trigger('action:topics.loaded', { topics: data.topics });\n\n\t\t\tcallback();\n\t\t});\n\t};\n\n\treturn Category;\n});\n"]}