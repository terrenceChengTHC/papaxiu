{"version":3,"sources":["public/src/client/categories.js"],"names":["define","components","translator","categories","$","window","on","ev","data","ajaxify","currentPage","url","socket","removeListener","onNewPost","init","app","enterRoom","tooltip","placement","posts","length","topic","renderNewPost","cid","post","category","get","numRecentReplies","attr","parseInt","recentPosts","find","parseAndTranslate","html","hide","appendTo","insertBefore","first","fadeIn","createUserTooltips","timeago","last","remove","trigger","callback","templates","parse","translate","translatedHTML","addClass"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,aAAc,cAAe,SAAUC,EAAYC,GAC9E,IAAIC,KAEJC,EAAEC,QAAQC,GAAG,uBAAwB,SAAUC,EAAIC,GAClD,GAAIC,QAAQC,cAAgBF,EAAKG,IAAK,CACrCC,OAAOC,eAAe,iBAAkBV,EAAWW,cAIrDX,EAAWY,KAAO,WACjBC,IAAIC,UAAU,cAEdL,OAAOC,eAAe,iBAAkBV,EAAWW,WACnDF,OAAON,GAAG,iBAAkBH,EAAWW,WAEvCV,EAAE,oBAAoBc,SACrBC,UAAW,YAIbhB,EAAWW,UAAY,SAAUN,GAChC,GAAIA,GAAQA,EAAKY,OAASZ,EAAKY,MAAMC,QAAUb,EAAKY,MAAM,GAAGE,MAAO,CACnEC,EAAcf,EAAKY,MAAM,GAAGE,MAAME,IAAKhB,EAAKY,MAAM,MAIpD,SAASG,EAAcC,EAAKC,GAC3B,IAAIC,EAAWzB,EAAW0B,IAAI,sBAAuB,MAAOH,GAC5D,IAAII,EAAmBF,EAASG,KAAK,yBACrC,IAAKD,IAAqBE,SAASF,EAAkB,IAAK,CACzD,OAGD,IAAIG,EAAcL,EAASM,KAAK,gCAEhCC,GAAmBR,GAAO,SAAUS,GACnCA,EAAKC,OACL,GAAIJ,EAAYV,SAAW,EAAG,CAC7Ba,EAAKE,SAASV,OACR,CACNQ,EAAKG,aAAaN,EAAYO,SAG/BJ,EAAKK,SAELvB,IAAIwB,qBACJN,EAAKF,KAAK,YAAYS,UAEtB,GAAIf,EAASM,KAAK,gCAAgCX,OAASS,SAASF,EAAkB,IAAK,CAC1FG,EAAYW,OAAOC,SAGpBvC,EAAEC,QAAQuC,QAAQ,uBAAyBxB,OAAQK,OAIrD,SAASQ,EAAkBb,EAAOyB,GACjCC,UAAUC,MAAM,aAAc,uBAAyB5C,YAAciB,MAAOA,IAAW,SAAUc,GAChGhC,EAAW8C,UAAUd,EAAM,SAAUe,GACpCA,EAAiB7C,EAAE6C,GACnBA,EAAejB,KAAK,0CAA0CkB,SAAS,kBAEvEL,EAASI,OAKZ,OAAO9C","file":"public/src/client/categories.js","sourcesContent":["'use strict';\n\n\ndefine('forum/categories', ['components', 'translator'], function (components, translator) {\n\tvar\tcategories = {};\n\n\t$(window).on('action:ajaxify.start', function (ev, data) {\n\t\tif (ajaxify.currentPage !== data.url) {\n\t\t\tsocket.removeListener('event:new_post', categories.onNewPost);\n\t\t}\n\t});\n\n\tcategories.init = function () {\n\t\tapp.enterRoom('categories');\n\n\t\tsocket.removeListener('event:new_post', categories.onNewPost);\n\t\tsocket.on('event:new_post', categories.onNewPost);\n\n\t\t$('.category-header').tooltip({\n\t\t\tplacement: 'bottom',\n\t\t});\n\t};\n\n\tcategories.onNewPost = function (data) {\n\t\tif (data && data.posts && data.posts.length && data.posts[0].topic) {\n\t\t\trenderNewPost(data.posts[0].topic.cid, data.posts[0]);\n\t\t}\n\t};\n\n\tfunction renderNewPost(cid, post) {\n\t\tvar category = components.get('categories/category', 'cid', cid);\n\t\tvar numRecentReplies = category.attr('data-numRecentReplies');\n\t\tif (!numRecentReplies || !parseInt(numRecentReplies, 10)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar recentPosts = category.find('[component=\"category/posts\"]');\n\n\t\tparseAndTranslate([post], function (html) {\n\t\t\thtml.hide();\n\t\t\tif (recentPosts.length === 0) {\n\t\t\t\thtml.appendTo(category);\n\t\t\t} else {\n\t\t\t\thtml.insertBefore(recentPosts.first());\n\t\t\t}\n\n\t\t\thtml.fadeIn();\n\n\t\t\tapp.createUserTooltips();\n\t\t\thtml.find('.timeago').timeago();\n\n\t\t\tif (category.find('[component=\"category/posts\"]').length > parseInt(numRecentReplies, 10)) {\n\t\t\t\trecentPosts.last().remove();\n\t\t\t}\n\n\t\t\t$(window).trigger('action:posts.loaded', { posts: [post] });\n\t\t});\n\t}\n\n\tfunction parseAndTranslate(posts, callback) {\n\t\ttemplates.parse('categories', '(categories.)?posts', { categories: { posts: posts } }, function (html) {\n\t\t\ttranslator.translate(html, function (translatedHTML) {\n\t\t\t\ttranslatedHTML = $(translatedHTML);\n\t\t\t\ttranslatedHTML.find('.post-content img:not(.not-responsive)').addClass('img-responsive');\n\n\t\t\t\tcallback(translatedHTML);\n\t\t\t});\n\t\t});\n\t}\n\n\treturn categories;\n});\n"]}