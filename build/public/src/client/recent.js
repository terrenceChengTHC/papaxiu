"use strict";define("forum/recent",["forum/infinitescroll","components"],function(e,t){var a={};var i=0;var n=0;$(window).on("action:ajaxify.start",function(e,t){if(ajaxify.currentPage!==t.url){a.removeListeners()}});a.init=function(){app.enterRoom("recent_topics");a.watchForNewPosts();$("#new-topics-alert").on("click",function(){$(this).addClass("hide")});if(!config.usePagination){e.init(a.loadMoreTopics)}$(window).trigger("action:topics.loaded",{topics:ajaxify.data.topics})};a.watchForNewPosts=function(){n=0;i=0;a.removeListeners();socket.on("event:new_topic",o);socket.on("event:new_post",r)};function o(e){if(ajaxify.data.selectedCategory&&parseInt(ajaxify.data.selectedCategory.cid,10)!==parseInt(e.cid,10)){return}if(ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"){return}i+=1;a.updateAlertText()}function r(e){function t(){n+=1;a.updateAlertText()}var i=e.posts[0];if(!i||!i.topic){return}if(parseInt(i.topic.mainPid,10)===parseInt(i.pid,10)){return}if(ajaxify.data.selectedCategory&&parseInt(ajaxify.data.selectedCategory.cid,10)!==parseInt(i.topic.cid,10)){return}if(ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="new"){return}if(ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"){socket.emit("topics.isFollowed",i.tid,function(e,a){if(e){app.alertError(e.message)}if(a){t()}});return}t()}a.removeListeners=function(){socket.removeListener("event:new_topic",o);socket.removeListener("event:new_post",r)};a.updateAlertText=function(){var e="";if(i===0){if(n===1){e="[[recent:there-is-a-new-post]]"}else if(n>1){e="[[recent:there-are-new-posts, "+n+"]]"}}else if(i===1){if(n===0){e="[[recent:there-is-a-new-topic]]"}else if(n===1){e="[[recent:there-is-a-new-topic-and-a-new-post]]"}else if(n>1){e="[[recent:there-is-a-new-topic-and-new-posts, "+n+"]]"}}else if(i>1){if(n===0){e="[[recent:there-are-new-topics, "+i+"]]"}else if(n===1){e="[[recent:there-are-new-topics-and-a-new-post, "+i+"]]"}else if(n>1){e="[[recent:there-are-new-topics-and-new-posts, "+i+", "+n+"]]"}}e+=" [[recent:click-here-to-reload]]";$("#new-topics-alert").translateText(e).removeClass("hide").fadeIn("slow");$("#category-no-topics").addClass("hide")};a.loadMoreTopics=function(t){if(t<0||!$('[component="category"]').length){return}e.loadMore("topics.loadMoreRecentTopics",{after:$('[component="category"]').attr("data-nextstart"),count:config.topicsPerPage,cid:utils.params().cid,filter:ajaxify.data.selectedFilter.filter,set:$('[component="category"]').attr("data-set")?$('[component="category"]').attr("data-set"):"topics:recent"},function(e,t){if(e.topics&&e.topics.length){a.onTopicsLoaded("recent",e.topics,false,t)}else{t()}$('[component="category"]').attr("data-nextstart",e.nextStart)})};a.onTopicsLoaded=function(e,a,i,n){a=a.filter(function(e){return!t.get("category/topic","tid",e.tid).length});if(!a.length){return n()}app.parseAndTranslate(e,"topics",{topics:a,showSelect:i},function(e){$("#category-no-topics").remove();e.insertAfter($('[component="category/topic"]').last());e.find(".timeago").timeago();app.createUserTooltips();utils.makeNumbersHumanReadable(e.find(".human-readable-number"));$(window).trigger("action:topics.loaded",{topics:a});n()})};return a});
//# sourceMappingURL=public/src/client/recent.js.map